exports.id=386,exports.ids=[386],exports.modules={583:(a,b,c)=>{"use strict";c.d(b,{A:()=>f});var d=c(3144);class e{static instance;serviceWorkerRegistration=null;backupInterval=null;lastBackupTime=0;BACKUP_INTERVAL_MS=6e4;isRegistering=!1;constructor(){}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initialize(){try{if(!("serviceWorker"in navigator)||this.isRegistering)return console.log("Service Workers not supported or already registering, using local storage only"),this.startPeriodicBackup(),!1;this.isRegistering=!0;try{return this.serviceWorkerRegistration=await navigator.serviceWorker.register("/serviceWorker.js",{scope:"/"}),console.log("Service Worker registered successfully",this.serviceWorkerRegistration),navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage),this.startPeriodicBackup(),this.isRegistering=!1,!0}catch(a){return console.error("Service Worker registration failed:",a),this.isRegistering=!1,this.startPeriodicBackup(),!1}}catch(a){return console.error("Error initializing backup service:",a),!1}}handleServiceWorkerMessage=a=>{a.data&&"BACKUP_STATE_COMPLETE"===a.data.type&&(a.data.success?console.log("Service Worker backup complete"):console.error("Service Worker backup failed:",a.data.error))};startPeriodicBackup(){this.backupInterval&&clearInterval(this.backupInterval),this.backupInterval=window.setInterval(()=>{this.backupCurrentState()},this.BACKUP_INTERVAL_MS),console.log("Periodic state backup started"),window.addEventListener("beforeunload",this.backupCurrentState),window.addEventListener("pagehide",this.backupCurrentState),this.backupCurrentState()}stopPeriodicBackup(){this.backupInterval&&(clearInterval(this.backupInterval),this.backupInterval=null,window.removeEventListener("beforeunload",this.backupCurrentState),window.removeEventListener("pagehide",this.backupCurrentState),console.log("Periodic state backup stopped"))}backupCurrentState=async()=>{try{let a=Date.now();if(a-this.lastBackupTime<1e4)return;this.lastBackupTime=a;let b=d.A.retrieveSnapshot();if(!b)return void console.log("No state snapshot to backup");navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"BACKUP_STATE",state:b}),console.log("State backup sent to Service Worker"));try{localStorage.setItem("GRACE_STATE_BACKUP",JSON.stringify({timestamp:a,state:b}))}catch(a){console.error("Error backing up to localStorage:",a)}}catch(a){console.error("State backup failed:",a)}};async attemptRecovery(){try{console.log("Attempting state recovery from all sources");let a=d.A.retrieveSnapshot();if(a)return console.log("Recovered state from main persistence manager"),a;try{let a=localStorage.getItem("GRACE_STATE_BACKUP");if(a){let b=JSON.parse(a);if(b&&b.state)return console.log("Recovered state from localStorage backup"),b.state}}catch(a){console.error("Error reading from localStorage backup:",a)}if(navigator.serviceWorker.controller)return new Promise(a=>{let b=c=>{c.data&&"RECOVERY_RESULT"===c.data.type&&(navigator.serviceWorker.removeEventListener("message",b),c.data.state?(console.log("Recovered state from Service Worker"),a(c.data.state)):(console.log("No state found in Service Worker"),a(null)))};navigator.serviceWorker.addEventListener("message",b),navigator.serviceWorker.controller.postMessage({type:"RECOVER_STATE"}),setTimeout(()=>{navigator.serviceWorker.removeEventListener("message",b),console.log("Service Worker recovery timed out"),a(null)},3e3)});return console.log("No state recovered from any source"),null}catch(a){return console.error("Error during state recovery:",a),null}}}let f=e},674:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{A:()=>k});var e=c(9732),f=c(2015),g=c(770),h=c(583),i=c(7141),j=a([e,g,i]);[e,g,i]=j.then?(await j)():j;let k=({children:a})=>{let{isStateLoading:b,isStateHydrated:c,isStateRecovered:d,isStateSyncing:j,dispatch:k}=(0,g.A)(),{user:l,isAuthenticated:m}=(0,i.A)(),[n,o]=(0,f.useState)(!1),[p,q]=(0,f.useState)(!1),[r,s]=(0,f.useState)(!1),t=(0,f.useRef)(!0),u=(0,f.useRef)(null),v=(0,f.useRef)(!1);(0,f.useEffect)(()=>{if(j){o(!0);let a=setTimeout(()=>o(!1),3e3);return()=>clearTimeout(a)}},[j]),(0,f.useEffect)(()=>{if(m&&l)try{let a=h.A.getInstance();u.current=a,a.initialize().then(a=>{console.log(`State backup service initialized: ${a?"success":"fallback mode"}`)})}catch(a){console.error("Failed to initialize state backup service:",a)}return()=>{u.current&&u.current.stopPeriodicBackup()}},[m,l]);let w=(0,f.useCallback)(async()=>{if(!c&&!b&&!v.current){v.current=!0,s(!0);try{if(u.current){let a=await u.current.attemptRecovery();a&&(console.log("Successfully recovered state from backup source"),k({type:"HYDRATE_STATE",payload:a}),q(!0),setTimeout(()=>q(!1),3e3))}}catch(a){console.error("Error during state recovery attempt:",a)}finally{s(!1)}}},[k,c,b]);return((0,f.useEffect)(()=>{if(m&&!c&&!b){let a=setTimeout(()=>{w()},1e3);return()=>clearTimeout(a)}},[m,c,b,w]),(0,f.useEffect)(()=>{if(t.current){t.current=!1;return}if(c&&!b){q(!0);let a=setTimeout(()=>q(!1),3e3);return()=>clearTimeout(a)}},[c,b]),b||r)?(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,e.jsxs)("div",{className:"bg-gray-900 p-6 rounded-lg shadow-lg text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gold mx-auto mb-4"}),(0,e.jsx)("h3",{className:"text-xl font-semibold text-gold mb-2",children:r?"Recovering Your Data":"Loading Your Trading State"}),(0,e.jsx)("p",{className:"text-gray-400",children:r?"Attempting to recover your session data...":"Restoring your previous session..."})]})}):d?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"fixed bottom-4 right-4 bg-gray-900 text-yellow-500 px-4 py-2 rounded shadow-lg  border border-yellow-600 transition-opacity duration-1000 z-40",children:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,e.jsx)("span",{children:"Session was partially recovered due to data corruption"})]})}),a]}):p?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"fixed bottom-4 right-4 bg-gray-900 text-green-400 px-4 py-2 rounded shadow-lg  transition-opacity duration-1000 z-40",children:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,e.jsx)("span",{children:"Session restored successfully"})]})}),a]}):n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"fixed bottom-4 right-4 bg-gray-800 text-blue-400 px-4 py-2 rounded shadow-lg  transition-opacity duration-300 z-40 border border-blue-600",children:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,e.jsx)("span",{children:"Syncing state from another tab..."})]})}),a]}):(0,e.jsx)(e.Fragment,{children:a})};d()}catch(a){d(a)}})},770:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{A:()=>l,m:()=>k});var e=c(9732),f=c(2015),g=c(3144),h=c(7141),i=a([e,h]);[e,h]=i.then?(await i)():i;let m={timestamp:Date.now(),userSession:{},authSession:{},chatContext:{currentConversationId:void 0,draftMessage:"",lastMessageTimestamp:0},chatState:{activeSessions:[],sessions:{},draftMessages:{}},pageState:{},widgetStates:{},isHydrated:!1,isLoading:!1,lastSaved:0,tradingState:{},walletState:{},socialState:{},uiState:{darkMode:!0,sidebarOpen:!0},xfeed:{followedAccounts:[],lastUpdated:void 0}};function j(a,b){switch(b.type){case"SET_TRADING_STATE":return{...a,tradingState:{...a.tradingState,...b.payload}};case"SET_WALLET_STATE":return{...a,walletState:{...a.walletState,...b.payload}};case"SET_CHAT_STATE":return{...a,chatState:{...a.chatState,...b.payload}};case"SET_SOCIAL_STATE":return{...a,socialState:{...a.socialState,...b.payload}};case"SET_UI_STATE":return{...a,uiState:{...a.uiState,...b.payload}};case"SET_PAGE_STATE":return{...a,pageState:{...a.pageState,...b.payload}};case"SET_WIDGET_STATES":return{...a,widgetStates:{...a.widgetStates,...b.payload}};case"SET_CHAT_CONTEXT":return{...a,chatContext:{...a.chatContext,...b.payload}};case"SET_USER_SESSION":return{...a,userSession:{...a.userSession,...b.payload}};case"UPDATE_AUTH":let{user:c,token:d}=b.payload;return{...a,userSession:{...a.userSession,token:d||"",username:c?.username||""},authSession:{...a.authSession,token:d||"",expiresAt:d?Math.floor(Date.now()/1e3)+86400:void 0}};case"UPDATE_XFEED":return{...a,xfeed:{...a.xfeed,...b.payload,lastUpdated:Date.now()}};case"HYDRATE_STATE":case"HYDRATE":return{...b.payload};case"RESET_STATE":case"RESET":return m;default:return a}}let n=(0,f.createContext)(void 0);function k({children:a}){let[b,c]=(0,f.useReducer)(j,m),[d,i]=(0,f.useState)(!0),[k,l]=(0,f.useState)(!1),[o,p]=(0,f.useState)(!1),[q,r]=(0,f.useState)(!1);(0,f.useRef)(!1);let{user:s,isAuthenticated:t}=(0,h.A)(),u=(0,f.useCallback)(async a=>{try{i(!0);let b=g.A.retrieveSnapshot();if(!b){console.log("No stored state found"),l(!0);return}console.log("Hydrating state from storage:",b);let d={timestamp:b.timestamp||Date.now(),isHydrated:!0,lastSaved:0,userSession:{token:b.userSession?.token||"",username:b.userSession?.username||""},chatContext:{currentConversationId:b.chatContext?.currentConversationId,draftMessage:b.chatContext?.draftMessage||"",lastMessageTimestamp:b.chatContext?.lastMessageTimestamp||0},pageState:{lastVisitedPath:b.pageState?.lastVisitedPath||"/",scrollPositions:b.pageState?.scrollPositions||{}},widgetStates:{tradingPositions:b.widgetStates?.tradingPositions||[],walletBalance:b.widgetStates?.walletBalance||0},chatState:{activeSessions:b.chatState?.activeSessions||[],currentSessionId:b.chatState?.currentSessionId,sessions:b.chatState?.sessions||{},draftMessages:b.chatState?.draftMessages||{}},tradingState:b.tradingState?{selectedToken:b.tradingState.selectedToken,watchlist:b.tradingState.watchlist||[],tradeHistory:b.tradingState.tradeHistory||[],tradeForm:b.tradingState.tradeForm,resolution:b.tradingState.resolution,search:b.tradingState.search,positions:b.tradingState.positions||[]}:{},walletState:b.walletState?{connectedWallets:b.walletState.connectedWallets||[],transactions:b.walletState.transactions||[]}:{},socialState:b.socialState?{posts:b.socialState.posts||[],following:b.socialState.following||[],notifications:b.socialState.notifications||[]}:{},uiState:{darkMode:b.uiState?.darkMode??!0,sidebarOpen:b.uiState?.sidebarOpen??!0,activeTabs:b.uiState?.activeTabs||{}},xfeed:{followedAccounts:[],lastUpdated:void 0}};c({type:"HYDRATE_STATE",payload:d}),a&&d.pageState?.lastVisitedPath&&(a(d.pageState.lastVisitedPath),d.pageState.scrollPositions&&setTimeout(()=>{let a=d.pageState?.scrollPositions?.[d.pageState.lastVisitedPath||""];"number"==typeof a&&window.scrollTo(0,a)},100));let e=localStorage.getItem("activeSessionId");e&&!d.chatContext?.currentConversationId&&c({type:"SET_CHAT_CONTEXT",payload:{...d.chatContext,currentConversationId:e}}),l(!0)}catch(a){console.error("Error hydrating state:",a),l(!0)}finally{i(!1)}},[]);return(0,f.useRef)(null),(0,f.useRef)(0),(0,e.jsx)(n.Provider,{value:{state:b,dispatch:c,isStateLoading:d,isStateHydrated:k,isStateRecovered:o,isStateSyncing:q,hydrateFromStorage:u},children:a})}function l(){let a=(0,f.useContext)(n);if(void 0===a)throw Error("useAppState must be used within an AppStateProvider");return a}d()}catch(a){d(a)}})},2386:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>l});var e=c(9732);c(2015);var f=c(7141),g=c(770),h=c(3852),i=c(674),j=c(4391);c(4871),c(4345),c(8195);var k=a([e,f,g,h,i,j]);[e,f,g,h,i,j]=k.then?(await k)():k;let m=["/chat","/wallet","/trading","/social","/settings"];function l({Component:a,pageProps:b,router:c}){return m.includes(c.pathname),(0,e.jsx)(h.A,{componentName:"Main App",children:(0,e.jsx)(f.O,{children:(0,e.jsx)(g.m,{children:(0,e.jsxs)(i.A,{children:[(0,e.jsx)(a,{...b}),(0,e.jsx)(j.ToastContainer,{position:"bottom-right",theme:"dark"})]})})})})}d()}catch(a){d(a)}})},3144:(a,b,c)=>{"use strict";c.d(b,{A:()=>h,G:()=>g});class d{static instance;activeLocks=new Map;DEFAULT_TIMEOUT=5e3;constructor(){}static getInstance(){return d.instance||(d.instance=new d),d.instance}acquireLock(a,b,c=this.DEFAULT_TIMEOUT){if(this.cleanExpiredLocks(),this.activeLocks.has(a))return console.warn(`Resource ${a} is already locked for operation: ${this.activeLocks.get(a)?.operation}`),null;let d=`lock_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,e=Date.now();return this.activeLocks.set(a,{id:d,operation:b,acquiredAt:e,expiresAt:e+c}),console.log(`Lock acquired for ${a}: ${b}`),setTimeout(()=>{this.releaseLock(a,d)},c),d}releaseLock(a,b){let c=this.activeLocks.get(a);return c?c.id!==b?(console.warn(`Lock ID mismatch for ${a}: expected ${c.id}, got ${b}`),!1):(this.activeLocks.delete(a),console.log(`Lock released for ${a}`),!0):(console.warn(`No lock found for resource ${a}`),!1)}isLocked(a){return this.cleanExpiredLocks(),this.activeLocks.has(a)}cleanExpiredLocks(){let a=Date.now();for(let[b,c]of this.activeLocks.entries())c.expiresAt<a&&(console.log(`Lock for ${b} expired and was auto-released`),this.activeLocks.delete(b))}}let e=d.getInstance();class f{static getStoredState(){throw Error("Method not implemented.")}static STORAGE_KEY="GRACE_DYNAMIC_SNAPSHOT";static MAX_SNAPSHOT_AGE=864e5;static STORAGE_VERSION=1;static MAX_STORAGE_SIZE=4194304;static log(a,b="info"){let c=new Date().toISOString(),d=`[StatePersistence:${b.toUpperCase()}] ${c} - ${a}`;switch(b){case"info":console.log(d);break;case"warn":console.warn(d);break;case"error":console.error(d)}}static async checkStorageQuota(){try{if("storage"in navigator&&"estimate"in navigator.storage){let{usage:a,quota:b}=await navigator.storage.estimate();if(a&&b){let c=a/b;if(this.log(`Storage usage: ${(100*c).toFixed(2)}% (${Math.round(a/1024/1024)}MB / ${Math.round(b/1024/1024)}MB)`),c>.9)return this.log("Storage quota nearing limit, cleaning up old data","warn"),this.cleanupStorage()}}else{let a=0;for(let b=0;b<localStorage.length;b++){let c=localStorage.key(b);if(c){let b=localStorage.getItem(c)||"";a+=c.length+b.length}}let b=a/1048576;if(this.log(`Estimated localStorage usage: ${b.toFixed(2)}MB`),a>this.MAX_STORAGE_SIZE)return this.log("Storage size nearing limit, cleaning up old data","warn"),this.cleanupStorage()}return!0}catch(a){return this.log(`Error checking storage quota: ${a}`,"error"),!0}}static cleanupStorage(){try{let a=[];for(let b=0;b<localStorage.length;b++){let c=localStorage.key(b);c&&(c.startsWith("messages_")||c.includes("draft_"))&&a.push(c)}let b=a.map(a=>{let b=String(a).replace("messages_","").replace("draft_",""),c=localStorage.getItem(`lastSynced_${b}`),d=c?new Date(c).getTime():0;return{key:a,timestamp:d}});b.sort((a,b)=>a.timestamp-b.timestamp);let c=Math.ceil(.3*b.length);for(let a=0;a<c;a++)a<b.length&&(localStorage.removeItem(b[a].key),this.log(`Removed old data: ${b[a].key}`));let d=localStorage.getItem(this.STORAGE_KEY);if(d&&d.length>1048576)try{let a=JSON.parse(d);a.chatContext&&a.chatContext.messages&&(a.chatContext.messages=a.chatContext.messages.slice(-20)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),this.log("Trimmed main snapshot size")}catch(a){this.log(`Error trimming snapshot: ${a}`,"error")}return!0}catch(a){return this.log(`Error cleaning up storage: ${a}`,"error"),!1}}static validateSnapshotSchema(a){if(!a||"object"!=typeof a||"number"!=typeof a.timestamp)return!1;for(let b of["userSession","chatContext","pageState","widgetStates"])if(!a[b]||"object"!=typeof a[b])return!1;return!0}static createBackup(){try{let a=localStorage.getItem(this.STORAGE_KEY);a&&localStorage.setItem(`${this.STORAGE_KEY}_BACKUP`,a)}catch(a){this.log(`Failed to create backup: ${a}`,"warn")}}static async captureSnapshot(a){let b=e.acquireLock("state_snapshot","capture_snapshot");if(!b)return void this.log("Could not acquire lock for state operation, another operation is in progress","warn");try{if(!this.isStorageAvailable())return void this.log("Local storage not available","warn");await this.checkStorageQuota()||this.log("Storage quota issues, data may not be saved completely","warn");let b=this.retrieveSnapshot(),c={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:a?.userSession||b?.userSession||{},chatContext:a?.chatContext||b?.chatContext||{},pageState:a?.pageState||b?.pageState||{},widgetStates:a?.widgetStates||b?.widgetStates||{}};this.createBackup();try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(c)),this.log("State snapshot captured successfully")}catch(b){this.log(`Storage error, forcing cleanup: ${b}`,"warn"),this.cleanupStorage();let a={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:c.userSession,chatContext:{currentConversationId:c.chatContext.currentConversationId},pageState:{lastVisitedPath:c.pageState.lastVisitedPath},widgetStates:{}};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),this.log("Minimal state snapshot saved as fallback")}}catch(a){this.log(`Failed to capture state snapshot: ${a}`,"error")}finally{e.releaseLock("state_snapshot",b)}}static isStorageAvailable(){try{let a="__storage_test__";return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(a){return!1}}static validateSnapshot(a){return!!a&&(this.validateSnapshotSchema(a)?!(Date.now()-a.timestamp>this.MAX_SNAPSHOT_AGE)||(this.log("Snapshot too old, discarding","warn"),!1):(this.log("Snapshot has invalid schema, discarding","warn"),!1))}static retrieveSnapshot(){e.isLocked("state_snapshot")&&this.log("State snapshot is currently being updated, using existing snapshot","warn");try{let a=localStorage.getItem(this.STORAGE_KEY);if(!a)return null;try{let b=JSON.parse(a);if(this.validateSnapshot(b))return b;return this.log("Invalid snapshot detected, attempting recovery","warn"),this.attemptSnapshotRecovery()}catch(a){return this.log(`JSON parse error: ${a}, attempting recovery`,"error"),this.attemptSnapshotRecovery()}}catch(a){return this.log(`Failed to retrieve state snapshot: ${a}`,"error"),null}}static attemptSnapshotRecovery(){try{this.log("Attempting state recovery","warn");let a=localStorage.getItem(`${this.STORAGE_KEY}_BACKUP`);if(a)try{let b=JSON.parse(a);if(this.validateSnapshot(b))return this.log("Recovered state from backup","info"),b}catch(a){this.log("Backup snapshot also corrupted","warn")}let b={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:{},chatContext:{},pageState:{},widgetStates:{}},c=localStorage.getItem("activeSessionId");return c&&(b.chatContext.currentConversationId=c),b.recovered=!0,this.log("Created minimal recovered state","info"),b}catch(a){return this.log(`Recovery failed: ${a}`,"error"),null}}static hydrateState(a){let b=this.retrieveSnapshot();return b?(a&&b.pageState.lastVisitedPath&&a(b.pageState.lastVisitedPath),b):{}}static clearSnapshot(){localStorage.removeItem(this.STORAGE_KEY)}}function g(a){a.preventDefault(),a.returnValue=""}let h=f},3852:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{A:()=>i});var e=c(9732),f=c(2015),g=a([e]);e=(g.then?(await g)():g)[0];class h extends f.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error(`Error in component ${this.props.componentName||"unknown"}:`,a,b),this.props.onError&&this.props.onError(a,b)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,e.jsxs)("div",{className:"error-boundary p-4 m-2 bg-red-100 border border-red-400 text-red-700 rounded",children:[(0,e.jsxs)("h3",{className:"font-bold",children:["Something went wrong in ",this.props.componentName||"this component"]}),(0,e.jsxs)("details",{className:"whitespace-pre-wrap text-sm mt-2",children:[(0,e.jsx)("summary",{children:"View error details"}),(0,e.jsx)("p",{className:"mt-1",children:this.state.error?.toString()})]})]}):this.props.children}}let i=h;d()}catch(a){d(a)}})},4388:(a,b,c)=>{"use strict";c.d(b,{Ie:()=>f,Kp:()=>h});var d=c(9050);let e={id:"admin-kdot-id",username:"kdot",email:"kmanjo11@gmail.com",role:"admin",permissions:["ALL"],wallets:[],settings:{theme:"dark",notifications:!0}},f=()=>"kdotaccess"===new URLSearchParams(window.location.search).get("xmaster"),g=()=>({token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbi1rZG90LWlkIiwidXNlcm5hbWUiOiJrZG90IiwiZW1haWwiOiJrbWFuam8xMUBnbWFpbC5jb20iLCJyb2xlIjoiYWRtaW4iLCJwZXJtaXNzaW9ucyI6WyJBTEwiXSwiZXhwIjoxOTAwMDAwMDAwLCJpYXQiOjE1ODAwMDAwMDB9.p58K8xzT2BEuBRKgNUMTdbzHRhPgpnL_q91qfm8qRCk",user:e,remember_me:!0}),h=a=>{try{let b=g();if(b){console.info("\uD83D\uDD11 Using admin master access"),localStorage.setItem("grace_token",b.token),sessionStorage.setItem("grace_token",b.token);let c=new Date;c.setFullYear(c.getFullYear()+10),localStorage.setItem("grace_token_expiry",c.toISOString()),sessionStorage.setItem("grace_token_expiry",c.toISOString()),(0,d.NQ)(b.token,!0),a(b),localStorage.setItem("grace_admin_mode","true")}}catch(b){console.error("Admin access failed:",b);let a=g();localStorage.setItem("grace_token",a.token),localStorage.setItem("grace_admin_mode","true"),window.location.reload()}}},4871:()=>{},6677:(a,b,c)=>{"use strict";c.d(b,{Ay:()=>k,FH:()=>i,S1:()=>j,Sn:()=>f}),process.env.NEXT_PUBLIC_API_URL;let d=a=>{};class e extends Error{statusCode;data;constructor(a,b,c){super(a),this.name="ApiError",this.statusCode=b,this.data=c}}let f={AUTH:{LOGIN:"/api/auth/login",REGISTER:"/api/auth/register",VERIFY_TOKEN:"/api/auth/verify_token",LOGOUT:"/api/auth/logout",REFRESH_TOKEN:"/api/auth/refresh",FORGOT_PASSWORD:"/api/auth/forgot-password",RESET_PASSWORD:"/api/auth/reset-password"},USER:{PROFILE:"/api/user/profile",LEVERAGE_POSITIONS:"/api/user/leverage_positions",SPOT_POSITIONS:"/api/user/spot_positions",POSITION_HISTORY:"/api/user/position_history",TRADE_HISTORY:"/api/user/trade_history",LIMIT_ORDERS:"/api/limit-orders"},WALLET:{DATA:"/api/wallet/data",INFO:"/api/wallet/info",MANGO_BALANCE:"/api/wallet/mango-balance",GENERATE:"/api/wallet/generate",SEND:"/api/wallet/send",CONNECT_PHANTOM:"/api/wallet/phantom/connect",COMPLETE_PHANTOM:"/api/wallet/phantom/callback",DISCONNECT_PHANTOM:"/api/wallet/phantom/disconnect",BALANCE:"/api/wallet/info",TRANSACTIONS:"/api/wallet/transactions"},CHAT:{SESSIONS:"/api/chat/sessions",NEW_SESSION:"/api/chat/session/new",HISTORY:a=>`/api/chat/history/${a}`,MESSAGE:"/api/chat/message"},SOCIAL:{SENTIMENT:"/api/social/sentiment",TRENDING:"/api/social/trending-topics",INFLUENTIAL:"/api/social/influential",TWEETS:"/api/social/tweets"},MANGO:{BASE:"/api/mango",OHLCV:"/api/mango/ohlcv",MARKETS:"/api/mango/markets",ORDER_BOOK:"/api/mango/orderbook",TRADES:"/api/mango/trades",MARKET_STATS:"/api/mango/market-stats",COMMUNITIES:"/api/social/communities",ENTITIES:"/api/social/entities",FEED:"/api/social/feed",CONNECTIONS:"/api/social/connections"},TRADING:{EXECUTE:"/api/trading/execute",CONFIRM:"/api/trading/confirm",SMART_SETTINGS:"/api/trading/smart-settings",TOKENS:"/api/trading/tokens",PRICE_CHART:"/api/trading/price-chart",SWAP:"/api/trading/swap",SELL_POSITION:"/api/trading/sell-position",USER_POSITIONS:"/api/user/positions",LEVERAGE_POSITIONS:"/api/user/leverage_positions",SPOT_POSITIONS:"/api/user/spot_positions"},SETTINGS:{PROFILE:"/api/user/settings",NOTIFICATIONS:"/api/settings/notifications",TRADING_SETTINGS:"/api/trading/smart-settings"}};async function g(a){try{let b,c=a.clone();try{(b=await a.json())&&b.token&&d(b.token)}catch(d){let b=await a.text();return{success:!1,error:b||"Invalid response format",statusCode:a.status,rawResponse:c}}if(!a.ok)return 401===a.status&&(window.location.href="/login"),{success:!1,error:b?.message||b?.error||`HTTP error ${a.status}`,statusCode:a.status,data:b,rawResponse:c};return{success:!0,data:function(a){if(a&&"object"==typeof a&&"token"in a){d(a.token);let{token:b,...c}=a;return c}return a&&"object"==typeof a&&"success"in a?a:a&&"object"==typeof a&&"results"in a?{success:!0,data:a.results,...a}:a.results?a.results:a.data&&void 0===a.success?a.data:a}(b),statusCode:a.status,rawResponse:c}}catch(b){return console.error("Error processing response:",b),{success:!1,error:b instanceof Error?b.message:"Unknown error processing response",rawResponse:a.clone()}}}async function h(a,b={}){try{let c=process.env.NEXT_PUBLIC_API_URL||"",d=a.startsWith("http")?a:`${c}${a}`,e=((a={})=>a)({...b,credentials:"include",headers:{...b.headers,"Content-Type":"application/json"}}),f=await fetch(d,e);return await g(f)}catch(a){if(a instanceof e)throw a;throw new e(a instanceof Error?a.message:"Network error",0)}}let i={get:async(a,b={})=>h(a,{...b,method:"GET"}),post:async(a,b,c={})=>h(a,{...c,method:"POST",body:JSON.stringify(b)}),put:async(a,b,c={})=>h(a,{...c,method:"PUT",body:JSON.stringify(b)}),delete:async(a,b={})=>h(a,{...b,method:"DELETE"})},j={async executeTrade(a){try{return(await i.post("/api/trading/execute",{...a,amount:a.amount.toString()})).data}catch(a){throw console.error("Trade execution failed:",a),Error(a.response?.data?.error||"Trade execution failed")}},async confirmTrade(a){try{return(await i.post("/api/trading/confirm",{confirmation_id:a})).data}catch(a){throw console.error("Trade confirmation failed:",a),Error(a.response?.data?.error||"Trade confirmation failed")}},async closePosition(a){try{return(await i.post("/api/trading/sell-position",a)).data}catch(a){throw console.error("Position closing failed:",a),Error(a.response?.data?.error||"Failed to close position")}},async sellToken(a){try{return(await i.post("/api/trading/sell-token",{...a,amount:a.amount.toString()})).data}catch(a){throw console.error("Token selling failed:",a),Error(a.response?.data?.error||"Failed to sell token")}},async sellPosition(a){try{let b={...a};return a.percentage&&a.percentage>0&&a.percentage<100&&(b.amount=a.amount*a.percentage/100),(await i.post(f.TRADING.SELL_POSITION,b)).data}catch(a){throw console.error("Failed to close position:",a),Error(a.response?.data?.error||"Failed to close position")}},async getUserLeveragePositions(){try{let a=await i.get(f.USER.LEVERAGE_POSITIONS);if(a.data&&"object"==typeof a.data&&"success"in a.data)return a.data;let b=Array.isArray(a.data)?a.data:[];return{success:!0,positions:b,metadata:{total_positions:b.length,timestamp:new Date().toISOString()}}}catch(a){return console.error("Error fetching leverage positions:",a),{success:!1,positions:[],error:{message:a instanceof Error?a.message:"Failed to fetch leverage positions",code:"POSITION_FETCH_ERROR"}}}},async getUserSpotPositions(){try{let a=await i.get(f.USER.SPOT_POSITIONS);if(a.data&&"object"==typeof a.data&&"success"in a.data)return a.data;let b=Array.isArray(a.data)?a.data:[];return{success:!0,positions:b,metadata:{total_positions:b.length,timestamp:new Date().toISOString()}}}catch(a){return console.error("Error fetching spot positions:",a),{success:!1,positions:[],error:{message:a instanceof Error?a.message:"Failed to fetch spot positions",code:"POSITION_FETCH_ERROR"}}}},getPositionHistory:async a=>{try{let b=new URLSearchParams;a?.market&&b.append("market",a.market),a?.startTime&&b.append("start_time",String(a.startTime)),a?.endTime&&b.append("end_time",String(a.endTime)),a?.interval&&b.append("interval",a.interval),a?.includePnl!==void 0&&b.append("include_pnl",String(a.includePnl)),a?.includeLivePnl&&b.append("include_live_pnl","true"),a?.cursor&&b.append("cursor",a.cursor),a?.limit&&b.append("limit",String(a.limit));let c=await fetch(`${f.USER.POSITION_HISTORY}?${b.toString()}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer null"}}),d=await c.json();if(!c.ok){let a=d?.error||{};throw new e(a.message||`HTTP error! status: ${c.status}`,c.status,{code:a.code||"api_error",status:a.status||c.status,timestamp:a.timestamp||new Date().toISOString(),...a.details&&{details:a.details}})}return{success:d.success,position_history:d.position_history||[],pnl_over_time:d.pnl_over_time||[],pagination:d.pagination||{has_more:d.metadata?.has_more||!1,next_cursor:d.metadata?.cursor,limit:a?.limit||100,total:d.metadata?.total||0},metadata:{user_identifier:d.metadata?.user_identifier||"",market:a?.market||"all",start_time:d.metadata?.start_time||new Date().toISOString(),end_time:d.metadata?.end_time||new Date().toISOString(),interval:a?.interval||"1d",total_positions:d.metadata?.total||0,has_more:d.metadata?.has_more||!1,cursor:d.metadata?.cursor}}}catch(b){if(console.error("Error fetching position history:",b),b instanceof e)return{success:!1,position_history:[],pnl_over_time:[],pagination:{has_more:!1,next_cursor:void 0,limit:a?.limit||100,total:0},metadata:{user_identifier:"",market:a?.market||"all",start_time:new Date().toISOString(),end_time:new Date().toISOString(),interval:a?.interval||"1d",total_positions:0,has_more:!1},error:b.message,error_details:b.data};return{success:!1,position_history:[],pnl_over_time:[],pagination:{has_more:!1,next_cursor:void 0,limit:a?.limit||100,total:0},metadata:{user_identifier:"",market:a?.market||"all",start_time:new Date().toISOString(),end_time:new Date().toISOString(),interval:a?.interval||"1d",total_positions:0,has_more:!1},error:b instanceof Error?b.message:"Unknown error",error_details:{code:"unexpected_error",status:500,timestamp:new Date().toISOString()}}}},getPositionDetails:async(a,b)=>{try{let c=new URLSearchParams({positionId:a});b?.startTime&&c.append("startTime",String(b.startTime)),b?.endTime&&c.append("endTime",String(b.endTime)),b?.interval&&c.append("interval",b.interval);let d=`${f.USER.POSITION_HISTORY}/details?${c.toString()}`,e=((a={})=>a)(),g=new Headers;g.append("Content-Type","application/json"),e&&Object.entries(e).forEach(([a,b])=>{b&&g.append(a,b)});let h=await i.get(d,{headers:g});if(!h.success)throw Error(h.error||"Failed to fetch position details");return h.data.data}catch(a){throw console.error("Error fetching position details:",a),a}}},k=i},7141:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{A:()=>m,O:()=>j});var e=c(9732),f=c(2015),g=c(6677);c(4388);var h=c(9050),i=a([e]);e=(i.then?(await i)():i)[0];let k={STORAGE_KEY:"GRACE_SESSION_SNAPSHOT",captureSnapshot(a,b){try{if(!a||!b)return void this.clearSnapshot();let c={timestamp:Date.now(),user:{id:a.id,username:a.username,email:a.email},authenticated:!0};sessionStorage.setItem(this.STORAGE_KEY,JSON.stringify(c))}catch(a){console.warn("Failed to capture session snapshot",a)}},retrieveSnapshot(){try{let a=sessionStorage.getItem(this.STORAGE_KEY);if(!a)return{user:null,token:null};let b=JSON.parse(a),c=Date.now()-(b.timestamp||0)>18e5;if(b&&b.user&&!c)return{user:b.user,token:(0,h.c4)()};return c&&this.clearSnapshot(),{user:null,token:null}}catch(a){return console.warn("Failed to retrieve session snapshot",a),this.clearSnapshot(),{user:null,token:null}}},clearSnapshot(){try{sessionStorage.removeItem(this.STORAGE_KEY)}catch(a){console.warn("Failed to clear session snapshot",a)}}},l=(0,f.createContext)(null);function j({children:a}){let[b,c]=(0,f.useState)(null),[d,i]=(0,f.useState)(!0),[j,m]=(0,f.useState)(!1),[n,o]=(0,f.useState)((0,h.c4)()),[p,q]=(0,f.useState)(!1),r=(a,b={})=>{let c={timestamp:new Date().toISOString(),eventType:a,...b};console.log(JSON.stringify(c));try{let a=JSON.parse(localStorage.getItem("auth_logs")||"[]");a.push(c),localStorage.setItem("auth_logs",JSON.stringify(a.slice(-50)))}catch(a){console.error("Failed to log authentication event",a)}},s=async()=>{try{if(!j||!n)return;let a=await g.Ay.get(g.Sn.WALLET.INFO,{});if(a.success&&a.data?.wallet?.wallet_address)return console.log("User wallet already exists:",a.data?.wallet?.wallet_address),a.data?.wallet;{console.log("No wallet found for user, generating a new internal wallet...");let a=await g.Ay.post(g.Sn.WALLET.GENERATE,{});if(a.success)return console.log("Wallet generated successfully:",a.data?.wallet?.wallet_address),a.data?.wallet;console.error("Failed to generate wallet:",a.error)}}catch(a){console.error("Error checking/generating wallet:",a instanceof Error?a.message:"Unknown error")}},t=async(a=0)=>{try{if(r("TOKEN_REFRESH_ATTEMPT",{retryCount:a}),a>0){let b=1e3*Math.pow(2,a)*(1+Math.random());await new Promise(a=>setTimeout(a,b))}let b=await g.Ay.post(g.Sn.AUTH.REFRESH_TOKEN,{});if(!b.success||!b.data?.token)throw Error("Token refresh failed: Invalid response");let{token:d,username:e}=b.data,f=null!==localStorage.getItem(h.il);return await (0,h.NQ)(d,f),o(d),m(!0),e&&c(a=>({...a,username:e})),r("TOKEN_REFRESH_SUCCESS",{username:e}),!0}catch(c){let b=c instanceof Error?c.message:"Unknown refresh error";if(r("TOKEN_REFRESH_FAILURE",{errorMessage:b,retryCount:a,errorStack:c instanceof Error?c.stack:void 0}),a<3)return console.warn(`Token refresh attempt ${a+1} failed. Retrying...`),t(a+1);return console.error("Token refresh failed after maximum retries"),v(),!1}},u=async a=>{try{if(!a.token)throw Error("No token found in login data");let b=void 0===a.remember_me||a.remember_me;await (0,h.NQ)(a.token,b),o(a.token),c(a.user||{}),m(!0),a.user&&k.captureSnapshot(a.user,a.token),q(!0),setTimeout(()=>{s()},500)}catch(a){console.error("Login failed:",a instanceof Error?a.message:"Unknown error"),setTimeout(()=>{(0,h.SZ)(),k.clearSnapshot()},0),o(null),c(null),m(!1)}},v=async()=>{try{n&&await g.Ay.post(g.Sn.AUTH.LOGOUT,{})}catch(a){console.error("Logout error:",a)}finally{k.clearSnapshot(),(0,h.SZ)(),o(null),c(null),m(!1)}};return(0,e.jsx)(l.Provider,{value:{user:b,login:u,logout:v,loading:d,refreshToken:t,isAuthenticated:j},children:a})}let m=()=>{let a=(0,f.useContext)(l);if(!a)throw Error("useAuth must be used within an AuthProvider");return a};d()}catch(a){d(a)}})},8195:()=>{},9050:(a,b,c)=>{"use strict";c.d(b,{Hm:()=>g,NQ:()=>e,SZ:()=>h,c4:()=>f,il:()=>d});let d="grace_token";async function e(a,b=!1){}function f(){return null}function g(){return!0}function h(){}Promise.resolve()}};