(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[743],{4707:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var l=a(7765),s=a(5977),n=a(8840),r=a(7650),o=a(7303),d=a(9447);let i=()=>{var e,t;let{user:a}=(0,n.A)(),[o,d]=(0,s.useState)(!0),[i,c]=(0,s.useState)(null),[u,m]=(0,s.useState)({walletApiCalled:!1,walletApiResponse:null,walletApiError:null,hasWalletAddress:!1,walletAddress:null,walletDataRaw:null}),[x,h]=(0,s.useState)(null),p=async()=>{d(!0);try{var e;m(e=>({...e,walletApiCalled:!0}));let t=await r.FH.get(r.Sn.WALLET.INFO,{});if(console.log("Wallet API Response:",t),m(e=>({...e,walletApiResponse:t,walletDataRaw:t.data})),t.success&&(null==(e=t.data)?void 0:e.wallet)){c(t.data.wallet);let e=t.data.wallet.address;m(t=>({...t,hasWalletAddress:!!e,walletAddress:e||"No address found"}))}else h("Wallet data not available or empty response"),m(e=>({...e,hasWalletAddress:!1,walletAddress:"No address found"}))}catch(e){console.error("Error fetching wallet data:",e),h("Failed to fetch wallet data: ".concat(e instanceof Error?e.message:"Unknown error")),m(t=>({...t,walletApiError:e instanceof Error?e.message:"Unknown error"}))}finally{d(!1)}},g=async()=>{d(!0);try{let e=await r.FH.post(r.Sn.WALLET.GENERATE,{});console.log("Wallet Generation Response:",e),e.success?(m(t=>({...t,walletGenerationResponse:e,walletGenerationSuccess:!0})),await p()):(h("Failed to generate wallet"),m(t=>({...t,walletGenerationResponse:e,walletGenerationSuccess:!1})))}catch(e){console.error("Error generating wallet:",e),h("Failed to generate wallet: ".concat(e instanceof Error?e.message:"Unknown error")),m(t=>({...t,walletGenerationError:e instanceof Error?e.message:"Unknown error"}))}finally{d(!1)}};return(0,s.useEffect)(()=>{(null==a?void 0:a.id)&&p()},[null==a?void 0:a.id]),(0,l.jsxs)("div",{className:"p-4 bg-gray-800 rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Wallet Debugger"}),o?(0,l.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-4 p-3 bg-gray-900 rounded",children:[(0,l.jsx)("h3",{className:"text-md text-blue-400 font-bold mb-2",children:"Debug Status"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,l.jsx)("div",{className:"text-gray-400",children:"API Call Made:"}),(0,l.jsx)("div",{className:u.walletApiCalled?"text-green-400":"text-red-400",children:u.walletApiCalled?"Yes":"No"}),(0,l.jsx)("div",{className:"text-gray-400",children:"API Call Success:"}),(0,l.jsx)("div",{className:(null==(e=u.walletApiResponse)?void 0:e.success)?"text-green-400":"text-red-400",children:(null==(t=u.walletApiResponse)?void 0:t.success)?"Yes":"No"}),(0,l.jsx)("div",{className:"text-gray-400",children:"Has Wallet Address:"}),(0,l.jsx)("div",{className:u.hasWalletAddress?"text-green-400":"text-red-400",children:u.hasWalletAddress?"Yes":"No"})]})]}),(0,l.jsxs)("div",{className:"mb-4 p-3 bg-gray-900 rounded",children:[(0,l.jsx)("h3",{className:"text-md text-blue-400 font-bold mb-2",children:"Wallet Address"}),u.hasWalletAddress?(0,l.jsx)("div",{className:"bg-gray-800 p-2 rounded text-green-300 font-mono text-sm break-all",children:u.walletAddress}):(0,l.jsxs)("div",{className:"bg-red-900/30 p-2 rounded text-red-300 text-sm",children:["No wallet address found",(0,l.jsx)("button",{onClick:g,className:"mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",disabled:o,children:o?"Generating...":"Generate Wallet Now"})]})]}),x&&(0,l.jsxs)("div",{className:"mb-4 p-3 bg-red-900/30 rounded",children:[(0,l.jsx)("h3",{className:"text-md text-red-400 font-bold mb-2",children:"Error"}),(0,l.jsx)("div",{className:"text-red-300 text-sm",children:x})]}),(0,l.jsxs)("div",{className:"mb-4 p-3 bg-gray-900 rounded",children:[(0,l.jsx)("h3",{className:"text-md text-blue-400 font-bold mb-2",children:"Raw Wallet Data"}),(0,l.jsx)("pre",{className:"bg-gray-800 p-2 rounded text-gray-300 text-xs overflow-auto max-h-60",children:JSON.stringify(i,null,2)||"No data available"})]}),(0,l.jsxs)("div",{className:"p-3 bg-gray-900 rounded",children:[(0,l.jsx)("h3",{className:"text-md text-blue-400 font-bold mb-2",children:"API Response"}),(0,l.jsx)("pre",{className:"bg-gray-800 p-2 rounded text-gray-300 text-xs overflow-auto max-h-60",children:JSON.stringify(u.walletApiResponse,null,2)||"No response data"})]}),(0,l.jsx)("button",{onClick:p,className:"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm",disabled:o,children:o?"Refreshing...":"Refresh Wallet Data"})]})]})},c=["\uD83D\uDE80","\uD83D\uDC8E","\uD83C\uDF1F","⚡","\uD83D\uDD25","\uD83E\uDD16","MOON","DEGEN","CHAD","BASED","ALPHA"];function u(e){if(!e)return"No Address";try{if(null==e)return"No Address";let t=String(e);if(t.includes("\\x"))try{let e,a=/\\x([0-9a-fA-F]{2})/g,l="";for(;null!==(e=a.exec(t));)l+=e[1];t=l.length>0?l:t.replace(/\\x/g,"")}catch(e){t=t.replace(/\\x/g,"")}if(!/^[0-9a-zA-Z]+$/.test(t))try{t=Array.from(t).map(e=>{try{return e.charCodeAt(0).toString(16).padStart(2,"0")}catch(e){return"00"}}).join("")}catch(e){t=t.replace(/[^a-zA-Z0-9]/g,"")}let a=Math.floor(Math.random()*c.length),l=c[a]||"DEGEN",s=t||"invalid_wallet_address";if(!/^[0-9a-fA-F]+$/.test(s))try{s=Array.from(s).map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}catch(e){s="deadbeef"+Date.now().toString(16)}return"".concat(l," ").concat(s," \uD83D\uDCB0")}catch(e){return console.error("Error converting address:",e),"DEGEN wallet \uD83D\uDCB0"}}function m(){var e,t,a,c,m,x,h,p,g,w,b,N,v,f;let{user:j}=(0,n.A)(),[y,A]=(0,s.useState)(null),[S,_]=(0,s.useState)("idle"),[E,D]=(0,s.useState)(null),[C,W]=(0,s.useState)(""),[T,L]=(0,s.useState)(""),[F,P]=(0,s.useState)(""),[O,R]=(0,s.useState)("sol"),[k,I]=(0,s.useState)(""),H=(0,s.useRef)(null),G=(0,s.useRef)(null),M=(0,o.useRouter)(),U=async e=>{try{let{data:t,success:a}=await r.FH.post(r.Sn.WALLET.COMPLETE_PHANTOM,{session_id:e,validate_only:!0});if(a&&t.valid)return!0;return A(null),localStorage.removeItem("phantom_session"),!1}catch(e){return console.error("Failed to validate Phantom session:",e),A(null),localStorage.removeItem("phantom_session"),!1}};(0,s.useEffect)(()=>{let e=localStorage.getItem("phantom_session");if(e&&j)try{let t=JSON.parse(e);new Date(t.expiresAt).getTime()>Date.now()?(A(t.sessionId),(async()=>{await U(t.sessionId)})()):localStorage.removeItem("phantom_session")}catch(e){localStorage.removeItem("phantom_session")}},[j]),(0,s.useEffect)(()=>()=>{G.current&&clearTimeout(G.current),H.current&&!H.current.closed&&H.current.close()},[]);let B=async()=>{try{W("");let{data:e,success:t}=await r.FH.get(r.Sn.WALLET.DATA);if(t&&e){try{let t=await r.FH.get(r.Sn.WALLET.MANGO_BALANCE);t.success&&(e.mango_balance={total_value:J(t.data.balances),balances:t.data.balances})}catch(t){console.error("Error fetching Mango balance:",t),e.mango_balance={total_value:0,balances:{}}}D(e)}else throw Error("Failed to load wallet data")}catch(e){console.error("Wallet data fetch error:",e),W((null==e?void 0:e.message)||"Failed to load wallet info")}},J=e=>{if(!e)return 0;let t=0;return Object.values(e).forEach(e=>{if("object"==typeof e){let a=e.value_usd||e.notionalValue||e.usd_value||(e.amount&&e.price?e.amount*e.price:0);t+=Number(a)||0}}),t};(0,s.useEffect)(()=>{j&&B()},[j]),(0,s.useEffect)(()=>{let{phantom_address:e,session_id:t}=M.query;e&&t&&"string"==typeof e&&"string"==typeof t&&(z(t,e),M.replace("/wallet"))},[M.query]);let Y=async()=>{try{W(""),_("connecting");let e=localStorage.getItem("phantom_session");if(e)try{let t=JSON.parse(e);if(new Date(t.expiresAt).getTime()>Date.now()&&(A(t.sessionId),await U(t.sessionId))){await B(),_("idle");return}localStorage.removeItem("phantom_session")}catch(e){localStorage.removeItem("phantom_session")}let t="".concat(window.location.origin,"/wallet"),{data:a,success:l}=await r.FH.post(r.Sn.WALLET.CONNECT_PHANTOM,{redirect_url:t});if(l&&a.connection){let e=a.connection.session_id;A(e);let t=new Date(Date.now()+18e5);localStorage.setItem("phantom_session",JSON.stringify({sessionId:e,expiresAt:t.toISOString()}));let l=a.connection.authorize_url,s=window.innerWidth/2-225,n=window.innerHeight/2-300;H.current=window.open(l,"Connect Phantom Wallet","width=".concat(450,",height=").concat(600,",left=").concat(s,",top=").concat(n));let r=t=>{var a,l;(null==(a=t.data)?void 0:a.type)==="phantom_connection"&&(null==(l=t.data)?void 0:l.wallet_address)&&(z(e,t.data.wallet_address),window.removeEventListener("message",r),G.current&&(clearTimeout(G.current),G.current=null))};window.addEventListener("message",r),G.current=setTimeout(()=>{_("timeout"),window.removeEventListener("message",r),H.current&&H.current.closed&&console.log("Phantom connection window was closed by user")},45e3)}else throw _("error"),Error((null==a?void 0:a.error)||"Connection failed")}catch(e){console.error("Phantom connect error:",e),_("error"),W((null==e?void 0:e.message)||"Connection failed")}},$=async()=>{try{W("");let{data:e,success:t}=await r.FH.post(r.Sn.WALLET.DISCONNECT_PHANTOM,{});if(t)localStorage.removeItem("phantom_session"),A(null),await B();else throw Error((null==e?void 0:e.error)||"Failed to disconnect wallet")}catch(e){console.error("Phantom disconnect error:",e),W((null==e?void 0:e.message)||"Failed to disconnect wallet")}},z=async(e,t)=>{try{W(""),_("idle");let{data:a,success:l}=await r.FH.post(r.Sn.WALLET.COMPLETE_PHANTOM,{session_id:e,wallet_address:t});if(l)H.current&&!H.current.closed&&H.current.close(),await B();else throw Error((null==a?void 0:a.error)||"Failed to complete Phantom wallet connection")}catch(e){console.error("Phantom connection completion error:",e),_("error"),W((null==e?void 0:e.message)||"Failed to complete wallet connection")}},q=async()=>{if(!T||!F)return void W("Recipient and amount are required");try{W(""),I("");let{data:e,success:t}=await r.FH.post(r.Sn.WALLET.SEND,{recipient_address:T,amount:F,token:O,wallet_type:"internal"});if(t){I((null==e?void 0:e.message)||(null==e?void 0:e.tx_hash)||"Transaction submitted");let t=await r.FH.get(r.Sn.WALLET.DATA);t.success&&D(t.data)}else throw Error((null==e?void 0:e.error)||"Transaction failed")}catch(e){console.error("Send transaction error:",e),W((null==e?void 0:e.message)||"Failed to send transaction"),I("Failed to send transaction")}};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h1",{className:"text-2xl font-mono text-red-300",children:"Wallet Dashboard"}),C&&(0,l.jsx)("p",{className:"text-red-500",children:C}),E?(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"border border-red-800 rounded p-4",children:[(0,l.jsx)("h2",{className:"text-red-400 mb-2",children:"Internal Wallet"}),(0,l.jsxs)("p",{className:"text-sm break-all",children:["Address: ",(0,l.jsx)("span",{className:"text-white",children:null==(e=E.internal_wallet)?void 0:e.address})]}),(0,l.jsxs)("p",{className:"text-sm",children:[(0,l.jsx)("span",{className:"text-purple-400",children:"◎ SOL"}),": ",(null==(a=E.internal_wallet)||null==(t=a.balances)?void 0:t.sol)||"0.00"]}),(0,l.jsxs)("p",{className:"text-sm",children:[(0,l.jsx)("span",{className:"text-green-400",children:"$ USDC"}),": ",(null==(m=E.internal_wallet)||null==(c=m.balances)?void 0:c.usdc)||"0.00"]}),(0,l.jsxs)("p",{className:"text-sm",children:[(0,l.jsx)("span",{className:"text-orange-400",children:"\uD83E\uDD6D Mango Balance"}),": $","number"==typeof(null==(x=E.mango_balance)?void 0:x.total_value)?E.mango_balance.total_value.toFixed(2):"0.00"]}),(0,l.jsx)("div",{className:"mt-2 p-2 bg-gradient-to-r from-blue-900/30 to-indigo-900/30 rounded-lg border border-blue-700",children:(0,l.jsx)("p",{className:"text-xs text-blue-400 font-mono break-all",children:u(null==(h=E.internal_wallet)?void 0:h.address)})}),(0,l.jsx)("p",{className:"text-yellow-400 text-xs mt-2",children:"^^This is your internal wallet address. Verify it with Grace. Copy to use for deposits, trading, or transfers."}),(0,l.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,l.jsx)("h3",{className:"text-sm text-red-400",children:"Send from Internal Wallet"}),(0,l.jsx)("input",{className:"w-full p-2 bg-white/10 text-white rounded",placeholder:"Recipient Address",value:T,onChange:e=>L(e.target.value)}),(0,l.jsx)("input",{className:"w-full p-2 bg-white/10 text-white rounded",placeholder:"Amount",value:F,onChange:e=>P(e.target.value)}),(0,l.jsxs)("select",{className:"w-full p-2 bg-white/10 text-white rounded",value:O,onChange:e=>R(e.target.value),children:[(0,l.jsx)("option",{value:"sol",children:"SOL"}),(0,l.jsx)("option",{value:"usdc",children:"USDC"})]}),(0,l.jsx)("button",{onClick:q,className:"w-full rounded bg-red-700 px-4 py-2 text-sm hover:bg-red-900",children:"Send"}),k&&(0,l.jsx)("p",{className:"text-sm text-green-400",children:k})]})]}),(0,l.jsxs)("div",{className:"border border-red-800 rounded p-4",children:[(0,l.jsx)("h2",{className:"text-red-400 mb-2",children:"Phantom Wallet"}),(null==(p=E.phantom_wallet)?void 0:p.address)?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"text-sm break-all",children:["Address: ",(0,l.jsx)("span",{className:"text-white",children:null==(g=E.phantom_wallet)?void 0:g.address})]}),(0,l.jsxs)("p",{className:"text-sm",children:[(0,l.jsx)("span",{className:"text-purple-400",children:"◎ SOL"}),": ",(null==(b=E.phantom_wallet)||null==(w=b.balances)?void 0:w.sol)||"0.00"]}),(0,l.jsxs)("p",{className:"text-sm",children:[(0,l.jsx)("span",{className:"text-green-400",children:"$ USDC"}),": ",(null==(v=E.phantom_wallet)||null==(N=v.balances)?void 0:N.usdc)||"0.00"]})]}),(0,l.jsx)("button",{onClick:$,className:"bg-red-900 hover:bg-red-800 text-xs px-2 py-1 rounded",children:"Disconnect"})]}),(0,l.jsxs)("div",{className:"mt-4 p-3 bg-gradient-to-r from-purple-900/30 to-pink-900/30 rounded-lg border border-purple-700",children:[(0,l.jsx)("h3",{className:"text-pink-400 text-sm font-bold mb-2",children:"\uD83D\uDD25 CRYPTO BRO ADDRESS \uD83D\uDD25"}),(0,l.jsx)("div",{className:"bg-black/50 p-2 rounded",children:(0,l.jsx)("p",{className:"text-sm font-mono text-green-400 break-all",children:u(null==(f=E.phantom_wallet)?void 0:f.address)})}),(0,l.jsx)("p",{className:"text-xs text-gray-400 mt-1 text-center",children:"Full address for crypto operations"})]})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{onClick:Y,className:"mt-2 rounded bg-red-700 px-4 py-2 text-sm hover:bg-red-900",disabled:"connecting"===S,children:"connecting"===S?"Connecting...":"Connect Phantom"}),"connecting"===S&&(0,l.jsx)("p",{className:"text-xs text-yellow-300 mt-1",children:"Waiting for Phantom authorization. Please complete the process in the popup window."}),"timeout"===S&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("p",{className:"text-xs text-orange-400 mb-1",children:"Connection timed out. Did you close the popup window?"}),(0,l.jsx)("button",{onClick:Y,className:"text-xs bg-orange-900 hover:bg-orange-800 px-2 py-1 rounded",children:"Retry Connection"})]}),"error"===S&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("p",{className:"text-xs text-red-400 mb-1",children:"Connection failed. Please try again."}),(0,l.jsx)("button",{onClick:Y,className:"text-xs bg-red-900 hover:bg-red-800 px-2 py-1 rounded",children:"Retry Connection"})]})]})]})]}):(0,l.jsx)("p",{className:"text-gray-400",children:"Loading wallet info..."}),(0,l.jsxs)("div",{className:"mt-6 border border-red-800 rounded p-4",children:[(0,l.jsx)("h2",{className:"text-xl font-mono text-red-300 mb-4",children:"Your Trading Positions"}),(0,l.jsx)(d.A,{initialExpanded:!0,refreshInterval:6e4})]}),(0,l.jsxs)("div",{className:"mt-6 border border-blue-800 rounded p-4",children:[(0,l.jsx)("h2",{className:"text-xl font-mono text-blue-300 mb-4",children:"Wallet Debugger"}),(0,l.jsx)(i,{})]})]})}},8966:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/wallet",function(){return a(4707)}])}},e=>{e.O(0,[447,636,593,792],()=>e(e.s=8966)),_N_E=e.O()}]);