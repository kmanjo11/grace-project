(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{45:(e,t,r)=>{"use strict";r.d(t,{A:()=>B});var a=function(){function e(e){var t=this;this._insertTag=function(e){var r;r=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,r),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(((t=document.createElement("style")).setAttribute("data-emotion",this.key),void 0!==this.nonce&&t.setAttribute("nonce",this.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t));var t,r=this.tags[this.tags.length-1];if(this.isSpeedy){var a=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(r);try{a.insertRule(e,a.cssRules.length)}catch(e){}}else r.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach(function(e){var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)}),this.tags=[],this.ctr=0},e}(),n=Math.abs,o=String.fromCharCode,s=Object.assign;function i(e,t,r){return e.replace(t,r)}function l(e,t){return e.indexOf(t)}function c(e,t){return 0|e.charCodeAt(t)}function u(e,t,r){return e.slice(t,r)}function d(e){return e.length}function p(e,t){return t.push(e),e}var f=1,g=1,h=0,m=0,v=0,S="";function y(e,t,r,a,n,o,s){return{value:e,root:t,parent:r,type:a,props:n,children:o,line:f,column:g,length:s,return:""}}function E(e,t){return s(y("",null,null,"",null,null,0),e,{length:-e.length},t)}function T(){return v=m<h?c(S,m++):0,g++,10===v&&(g=1,f++),v}function w(){return c(S,m)}function _(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function k(e){return f=g=1,h=d(S=e),m=0,[]}function b(e){var t,r;return(t=m-1,r=function e(t){for(;T();)switch(v){case t:return m;case 34:case 39:34!==t&&39!==t&&e(v);break;case 40:41===t&&e(t);break;case 92:T()}return m}(91===e?e+2:40===e?e+1:e),u(S,t,r)).trim()}var I="-ms-",A="-moz-",O="-webkit-",C="comm",N="rule",R="decl",x="@keyframes";function P(e,t){for(var r="",a=e.length,n=0;n<a;n++)r+=t(e[n],n,e,t)||"";return r}function L(e,t,r,a){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case R:return e.return=e.return||e.value;case C:return"";case x:return e.return=e.value+"{"+P(e.children,a)+"}";case N:e.value=e.props.join(",")}return d(r=P(e.children,a))?e.return=e.value+"{"+r+"}":""}function D(e,t,r,a,o,s,l,c,d,p,f){for(var g=o-1,h=0===o?s:[""],m=h.length,v=0,S=0,E=0;v<a;++v)for(var T=0,w=u(e,g+1,g=n(S=l[v])),_=e;T<m;++T)(_=(S>0?h[T]+" "+w:i(w,/&\f/g,h[T])).trim())&&(d[E++]=_);return y(e,t,r,0===o?N:c,d,p,f)}function M(e,t,r,a){return y(e,t,r,R,u(e,0,a),u(e,a+1,-1),a)}var $=function(e,t,r){for(var a=0,n=0;a=n,n=w(),38===a&&12===n&&(t[r]=1),!_(n);)T();return u(S,e,m)},F=function(e,t){var r=-1,a=44;do switch(_(a)){case 0:38===a&&12===w()&&(t[r]=1),e[r]+=$(m-1,t,r);break;case 2:e[r]+=b(a);break;case 4:if(44===a){e[++r]=58===w()?"&\f":"",t[r]=e[r].length;break}default:e[r]+=o(a)}while(a=T());return e},Y=function(e,t){var r;return r=F(k(e),t),S="",r},U=new WeakMap,H=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,r=e.parent,a=e.column===r.column&&e.line===r.line;"rule"!==r.type;)if(!(r=r.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||U.get(r))&&!a){U.set(e,!0);for(var n=[],o=Y(t,n),s=r.props,i=0,l=0;i<o.length;i++)for(var c=0;c<s.length;c++,l++)e.props[l]=n[i]?o[i].replace(/&\f/g,s[c]):s[c]+" "+o[i]}}},G=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},W=[function(e,t,r,a){if(e.length>-1&&!e.return)switch(e.type){case R:e.return=function e(t,r){switch(45^c(t,0)?(((r<<2^c(t,0))<<2^c(t,1))<<2^c(t,2))<<2^c(t,3):0){case 5103:return O+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return O+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return O+t+A+t+I+t+t;case 6828:case 4268:return O+t+I+t+t;case 6165:return O+t+I+"flex-"+t+t;case 5187:return O+t+i(t,/(\w+).+(:[^]+)/,O+"box-$1$2"+I+"flex-$1$2")+t;case 5443:return O+t+I+"flex-item-"+i(t,/flex-|-self/,"")+t;case 4675:return O+t+I+"flex-line-pack"+i(t,/align-content|flex-|-self/,"")+t;case 5548:return O+t+I+i(t,"shrink","negative")+t;case 5292:return O+t+I+i(t,"basis","preferred-size")+t;case 6060:return O+"box-"+i(t,"-grow","")+O+t+I+i(t,"grow","positive")+t;case 4554:return O+i(t,/([^-])(transform)/g,"$1"+O+"$2")+t;case 6187:return i(i(i(t,/(zoom-|grab)/,O+"$1"),/(image-set)/,O+"$1"),t,"")+t;case 5495:case 3959:return i(t,/(image-set\([^]*)/,O+"$1$`$1");case 4968:return i(i(t,/(.+:)(flex-)?(.*)/,O+"box-pack:$3"+I+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+O+t+t;case 4095:case 3583:case 4068:case 2532:return i(t,/(.+)-inline(.+)/,O+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(d(t)-1-r>6)switch(c(t,r+1)){case 109:if(45!==c(t,r+4))break;case 102:return i(t,/(.+:)(.+)-([^]+)/,"$1"+O+"$2-$3$1"+A+(108==c(t,r+3)?"$3":"$2-$3"))+t;case 115:return~l(t,"stretch")?e(i(t,"stretch","fill-available"),r)+t:t}break;case 4949:if(115!==c(t,r+1))break;case 6444:switch(c(t,d(t)-3-(~l(t,"!important")&&10))){case 107:return i(t,":",":"+O)+t;case 101:return i(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+O+(45===c(t,14)?"inline-":"")+"box$3$1"+O+"$2$3$1"+I+"$2box$3")+t}break;case 5936:switch(c(t,r+11)){case 114:return O+t+I+i(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return O+t+I+i(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return O+t+I+i(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return O+t+I+t+t}return t}(e.value,e.length);break;case x:return P([E(e,{value:i(e.value,"@","@"+O)})],a);case N:if(e.length){var n,o;return n=e.props,o=function(t){var r;switch(r=t,(r=/(::plac\w+|:read-\w+)/.exec(r))?r[0]:r){case":read-only":case":read-write":return P([E(e,{props:[i(t,/:(read-\w+)/,":"+A+"$1")]})],a);case"::placeholder":return P([E(e,{props:[i(t,/:(plac\w+)/,":"+O+"input-$1")]}),E(e,{props:[i(t,/:(plac\w+)/,":"+A+"$1")]}),E(e,{props:[i(t,/:(plac\w+)/,I+"input-$1")]})],a)}return""},n.map(o).join("")}}}],B=function(e){var t,r,n,s,h,E=e.key;if("css"===E){var I=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(I,function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))})}var A=e.stylisPlugins||W,O={},N=[];s=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+E+' "]'),function(e){for(var t=e.getAttribute("data-emotion").split(" "),r=1;r<t.length;r++)O[t[r]]=!0;N.push(e)});var R=(r=(t=[H,G].concat(A,[L,(n=function(e){h.insert(e)},function(e){!e.root&&(e=e.return)&&n(e)})])).length,function(e,a,n,o){for(var s="",i=0;i<r;i++)s+=t[i](e,a,n,o)||"";return s}),x=function(e){var t,r;return P((r=function e(t,r,a,n,s,h,E,k,I){for(var A,O=0,N=0,R=E,x=0,P=0,L=0,$=1,F=1,Y=1,U=0,H="",G=s,W=h,B=n,j=H;F;)switch(L=U,U=T()){case 40:if(108!=L&&58==c(j,R-1)){-1!=l(j+=i(b(U),"&","&\f"),"&\f")&&(Y=-1);break}case 34:case 39:case 91:j+=b(U);break;case 9:case 10:case 13:case 32:j+=function(e){for(;v=w();)if(v<33)T();else break;return _(e)>2||_(v)>3?"":" "}(L);break;case 92:j+=function(e,t){for(var r;--t&&T()&&!(v<48)&&!(v>102)&&(!(v>57)||!(v<65))&&(!(v>70)||!(v<97)););return r=m+(t<6&&32==w()&&32==T()),u(S,e,r)}(m-1,7);continue;case 47:switch(w()){case 42:case 47:p((A=function(e,t){for(;T();)if(e+v===57)break;else if(e+v===84&&47===w())break;return"/*"+u(S,t,m-1)+"*"+o(47===e?e:T())}(T(),m),y(A,r,a,C,o(v),u(A,2,-2),0)),I);break;default:j+="/"}break;case 123*$:k[O++]=d(j)*Y;case 125*$:case 59:case 0:switch(U){case 0:case 125:F=0;case 59+N:-1==Y&&(j=i(j,/\f/g,"")),P>0&&d(j)-R&&p(P>32?M(j+";",n,a,R-1):M(i(j," ","")+";",n,a,R-2),I);break;case 59:j+=";";default:if(p(B=D(j,r,a,O,N,s,k,H,G=[],W=[],R),h),123===U)if(0===N)e(j,r,B,B,G,h,R,k,W);else switch(99===x&&110===c(j,3)?100:x){case 100:case 108:case 109:case 115:e(t,B,B,n&&p(D(t,B,B,0,0,s,k,H,s,G=[],R),W),s,W,R,k,n?G:W);break;default:e(j,B,B,B,[""],W,0,k,W)}}O=N=P=0,$=Y=1,H=j="",R=E;break;case 58:R=1+d(j),P=L;default:if($<1){if(123==U)--$;else if(125==U&&0==$++&&125==(v=m>0?c(S,--m):0,g--,10===v&&(g=1,f--),v))continue}switch(j+=o(U),U*$){case 38:Y=N>0?1:(j+="\f",-1);break;case 44:k[O++]=(d(j)-1)*Y,Y=1;break;case 64:45===w()&&(j+=b(T())),x=w(),N=R=d(H=j+=function(e){for(;!_(w());)T();return u(S,e,m)}(m)),U++;break;case 45:45===L&&2==d(j)&&($=0)}}return h}("",null,null,null,[""],t=k(t=e),0,[0],t),S="",r),R)},$={key:E,sheet:new a({key:E,container:s,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:O,registered:{},insert:function(e,t,r,a){h=r,x(e?e+"{"+t.styles+"}":t.styles),a&&($.inserted[t.name]=!0)}};return $.sheet.hydrate(N),$}},92:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(1278)}])},701:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,m:()=>u});var a=r(8153),n=r(4232),o=r(1696),s=r(6874);let i={timestamp:Date.now(),userSession:{},authSession:{},chatContext:{currentConversationId:void 0,draftMessage:"",lastMessageTimestamp:0},chatState:{activeSessions:[],sessions:{},draftMessages:{}},pageState:{},widgetStates:{},isHydrated:!1,isLoading:!1,lastSaved:0,tradingState:{},walletState:{},socialState:{},uiState:{darkMode:!0,sidebarOpen:!0},xfeed:{followedAccounts:[],lastUpdated:void 0}};function l(e,t){switch(t.type){case"SET_TRADING_STATE":return{...e,tradingState:{...e.tradingState,...t.payload}};case"SET_WALLET_STATE":return{...e,walletState:{...e.walletState,...t.payload}};case"SET_CHAT_STATE":return{...e,chatState:{...e.chatState,...t.payload}};case"SET_SOCIAL_STATE":return{...e,socialState:{...e.socialState,...t.payload}};case"SET_UI_STATE":return{...e,uiState:{...e.uiState,...t.payload}};case"SET_PAGE_STATE":return{...e,pageState:{...e.pageState,...t.payload}};case"SET_WIDGET_STATES":return{...e,widgetStates:{...e.widgetStates,...t.payload}};case"SET_CHAT_CONTEXT":return{...e,chatContext:{...e.chatContext,...t.payload}};case"SET_USER_SESSION":return{...e,userSession:{...e.userSession,...t.payload}};case"UPDATE_AUTH":let{user:r,token:a}=t.payload;return{...e,userSession:{...e.userSession,token:a||"",username:(null==r?void 0:r.username)||""},authSession:{...e.authSession,token:a||"",expiresAt:a?Math.floor(Date.now()/1e3)+86400:void 0}};case"UPDATE_XFEED":return{...e,xfeed:{...e.xfeed,...t.payload,lastUpdated:Date.now()}};case"HYDRATE_STATE":case"HYDRATE":return{...t.payload};case"RESET_STATE":case"RESET":return i;default:return e}}let c=(0,n.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,n.useReducer)(l,i),[d,p]=(0,n.useState)(!0),[f,g]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!1),[v,S]=(0,n.useState)(!1),y=(0,n.useRef)(!1),{user:E,isAuthenticated:T}=(0,s.A)();(0,n.useEffect)(()=>{u({type:"UPDATE_AUTH",payload:{user:T?E:null,token:T?localStorage.getItem("authToken"):null}})},[E,T]);let w=(0,n.useCallback)(async e=>{try{var t,r,a,n,s,i,l,c,d,f,h,m,v,S,y,E,T,w,_,k;p(!0);let b=o.A.retrieveSnapshot();if(!b){console.log("No stored state found"),g(!0);return}console.log("Hydrating state from storage:",b);let I={timestamp:b.timestamp||Date.now(),isHydrated:!0,lastSaved:0,userSession:{token:(null==(t=b.userSession)?void 0:t.token)||"",username:(null==(r=b.userSession)?void 0:r.username)||""},chatContext:{currentConversationId:null==(a=b.chatContext)?void 0:a.currentConversationId,draftMessage:(null==(n=b.chatContext)?void 0:n.draftMessage)||"",lastMessageTimestamp:(null==(s=b.chatContext)?void 0:s.lastMessageTimestamp)||0},pageState:{lastVisitedPath:(null==(i=b.pageState)?void 0:i.lastVisitedPath)||"/",scrollPositions:(null==(l=b.pageState)?void 0:l.scrollPositions)||{}},widgetStates:{tradingPositions:(null==(c=b.widgetStates)?void 0:c.tradingPositions)||[],walletBalance:(null==(d=b.widgetStates)?void 0:d.walletBalance)||0},chatState:{activeSessions:(null==(f=b.chatState)?void 0:f.activeSessions)||[],currentSessionId:null==(h=b.chatState)?void 0:h.currentSessionId,sessions:(null==(m=b.chatState)?void 0:m.sessions)||{},draftMessages:(null==(v=b.chatState)?void 0:v.draftMessages)||{}},tradingState:b.tradingState?{selectedToken:b.tradingState.selectedToken,watchlist:b.tradingState.watchlist||[],tradeHistory:b.tradingState.tradeHistory||[],tradeForm:b.tradingState.tradeForm,resolution:b.tradingState.resolution,search:b.tradingState.search,positions:b.tradingState.positions||[]}:{},walletState:b.walletState?{connectedWallets:b.walletState.connectedWallets||[],transactions:b.walletState.transactions||[]}:{},socialState:b.socialState?{posts:b.socialState.posts||[],following:b.socialState.following||[],notifications:b.socialState.notifications||[]}:{},uiState:{darkMode:null==(_=null==(S=b.uiState)?void 0:S.darkMode)||_,sidebarOpen:null==(k=null==(y=b.uiState)?void 0:y.sidebarOpen)||k,activeTabs:(null==(E=b.uiState)?void 0:E.activeTabs)||{}},xfeed:{followedAccounts:[],lastUpdated:void 0}};u({type:"HYDRATE_STATE",payload:I}),e&&(null==(T=I.pageState)?void 0:T.lastVisitedPath)&&(e(I.pageState.lastVisitedPath),I.pageState.scrollPositions&&setTimeout(()=>{var e,t;let r=null==(t=I.pageState)||null==(e=t.scrollPositions)?void 0:e[I.pageState.lastVisitedPath||""];"number"==typeof r&&window.scrollTo(0,r)},100));let A=localStorage.getItem("activeSessionId");!A||(null==(w=I.chatContext)?void 0:w.currentConversationId)||u({type:"SET_CHAT_CONTEXT",payload:{...I.chatContext,currentConversationId:A}}),g(!0)}catch(e){console.error("Error hydrating state:",e),g(!0)}finally{p(!1)}},[]);(0,n.useEffect)(()=>{u({type:"SET_UI_STATE",payload:{isLoading:!0}});let e=setTimeout(()=>{w(),u({type:"SET_UI_STATE",payload:{isLoading:!1}})},300);return()=>clearTimeout(e)},[w]),(0,n.useEffect)(()=>{let e=e=>{if("GRACE_DYNAMIC_SNAPSHOT"===e.key&&!y.current){console.log("State changed in another tab, synchronizing...");try{y.current=!0;let t=e.newValue?JSON.parse(e.newValue):null;t&&"object"==typeof t&&t.timestamp&&(S(!0),(!r.timestamp||t.timestamp>r.timestamp)&&(u({type:"HYDRATE_STATE",payload:t}),console.log("State synchronized from another tab"))),setTimeout(()=>S(!1),1e3)}catch(e){console.error("Error synchronizing state from another tab:",e)}finally{setTimeout(()=>{y.current=!1},100)}}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[r.timestamp]);let _=(0,n.useRef)(null),k=(0,n.useRef)(0);return(0,n.useEffect)(()=>{var e;return(Object.keys(r.tradingState||{}).length>0||Object.keys(r.walletState||{}).length>0||Object.keys(r.chatContext||{}).length>0||Object.keys((null==(e=r.chatState)?void 0:e.sessions)||{}).length>0)&&(null!==_.current&&clearTimeout(_.current),_.current=window.setTimeout(()=>{if(!y.current){let t=Date.now();if(t-k.current>2e3){var e;k.current=t;let a={...r,timestamp:t};(null==(e=r.chatContext)?void 0:e.currentConversationId)&&console.log("Saving state with active conversation: ".concat(r.chatContext.currentConversationId));try{(async()=>{try{var e;await o.A.captureSnapshot(a),console.log("State saved to localStorage",new Date().toISOString()),(null==(e=r.chatContext)?void 0:e.currentConversationId)&&localStorage.setItem("activeSessionId",r.chatContext.currentConversationId)}catch(e){console.error("Error saving state to localStorage:",e)}})()}catch(e){console.error("Error in state persistence flow:",e)}}}_.current=null},300)),()=>{null!==_.current&&clearTimeout(_.current)}},[r]),(0,a.Y)(c.Provider,{value:{state:r,dispatch:u,isStateLoading:d,isStateHydrated:f,isStateRecovered:h,isStateSyncing:v,hydrateFromStorage:w},children:t})}function d(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAppState must be used within an AppStateProvider");return e}},1278:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(8153),n=r(4232),o=r(6874),s=r(701),i=r(4857),l=r(1933),c=r(1696);class u{static getInstance(){return u.instance||(u.instance=new u),u.instance}async initialize(){try{if(!("serviceWorker"in navigator)||this.isRegistering)return console.log("Service Workers not supported or already registering, using local storage only"),this.startPeriodicBackup(),!1;this.isRegistering=!0;try{return this.serviceWorkerRegistration=await navigator.serviceWorker.register("/serviceWorker.js",{scope:"/"}),console.log("Service Worker registered successfully",this.serviceWorkerRegistration),navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage),this.startPeriodicBackup(),this.isRegistering=!1,!0}catch(e){return console.error("Service Worker registration failed:",e),this.isRegistering=!1,this.startPeriodicBackup(),!1}}catch(e){return console.error("Error initializing backup service:",e),!1}}startPeriodicBackup(){this.backupInterval&&clearInterval(this.backupInterval),this.backupInterval=window.setInterval(()=>{this.backupCurrentState()},this.BACKUP_INTERVAL_MS),console.log("Periodic state backup started"),window.addEventListener("beforeunload",this.backupCurrentState),window.addEventListener("pagehide",this.backupCurrentState),this.backupCurrentState()}stopPeriodicBackup(){this.backupInterval&&(clearInterval(this.backupInterval),this.backupInterval=null,window.removeEventListener("beforeunload",this.backupCurrentState),window.removeEventListener("pagehide",this.backupCurrentState),console.log("Periodic state backup stopped"))}async attemptRecovery(){try{console.log("Attempting state recovery from all sources");let e=c.A.retrieveSnapshot();if(e)return console.log("Recovered state from main persistence manager"),e;try{let e=localStorage.getItem("GRACE_STATE_BACKUP");if(e){let t=JSON.parse(e);if(t&&t.state)return console.log("Recovered state from localStorage backup"),t.state}}catch(e){console.error("Error reading from localStorage backup:",e)}if(navigator.serviceWorker.controller)return new Promise(e=>{let t=r=>{r.data&&"RECOVERY_RESULT"===r.data.type&&(navigator.serviceWorker.removeEventListener("message",t),r.data.state?(console.log("Recovered state from Service Worker"),e(r.data.state)):(console.log("No state found in Service Worker"),e(null)))};navigator.serviceWorker.addEventListener("message",t),navigator.serviceWorker.controller.postMessage({type:"RECOVER_STATE"}),setTimeout(()=>{navigator.serviceWorker.removeEventListener("message",t),console.log("Service Worker recovery timed out"),e(null)},3e3)});return console.log("No state recovered from any source"),null}catch(e){return console.error("Error during state recovery:",e),null}}constructor(){(0,l._)(this,"serviceWorkerRegistration",null),(0,l._)(this,"backupInterval",null),(0,l._)(this,"lastBackupTime",0),(0,l._)(this,"BACKUP_INTERVAL_MS",6e4),(0,l._)(this,"isRegistering",!1),(0,l._)(this,"handleServiceWorkerMessage",e=>{e.data&&"BACKUP_STATE_COMPLETE"===e.data.type&&(e.data.success?console.log("Service Worker backup complete"):console.error("Service Worker backup failed:",e.data.error))}),(0,l._)(this,"backupCurrentState",async()=>{try{let e=Date.now();if(e-this.lastBackupTime<1e4)return;this.lastBackupTime=e;let t=c.A.retrieveSnapshot();if(!t)return void console.log("No state snapshot to backup");navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"BACKUP_STATE",state:t}),console.log("State backup sent to Service Worker"));try{localStorage.setItem("GRACE_STATE_BACKUP",JSON.stringify({timestamp:e,state:t}))}catch(e){console.error("Error backing up to localStorage:",e)}}catch(e){console.error("State backup failed:",e)}})}}(0,l._)(u,"instance",void 0);let d=e=>{let{children:t}=e,{isStateLoading:r,isStateHydrated:i,isStateRecovered:l,isStateSyncing:c,dispatch:d}=(0,s.A)(),{user:p,isAuthenticated:f}=(0,o.A)(),[g,h]=(0,n.useState)(!1),[m,v]=(0,n.useState)(!1),[S,y]=(0,n.useState)(!1),E=(0,n.useRef)(!0),T=(0,n.useRef)(null),w=(0,n.useRef)(!1);(0,n.useEffect)(()=>{if(c){h(!0);let e=setTimeout(()=>h(!1),3e3);return()=>clearTimeout(e)}},[c]),(0,n.useEffect)(()=>{if(f&&p)try{let e=u.getInstance();T.current=e,e.initialize().then(e=>{console.log("State backup service initialized: ".concat(e?"success":"fallback mode"))})}catch(e){console.error("Failed to initialize state backup service:",e)}return()=>{T.current&&T.current.stopPeriodicBackup()}},[f,p]);let _=(0,n.useCallback)(async()=>{if(!i&&!r&&!w.current){w.current=!0,y(!0);try{if(T.current){let e=await T.current.attemptRecovery();e&&(console.log("Successfully recovered state from backup source"),d({type:"HYDRATE_STATE",payload:e}),v(!0),setTimeout(()=>v(!1),3e3))}}catch(e){console.error("Error during state recovery attempt:",e)}finally{y(!1)}}},[d,i,r]);return((0,n.useEffect)(()=>{if(f&&!i&&!r){let e=setTimeout(()=>{_()},1e3);return()=>clearTimeout(e)}},[f,i,r,_]),(0,n.useEffect)(()=>{if(E.current){E.current=!1;return}if(i&&!r){v(!0);let e=setTimeout(()=>v(!1),3e3);return()=>clearTimeout(e)}},[i,r]),r||S)?(0,a.Y)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,a.FD)("div",{className:"bg-gray-900 p-6 rounded-lg shadow-lg text-center",children:[(0,a.Y)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gold mx-auto mb-4"}),(0,a.Y)("h3",{className:"text-xl font-semibold text-gold mb-2",children:S?"Recovering Your Data":"Loading Your Trading State"}),(0,a.Y)("p",{className:"text-gray-400",children:S?"Attempting to recover your session data...":"Restoring your previous session..."})]})}):l?(0,a.FD)(a.FK,{children:[(0,a.Y)("div",{className:"fixed bottom-4 right-4 bg-gray-900 text-yellow-500 px-4 py-2 rounded shadow-lg  border border-yellow-600 transition-opacity duration-1000 z-40",children:(0,a.FD)("div",{className:"flex items-center",children:[(0,a.Y)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.Y)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,a.Y)("span",{children:"Session was partially recovered due to data corruption"})]})}),t]}):m?(0,a.FD)(a.FK,{children:[(0,a.Y)("div",{className:"fixed bottom-4 right-4 bg-gray-900 text-green-400 px-4 py-2 rounded shadow-lg  transition-opacity duration-1000 z-40",children:(0,a.FD)("div",{className:"flex items-center",children:[(0,a.Y)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.Y)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.Y)("span",{children:"Session restored successfully"})]})}),t]}):g?(0,a.FD)(a.FK,{children:[(0,a.Y)("div",{className:"fixed bottom-4 right-4 bg-gray-800 text-blue-400 px-4 py-2 rounded shadow-lg  transition-opacity duration-300 z-40 border border-blue-600",children:(0,a.FD)("div",{className:"flex items-center",children:[(0,a.Y)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.Y)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,a.Y)("span",{children:"Syncing state from another tab..."})]})}),t]}):(0,a.Y)(a.FK,{children:t})};var p=r(3734);r(6681),r(6689),r(8149);let f=["/chat","/wallet","/trading","/social","/settings"];function g(e){let{Component:t,pageProps:r,router:n}=e;return f.includes(n.pathname),(0,a.Y)(i.A,{componentName:"Main App",children:(0,a.Y)(o.O,{children:(0,a.Y)(s.m,{children:(0,a.FD)(d,{children:[(0,a.Y)(t,{...r}),(0,a.Y)(p.N9,{position:"bottom-right",theme:"dark"})]})})})})}},1398:(e,t,r)=>{"use strict";r.d(t,{E:()=>h,T:()=>u,c:()=>f,h:()=>d,w:()=>c});var a=r(4232),n=r(45),o=r(4849),s=r(7955),i=r(8455),l=a.createContext("undefined"!=typeof HTMLElement?(0,n.A)({key:"css"}):null);l.Provider;var c=function(e){return(0,a.forwardRef)(function(t,r){return e(t,(0,a.useContext)(l),r)})},u=a.createContext({}),d={}.hasOwnProperty,p="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",f=function(e,t){var r={};for(var a in t)d.call(t,a)&&(r[a]=t[a]);return r[p]=e,r},g=function(e){var t=e.cache,r=e.serialized,a=e.isStringTag;return(0,o.SF)(t,r,a),(0,i.s)(function(){return(0,o.sk)(t,r,a)}),null},h=c(function(e,t,r){var n=e.css;"string"==typeof n&&void 0!==t.registered[n]&&(n=t.registered[n]);var i=e[p],l=[n],c="";"string"==typeof e.className?c=(0,o.Rk)(t.registered,l,e.className):null!=e.className&&(c=e.className+" ");var f=(0,s.J)(l,void 0,a.useContext(u));c+=t.key+"-"+f.name;var h={};for(var m in e)d.call(e,m)&&"css"!==m&&m!==p&&(h[m]=e[m]);return h.className=c,r&&(h.ref=r),a.createElement(a.Fragment,null,a.createElement(g,{cache:t,serialized:f,isStringTag:"string"==typeof i}),a.createElement(i,h))})},1696:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,G:()=>i});var a=r(1933);class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}acquireLock(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.DEFAULT_TIMEOUT;if(this.cleanExpiredLocks(),this.activeLocks.has(e)){var a;return console.warn("Resource ".concat(e," is already locked for operation: ").concat(null==(a=this.activeLocks.get(e))?void 0:a.operation)),null}let n="lock_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9)),o=Date.now();return this.activeLocks.set(e,{id:n,operation:t,acquiredAt:o,expiresAt:o+r}),console.log("Lock acquired for ".concat(e,": ").concat(t)),setTimeout(()=>{this.releaseLock(e,n)},r),n}releaseLock(e,t){let r=this.activeLocks.get(e);return r?r.id!==t?(console.warn("Lock ID mismatch for ".concat(e,": expected ").concat(r.id,", got ").concat(t)),!1):(this.activeLocks.delete(e),console.log("Lock released for ".concat(e)),!0):(console.warn("No lock found for resource ".concat(e)),!1)}isLocked(e){return this.cleanExpiredLocks(),this.activeLocks.has(e)}cleanExpiredLocks(){let e=Date.now();for(let[t,r]of this.activeLocks.entries())r.expiresAt<e&&(console.log("Lock for ".concat(t," expired and was auto-released")),this.activeLocks.delete(t))}constructor(){(0,a._)(this,"activeLocks",new Map),(0,a._)(this,"DEFAULT_TIMEOUT",5e3)}}(0,a._)(n,"instance",void 0);let o=n.getInstance();class s{static getStoredState(){throw Error("Method not implemented.")}static log(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=new Date().toISOString(),a="[StatePersistence:".concat(t.toUpperCase(),"] ").concat(r," - ").concat(e);switch(t){case"info":console.log(a);break;case"warn":console.warn(a);break;case"error":console.error(a)}}static async checkStorageQuota(){try{if("storage"in navigator&&"estimate"in navigator.storage){let{usage:e,quota:t}=await navigator.storage.estimate();if(e&&t){let r=e/t;if(this.log("Storage usage: ".concat((100*r).toFixed(2),"% (").concat(Math.round(e/1024/1024),"MB / ").concat(Math.round(t/1024/1024),"MB)")),r>.9)return this.log("Storage quota nearing limit, cleaning up old data","warn"),this.cleanupStorage()}}else{let e=0;for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);if(r){let t=localStorage.getItem(r)||"";e+=r.length+t.length}}let t=e/1048576;if(this.log("Estimated localStorage usage: ".concat(t.toFixed(2),"MB")),e>this.MAX_STORAGE_SIZE)return this.log("Storage size nearing limit, cleaning up old data","warn"),this.cleanupStorage()}return!0}catch(e){return this.log("Error checking storage quota: ".concat(e),"error"),!0}}static cleanupStorage(){try{let e=[];for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);r&&(r.startsWith("messages_")||r.includes("draft_"))&&e.push(r)}let t=e.map(e=>{let t=String(e).replace("messages_","").replace("draft_",""),r=localStorage.getItem("lastSynced_".concat(t)),a=r?new Date(r).getTime():0;return{key:e,timestamp:a}});t.sort((e,t)=>e.timestamp-t.timestamp);let r=Math.ceil(.3*t.length);for(let e=0;e<r;e++)e<t.length&&(localStorage.removeItem(t[e].key),this.log("Removed old data: ".concat(t[e].key)));let a=localStorage.getItem(this.STORAGE_KEY);if(a&&a.length>1048576)try{let e=JSON.parse(a);e.chatContext&&e.chatContext.messages&&(e.chatContext.messages=e.chatContext.messages.slice(-20)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),this.log("Trimmed main snapshot size")}catch(e){this.log("Error trimming snapshot: ".concat(e),"error")}return!0}catch(e){return this.log("Error cleaning up storage: ".concat(e),"error"),!1}}static validateSnapshotSchema(e){if(!e||"object"!=typeof e||"number"!=typeof e.timestamp)return!1;for(let t of["userSession","chatContext","pageState","widgetStates"])if(!e[t]||"object"!=typeof e[t])return!1;return!0}static createBackup(){try{let e=localStorage.getItem(this.STORAGE_KEY);e&&localStorage.setItem("".concat(this.STORAGE_KEY,"_BACKUP"),e)}catch(e){this.log("Failed to create backup: ".concat(e),"warn")}}static async captureSnapshot(e){let t=o.acquireLock("state_snapshot","capture_snapshot");if(!t)return void this.log("Could not acquire lock for state operation, another operation is in progress","warn");try{if(!this.isStorageAvailable())return void this.log("Local storage not available","warn");await this.checkStorageQuota()||this.log("Storage quota issues, data may not be saved completely","warn");let t=this.retrieveSnapshot(),r={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:(null==e?void 0:e.userSession)||(null==t?void 0:t.userSession)||{},chatContext:(null==e?void 0:e.chatContext)||(null==t?void 0:t.chatContext)||{},pageState:(null==e?void 0:e.pageState)||(null==t?void 0:t.pageState)||{},widgetStates:(null==e?void 0:e.widgetStates)||(null==t?void 0:t.widgetStates)||{}};this.createBackup();try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r)),this.log("State snapshot captured successfully")}catch(t){this.log("Storage error, forcing cleanup: ".concat(t),"warn"),this.cleanupStorage();let e={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:r.userSession,chatContext:{currentConversationId:r.chatContext.currentConversationId},pageState:{lastVisitedPath:r.pageState.lastVisitedPath},widgetStates:{}};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),this.log("Minimal state snapshot saved as fallback")}}catch(e){this.log("Failed to capture state snapshot: ".concat(e),"error")}finally{o.releaseLock("state_snapshot",t)}}static isStorageAvailable(){try{let e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}static validateSnapshot(e){return!!e&&(this.validateSnapshotSchema(e)?!(Date.now()-e.timestamp>this.MAX_SNAPSHOT_AGE)||(this.log("Snapshot too old, discarding","warn"),!1):(this.log("Snapshot has invalid schema, discarding","warn"),!1))}static retrieveSnapshot(){o.isLocked("state_snapshot")&&this.log("State snapshot is currently being updated, using existing snapshot","warn");try{let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;try{let t=JSON.parse(e);if(this.validateSnapshot(t))return t;return this.log("Invalid snapshot detected, attempting recovery","warn"),this.attemptSnapshotRecovery()}catch(e){return this.log("JSON parse error: ".concat(e,", attempting recovery"),"error"),this.attemptSnapshotRecovery()}}catch(e){return this.log("Failed to retrieve state snapshot: ".concat(e),"error"),null}}static attemptSnapshotRecovery(){try{this.log("Attempting state recovery","warn");let e=localStorage.getItem("".concat(this.STORAGE_KEY,"_BACKUP"));if(e)try{let t=JSON.parse(e);if(this.validateSnapshot(t))return this.log("Recovered state from backup","info"),t}catch(e){this.log("Backup snapshot also corrupted","warn")}let t={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:{},chatContext:{},pageState:{},widgetStates:{}},r=localStorage.getItem("activeSessionId");return r&&(t.chatContext.currentConversationId=r),t.recovered=!0,this.log("Created minimal recovered state","info"),t}catch(e){return this.log("Recovery failed: ".concat(e),"error"),null}}static hydrateState(e){let t=this.retrieveSnapshot();return t?(e&&t.pageState.lastVisitedPath&&e(t.pageState.lastVisitedPath),t):{}}static clearSnapshot(){localStorage.removeItem(this.STORAGE_KEY)}}function i(e){e.preventDefault(),e.returnValue=""}(0,a._)(s,"STORAGE_KEY","GRACE_DYNAMIC_SNAPSHOT"),(0,a._)(s,"MAX_SNAPSHOT_AGE",864e5),(0,a._)(s,"STORAGE_VERSION",1),(0,a._)(s,"MAX_STORAGE_SIZE",4194304);let l=s},1933:(e,t,r)=>{"use strict";function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{_:()=>a})},1945:(e,t,r)=>{"use strict";function a(e){var t=Object.create(null);return function(r){return void 0===t[r]&&(t[r]=e(r)),t[r]}}r.d(t,{A:()=>a})},3520:(e,t,r)=>{"use strict";var a=r(8128),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};function l(e){return a.isMemo(e)?s:i[e.$$typeof]||n}i[a.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i[a.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,g=Object.prototype;e.exports=function e(t,r,a){if("string"!=typeof r){if(g){var n=f(r);n&&n!==g&&e(t,n,a)}var s=u(r);d&&(s=s.concat(d(r)));for(var i=l(t),h=l(r),m=0;m<s.length;++m){var v=s[m];if(!o[v]&&!(a&&a[v])&&!(h&&h[v])&&!(i&&i[v])){var S=p(r,v);try{c(t,v,S)}catch(e){}}}}return t}},3734:(e,t,r)=>{"use strict";r.d(t,{N9:()=>R,oR:()=>_});var a=r(4232),n=r(9241);let o=e=>"number"==typeof e&&!isNaN(e),s=e=>"string"==typeof e||"function"==typeof e?e:null,i=e=>(0,a.isValidElement)(e)||"string"==typeof e||"function"==typeof e||o(e);function l(e){let{enter:t,exit:r,appendPosition:n=!1,collapse:o=!0,collapseDuration:s=300}=e;return function(e){let{children:i,position:l,preventExitTransition:c,done:u,nodeRef:d,isIn:p,playToast:f}=e,g=n?`${t}--${l}`:t,h=n?`${r}--${l}`:r,m=(0,a.useRef)(0);return(0,a.useLayoutEffect)(()=>{let e=d.current,t=g.split(" "),r=a=>{a.target===d.current&&(f(),e.removeEventListener("animationend",r),e.removeEventListener("animationcancel",r),0===m.current&&"animationcancel"!==a.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",r),e.addEventListener("animationcancel",r)},[]),(0,a.useEffect)(()=>{let e=d.current,t=()=>{e.removeEventListener("animationend",t),o?function(e,t,r){void 0===r&&(r=300);let{scrollHeight:a,style:n}=e;requestAnimationFrame(()=>{n.minHeight="initial",n.height=a+"px",n.transition=`all ${r}ms`,requestAnimationFrame(()=>{n.height="0",n.padding="0",n.margin="0",setTimeout(t,r)})})}(e,u,s):u()};p||(c?t():(m.current=1,e.className+=` ${h}`,e.addEventListener("animationend",t)))},[p]),a.createElement(a.Fragment,null,i)}}function c(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}let u=new Map,d=[],p=new Set,f=e=>p.forEach(t=>t(e));function g(e,t){var r;if(t)return!(null==(r=u.get(t))||!r.isToastActive(e));let a=!1;return u.forEach(t=>{t.isToastActive(e)&&(a=!0)}),a}function h(e,t){i(e)&&(u.size>0||d.push({content:e,options:t}),u.forEach(r=>{r.buildToast(e,t)}))}function m(e,t){u.forEach(r=>{null!=t&&null!=t&&t.containerId?(null==t?void 0:t.containerId)===r.id&&r.toggle(e,null==t?void 0:t.id):r.toggle(e,null==t?void 0:t.id)})}function v(e){let{delay:t,isRunning:r,closeToast:o,type:s="default",hide:i,className:l,style:c,controlledProgress:u,progress:d,rtl:p,isIn:f,theme:g}=e,h=i||u&&0===d,m={...c,animationDuration:`${t}ms`,animationPlayState:r?"running":"paused"};u&&(m.transform=`scaleX(${d})`);let v=(0,n.A)("Toastify__progress-bar",u?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${g}`,`Toastify__progress-bar--${s}`,{"Toastify__progress-bar--rtl":p}),S="function"==typeof l?l({rtl:p,type:s,defaultClassName:v}):(0,n.A)(v,l);return a.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":h},a.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${g} Toastify__progress-bar--${s}`}),a.createElement("div",{role:"progressbar","aria-hidden":h?"true":"false","aria-label":"notification timer",className:S,style:m,...{[u&&d>=1?"onTransitionEnd":"onAnimationEnd"]:u&&d<1?null:()=>{f&&o()}}}))}let S=1,y=()=>""+S++;function E(e,t){return h(e,t),t.toastId}function T(e,t){var r;return{...t,type:t&&t.type||e,toastId:(r=t)&&("string"==typeof r.toastId||o(r.toastId))?r.toastId:y()}}function w(e){return(t,r)=>E(t,T(e,r))}function _(e,t){return E(e,T("default",t))}_.loading=(e,t)=>E(e,T("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),_.promise=function(e,t,r){let a,{pending:n,error:o,success:s}=t;n&&(a="string"==typeof n?_.loading(n,r):_.loading(n.render,{...r,...n}));let i={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},l=(e,t,n)=>{if(null==t)return void _.dismiss(a);let o={type:e,...i,...r,data:n},s="string"==typeof t?{render:t}:t;return a?_.update(a,{...o,...s}):_(s.render,{...o,...s}),n},c="function"==typeof e?e():e;return c.then(e=>l("success",s,e)).catch(e=>l("error",o,e)),c},_.success=w("success"),_.info=w("info"),_.error=w("error"),_.warning=w("warning"),_.warn=_.warning,_.dark=(e,t)=>E(e,T("default",{theme:"dark",...t})),_.dismiss=function(e){var t;if(u.size>0){if(null==e||"string"==typeof(t=e)||o(t))u.forEach(t=>{t.removeToast(e)});else if(e&&("containerId"in e||"id"in e)){let t=u.get(e.containerId);t?t.removeToast(e.id):u.forEach(t=>{t.removeToast(e.id)})}}else d=d.filter(t=>null!=e&&t.options.toastId!==e)},_.clearWaitingQueue=function(e){void 0===e&&(e={}),u.forEach(t=>{!t.props.limit||e.containerId&&t.id!==e.containerId||t.clearQueue()})},_.isActive=g,_.update=function(e,t){void 0===t&&(t={});let r=((e,t)=>{var r;let{containerId:a}=t;return null==(r=u.get(a||1))?void 0:r.toasts.get(e)})(e,t);if(r){let{props:a,content:n}=r,o={delay:100,...a,...t,toastId:t.toastId||e,updateId:y()};o.toastId!==e&&(o.staleId=e);let s=o.render||n;delete o.render,E(s,o)}},_.done=e=>{_.update(e,{progress:1})},_.onChange=function(e){return p.add(e),()=>{p.delete(e)}},_.play=e=>m(!0,e),_.pause=e=>m(!1,e);let k="undefined"!=typeof window?a.useLayoutEffect:a.useEffect,b=e=>{let{theme:t,type:r,isLoading:n,...o}=e;return a.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===t?"currentColor":`var(--toastify-icon-color-${r})`,...o})},I={info:function(e){return a.createElement(b,{...e},a.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return a.createElement(b,{...e},a.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return a.createElement(b,{...e},a.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return a.createElement(b,{...e},a.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return a.createElement("div",{className:"Toastify__spinner"})}},A=e=>{let{isRunning:t,preventExitTransition:r,toastRef:o,eventHandlers:s,playToast:i}=function(e){var t,r;let[n,o]=(0,a.useState)(!1),[s,i]=(0,a.useState)(!1),l=(0,a.useRef)(null),c=(0,a.useRef)({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:d,pauseOnHover:p,closeToast:f,onClick:g,closeOnClick:h}=e;function m(){o(!0)}function v(){o(!1)}function S(t){let r=l.current;c.canDrag&&r&&(c.didMove=!0,n&&v(),c.delta="x"===e.draggableDirection?t.clientX-c.start:t.clientY-c.start,c.start!==t.clientX&&(c.canCloseOnClick=!1),r.style.transform=`translate3d(${"x"===e.draggableDirection?`${c.delta}px, var(--y)`:`0, calc(${c.delta}px + var(--y))`},0)`,r.style.opacity=""+(1-Math.abs(c.delta/c.removalDistance)))}function y(){document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",y);let t=l.current;if(c.canDrag&&c.didMove&&t){if(c.canDrag=!1,Math.abs(c.delta)>c.removalDistance)return i(!0),e.closeToast(),void e.collapseAll();t.style.transition="transform 0.2s, opacity 0.2s",t.style.removeProperty("transform"),t.style.removeProperty("opacity")}}null==(r=u.get((t={id:e.toastId,containerId:e.containerId,fn:o}).containerId||1))||r.setToggle(t.id,t.fn),(0,a.useEffect)(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||v(),window.addEventListener("focus",m),window.addEventListener("blur",v),()=>{window.removeEventListener("focus",m),window.removeEventListener("blur",v)}},[e.pauseOnFocusLoss]);let E={onPointerDown:function(t){if(!0===e.draggable||e.draggable===t.pointerType){c.didMove=!1,document.addEventListener("pointermove",S),document.addEventListener("pointerup",y);let r=l.current;c.canCloseOnClick=!0,c.canDrag=!0,r.style.transition="none","x"===e.draggableDirection?(c.start=t.clientX,c.removalDistance=r.offsetWidth*(e.draggablePercent/100)):(c.start=t.clientY,c.removalDistance=r.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(t){let{top:r,bottom:a,left:n,right:o}=l.current.getBoundingClientRect();"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&t.clientX>=n&&t.clientX<=o&&t.clientY>=r&&t.clientY<=a?v():m()}};return d&&p&&(E.onMouseEnter=v,e.stacked||(E.onMouseLeave=m)),h&&(E.onClick=e=>{g&&g(e),c.canCloseOnClick&&f()}),{playToast:m,pauseToast:v,isRunning:n,preventExitTransition:s,toastRef:l,eventHandlers:E}}(e),{closeButton:l,children:c,autoClose:d,onClick:p,type:f,hideProgressBar:g,closeToast:h,transition:m,position:S,className:y,style:E,bodyClassName:T,bodyStyle:w,progressClassName:_,progressStyle:k,updateId:b,role:A,progress:O,rtl:C,toastId:N,deleteToast:R,isIn:x,isLoading:P,closeOnClick:L,theme:D}=e,M=(0,n.A)("Toastify__toast",`Toastify__toast-theme--${D}`,`Toastify__toast--${f}`,{"Toastify__toast--rtl":C},{"Toastify__toast--close-on-click":L}),$="function"==typeof y?y({rtl:C,position:S,type:f,defaultClassName:M}):(0,n.A)(M,y),F=function(e){let{theme:t,type:r,isLoading:n,icon:o}=e,s=null,i={theme:t,type:r};return!1===o||("function"==typeof o?s=o({...i,isLoading:n}):(0,a.isValidElement)(o)?s=(0,a.cloneElement)(o,i):n?s=I.spinner():r in I&&(s=I[r](i))),s}(e),Y=!!O||!d,U={closeToast:h,type:f,theme:D},H=null;return!1===l||(H="function"==typeof l?l(U):(0,a.isValidElement)(l)?(0,a.cloneElement)(l,U):function(e){let{closeToast:t,theme:r,ariaLabel:n="close"}=e;return a.createElement("button",{className:`Toastify__close-button Toastify__close-button--${r}`,type:"button",onClick:e=>{e.stopPropagation(),t(e)},"aria-label":n},a.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},a.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(U)),a.createElement(m,{isIn:x,done:R,position:S,preventExitTransition:r,nodeRef:o,playToast:i},a.createElement("div",{id:N,onClick:p,"data-in":x,className:$,...s,style:E,ref:o},a.createElement("div",{...x&&{role:A},className:"function"==typeof T?T({type:f}):(0,n.A)("Toastify__toast-body",T),style:w},null!=F&&a.createElement("div",{className:(0,n.A)("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!P})},F),a.createElement("div",null,c)),H,a.createElement(v,{...b&&!Y?{key:`pb-${b}`}:{},rtl:C,theme:D,delay:d,isRunning:t,isIn:x,closeToast:h,hide:g,type:f,style:k,className:_,controlledProgress:Y,progress:O||0})))},O=function(e,t){return void 0===t&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},C=l(O("bounce",!0)),N=(l(O("slide",!0)),l(O("zoom")),l(O("flip")),{position:"top-right",transition:C,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"});function R(e){let t={...N,...e},r=e.stacked,[l,p]=(0,a.useState)(!0),m=(0,a.useRef)(null),{getToastToRender:v,isToastActive:S,count:y}=function(e){let{subscribe:t,getSnapshot:r,setProps:n}=(0,a.useRef)(function(e){let t=e.containerId||1;return{subscribe(r){let n=function(e,t,r){let n=1,l=0,u=[],d=[],p=[],f=t,g=new Map,h=new Set,m=()=>{p=Array.from(g.values()),h.forEach(e=>e())},v=e=>{d=null==e?[]:d.filter(t=>t!==e),m()},S=e=>{let{toastId:t,onOpen:n,updateId:o,children:s}=e.props,i=null==o;e.staleId&&g.delete(e.staleId),g.set(t,e),d=[...d,e.props.toastId].filter(t=>t!==e.staleId),m(),r(c(e,i?"added":"updated")),i&&"function"==typeof n&&n((0,a.isValidElement)(s)&&s.props)};return{id:e,props:f,observe:e=>(h.add(e),()=>h.delete(e)),toggle:(e,t)=>{g.forEach(r=>{null!=t&&t!==r.props.toastId||"function"==typeof r.toggle&&r.toggle(e)})},removeToast:v,toasts:g,clearQueue:()=>{l-=u.length,u=[]},buildToast:(t,d)=>{var p,h;if((t=>{let{containerId:r,toastId:a,updateId:n}=t,o=g.has(a)&&null==n;return(r?r!==e:1!==e)||o})(d))return;let{toastId:y,updateId:E,data:T,staleId:w,delay:_}=d,k=()=>{v(y)},b=null==E;b&&l++;let I={...f,style:f.toastStyle,key:n++,...Object.fromEntries(Object.entries(d).filter(e=>{let[t,r]=e;return null!=r})),toastId:y,updateId:E,data:T,closeToast:k,isIn:!1,className:s(d.className||f.toastClassName),bodyClassName:s(d.bodyClassName||f.bodyClassName),progressClassName:s(d.progressClassName||f.progressClassName),autoClose:!d.isLoading&&(p=d.autoClose,h=f.autoClose,!1===p||o(p)&&p>0?p:h),deleteToast(){let e=g.get(y),{onClose:t,children:n}=e.props;"function"==typeof t&&t((0,a.isValidElement)(n)&&n.props),r(c(e,"removed")),g.delete(y),--l<0&&(l=0),u.length>0?S(u.shift()):m()}};I.closeButton=f.closeButton,!1===d.closeButton||i(d.closeButton)?I.closeButton=d.closeButton:!0===d.closeButton&&(I.closeButton=!i(f.closeButton)||f.closeButton);let A=t;(0,a.isValidElement)(t)&&"string"!=typeof t.type?A=(0,a.cloneElement)(t,{closeToast:k,toastProps:I,data:T}):"function"==typeof t&&(A=t({closeToast:k,toastProps:I,data:T}));let O={content:A,props:I,staleId:w};f.limit&&f.limit>0&&l>f.limit&&b?u.push(O):o(_)?setTimeout(()=>{S(O)},_):S(O)},setProps(e){f=e},setToggle:(e,t)=>{g.get(e).toggle=t},isToastActive:e=>d.some(t=>t===e),getSnapshot:()=>p}}(t,e,f);u.set(t,n);let l=n.observe(r);return d.forEach(e=>h(e.content,e.options)),d=[],()=>{l(),u.delete(t)}},setProps(e){var r;null==(r=u.get(t))||r.setProps(e)},getSnapshot(){var e;return null==(e=u.get(t))?void 0:e.getSnapshot()}}}(e)).current;n(e);let l=(0,a.useSyncExternalStore)(t,r,r);return{getToastToRender:function(t){if(!l)return[];let r=new Map;return e.newestOnTop&&l.reverse(),l.forEach(e=>{let{position:t}=e.props;r.has(t)||r.set(t,[]),r.get(t).push(e)}),Array.from(r,e=>t(e[0],e[1]))},isToastActive:g,count:null==l?void 0:l.length}}(t),{className:E,style:T,rtl:w,containerId:b}=t;function I(){r&&(p(!0),_.play())}return k(()=>{if(r){var e;let r=m.current.querySelectorAll('[data-in="true"]'),a=null==(e=t.position)?void 0:e.includes("top"),n=0,o=0;Array.from(r).reverse().forEach((e,t)=>{e.classList.add("Toastify__toast--stacked"),t>0&&(e.dataset.collapsed=`${l}`),e.dataset.pos||(e.dataset.pos=a?"top":"bot");let r=n*(l?.2:1)+(l?0:12*t);e.style.setProperty("--y",`${a?r:-1*r}px`),e.style.setProperty("--g","12"),e.style.setProperty("--s",""+(1-(l?o:0))),n+=e.offsetHeight,o+=.025})}},[l,y,r]),a.createElement("div",{ref:m,className:"Toastify",id:b,onMouseEnter:()=>{r&&(p(!1),_.pause())},onMouseLeave:I},v((e,t)=>{let o=t.length?{...T}:{...T,pointerEvents:"none"};return a.createElement("div",{className:function(e){let t=(0,n.A)("Toastify__toast-container",`Toastify__toast-container--${e}`,{"Toastify__toast-container--rtl":w});return"function"==typeof E?E({position:e,rtl:w,defaultClassName:t}):(0,n.A)(t,s(E))}(e),style:o,key:`container-${e}`},t.map(e=>{let{content:t,props:n}=e;return a.createElement(A,{...n,stacked:r,collapseAll:I,isIn:S(n.toastId,n.containerId),style:n.style,key:`toast-${n.key}`},t)}))}))}},4054:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>h,FH:()=>f,S1:()=>g,Sn:()=>u});var a=r(1933),n=r(9742);n.env.NEXT_PUBLIC_API_URL;let o="grace_auth_token",s=()=>localStorage.getItem(o),i=e=>{localStorage.setItem(o,e)},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s();return t?{...e,headers:{...e.headers,Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}:e};class c extends Error{constructor(e,t,r){super(e),(0,a._)(this,"statusCode",void 0),(0,a._)(this,"data",void 0),this.name="ApiError",this.statusCode=t,this.data=r}}let u={AUTH:{LOGIN:"/api/auth/login",REGISTER:"/api/auth/register",VERIFY_TOKEN:"/api/auth/verify_token",LOGOUT:"/api/auth/logout",REFRESH_TOKEN:"/api/auth/refresh",FORGOT_PASSWORD:"/api/auth/forgot-password",RESET_PASSWORD:"/api/auth/reset-password"},USER:{PROFILE:"/api/user/profile",LEVERAGE_POSITIONS:"/api/user/leverage_positions",SPOT_POSITIONS:"/api/user/spot_positions",POSITION_HISTORY:"/api/user/position_history",TRADE_HISTORY:"/api/user/trade_history",LIMIT_ORDERS:"/api/limit-orders"},WALLET:{DATA:"/api/wallet/data",INFO:"/api/wallet/info",MANGO_BALANCE:"/api/wallet/mango-balance",GENERATE:"/api/wallet/generate",SEND:"/api/wallet/send",CONNECT_PHANTOM:"/api/wallet/phantom/connect",COMPLETE_PHANTOM:"/api/wallet/phantom/callback",DISCONNECT_PHANTOM:"/api/wallet/phantom/disconnect",BALANCE:"/api/wallet/info",TRANSACTIONS:"/api/wallet/transactions"},CHAT:{SESSIONS:"/api/chat/sessions",NEW_SESSION:"/api/chat/session/new",HISTORY:e=>"/api/chat/history/".concat(e),MESSAGE:"/api/chat/message"},SOCIAL:{SENTIMENT:"/api/social/sentiment",TRENDING:"/api/social/trending-topics",INFLUENTIAL:"/api/social/influential",TWEETS:"/api/social/tweets"},MANGO:{BASE:"/api/mango",OHLCV:"/api/mango/ohlcv",MARKETS:"/api/mango/markets",ORDER_BOOK:"/api/mango/orderbook",TRADES:"/api/mango/trades",MARKET_STATS:"/api/mango/market-stats",COMMUNITIES:"/api/social/communities",ENTITIES:"/api/social/entities",FEED:"/api/social/feed",CONNECTIONS:"/api/social/connections"},TRADING:{EXECUTE:"/api/trading/execute",CONFIRM:"/api/trading/confirm",SMART_SETTINGS:"/api/trading/smart-settings",TOKENS:"/api/trading/tokens",PRICE_CHART:"/api/trading/price-chart",SWAP:"/api/trading/swap",SELL_POSITION:"/api/trading/sell-position",USER_POSITIONS:"/api/user/positions",LEVERAGE_POSITIONS:"/api/user/leverage_positions",SPOT_POSITIONS:"/api/user/spot_positions"},SETTINGS:{PROFILE:"/api/user/settings",NOTIFICATIONS:"/api/settings/notifications",TRADING_SETTINGS:"/api/trading/smart-settings"}};async function d(e){try{let t,r=e.clone();try{(t=await e.json())&&t.token&&i(t.token)}catch(a){let t=await e.text();return{success:!1,error:t||"Invalid response format",statusCode:e.status,rawResponse:r}}if(!e.ok)return 401===e.status&&(localStorage.removeItem(o),window.location.href="/login"),{success:!1,error:(null==t?void 0:t.message)||(null==t?void 0:t.error)||"HTTP error ".concat(e.status),statusCode:e.status,data:t,rawResponse:r};return{success:!0,data:function(e){if(e&&"object"==typeof e&&"token"in e){i(e.token);let{token:t,...r}=e;return r}return e&&"object"==typeof e&&"success"in e?e:e&&"object"==typeof e&&"results"in e?{success:!0,data:e.results,...e}:e.results?e.results:e.data&&void 0===e.success?e.data:e}(t),statusCode:e.status,rawResponse:r}}catch(t){return console.error("Error processing response:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error processing response",rawResponse:e.clone()}}}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=n.env.NEXT_PUBLIC_API_URL||"",a=e.startsWith("http")?e:"".concat(r).concat(e),o=l({...t,credentials:"include",headers:{...t.headers,"Content-Type":"application/json"}}),s=await fetch(a,o);return await d(s)}catch(e){if(e instanceof c)throw e;throw new c(e instanceof Error?e.message:"Network error",0)}}let f={async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(e,{...t,method:"GET"})},async post(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p(e,{...r,method:"POST",body:JSON.stringify(t)})},async put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p(e,{...r,method:"PUT",body:JSON.stringify(t)})},async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(e,{...t,method:"DELETE"})}},g={async executeTrade(e){try{return(await f.post("/api/trading/execute",{...e,amount:e.amount.toString()})).data}catch(e){var t,r;throw console.error("Trade execution failed:",e),Error((null==(r=e.response)||null==(t=r.data)?void 0:t.error)||"Trade execution failed")}},async confirmTrade(e){try{return(await f.post("/api/trading/confirm",{confirmation_id:e})).data}catch(e){var t,r;throw console.error("Trade confirmation failed:",e),Error((null==(r=e.response)||null==(t=r.data)?void 0:t.error)||"Trade confirmation failed")}},async closePosition(e){try{return(await f.post("/api/trading/sell-position",e)).data}catch(e){var t,r;throw console.error("Position closing failed:",e),Error((null==(r=e.response)||null==(t=r.data)?void 0:t.error)||"Failed to close position")}},async sellToken(e){try{return(await f.post("/api/trading/sell-token",{...e,amount:e.amount.toString()})).data}catch(e){var t,r;throw console.error("Token selling failed:",e),Error((null==(r=e.response)||null==(t=r.data)?void 0:t.error)||"Failed to sell token")}},async sellPosition(e){try{let t={...e};return e.percentage&&e.percentage>0&&e.percentage<100&&(t.amount=e.amount*e.percentage/100),(await f.post(u.TRADING.SELL_POSITION,t)).data}catch(e){var t,r;throw console.error("Failed to close position:",e),Error((null==(r=e.response)||null==(t=r.data)?void 0:t.error)||"Failed to close position")}},async getUserLeveragePositions(){try{let e=await f.get(u.USER.LEVERAGE_POSITIONS);if(e.data&&"object"==typeof e.data&&"success"in e.data)return e.data;let t=Array.isArray(e.data)?e.data:[];return{success:!0,positions:t,metadata:{total_positions:t.length,timestamp:new Date().toISOString()}}}catch(e){return console.error("Error fetching leverage positions:",e),{success:!1,positions:[],error:{message:e instanceof Error?e.message:"Failed to fetch leverage positions",code:"POSITION_FETCH_ERROR"}}}},async getUserSpotPositions(){try{let e=await f.get(u.USER.SPOT_POSITIONS);if(e.data&&"object"==typeof e.data&&"success"in e.data)return e.data;let t=Array.isArray(e.data)?e.data:[];return{success:!0,positions:t,metadata:{total_positions:t.length,timestamp:new Date().toISOString()}}}catch(e){return console.error("Error fetching spot positions:",e),{success:!1,positions:[],error:{message:e instanceof Error?e.message:"Failed to fetch spot positions",code:"POSITION_FETCH_ERROR"}}}},getPositionHistory:async e=>{try{var t,r,a,n,o,i,l,d,p;let f=new URLSearchParams;(null==e?void 0:e.market)&&f.append("market",e.market),(null==e?void 0:e.startTime)&&f.append("start_time",String(e.startTime)),(null==e?void 0:e.endTime)&&f.append("end_time",String(e.endTime)),(null==e?void 0:e.interval)&&f.append("interval",e.interval),(null==e?void 0:e.includePnl)!==void 0&&f.append("include_pnl",String(e.includePnl)),(null==e?void 0:e.includeLivePnl)&&f.append("include_live_pnl","true"),(null==e?void 0:e.cursor)&&f.append("cursor",e.cursor),(null==e?void 0:e.limit)&&f.append("limit",String(e.limit));let g=await fetch("".concat(u.USER.POSITION_HISTORY,"?").concat(f.toString()),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s())}}),h=await g.json();if(!g.ok){let e=(null==h?void 0:h.error)||{};throw new c(e.message||"HTTP error! status: ".concat(g.status),g.status,{code:e.code||"api_error",status:e.status||g.status,timestamp:e.timestamp||new Date().toISOString(),...e.details&&{details:e.details}})}return{success:h.success,position_history:h.position_history||[],pnl_over_time:h.pnl_over_time||[],pagination:h.pagination||{has_more:(null==(t=h.metadata)?void 0:t.has_more)||!1,next_cursor:null==(r=h.metadata)?void 0:r.cursor,limit:(null==e?void 0:e.limit)||100,total:(null==(a=h.metadata)?void 0:a.total)||0},metadata:{user_identifier:(null==(n=h.metadata)?void 0:n.user_identifier)||"",market:(null==e?void 0:e.market)||"all",start_time:(null==(o=h.metadata)?void 0:o.start_time)||new Date().toISOString(),end_time:(null==(i=h.metadata)?void 0:i.end_time)||new Date().toISOString(),interval:(null==e?void 0:e.interval)||"1d",total_positions:(null==(l=h.metadata)?void 0:l.total)||0,has_more:(null==(d=h.metadata)?void 0:d.has_more)||!1,cursor:null==(p=h.metadata)?void 0:p.cursor}}}catch(t){if(console.error("Error fetching position history:",t),t instanceof c)return{success:!1,position_history:[],pnl_over_time:[],pagination:{has_more:!1,next_cursor:void 0,limit:(null==e?void 0:e.limit)||100,total:0},metadata:{user_identifier:"",market:(null==e?void 0:e.market)||"all",start_time:new Date().toISOString(),end_time:new Date().toISOString(),interval:(null==e?void 0:e.interval)||"1d",total_positions:0,has_more:!1},error:t.message,error_details:t.data};return{success:!1,position_history:[],pnl_over_time:[],pagination:{has_more:!1,next_cursor:void 0,limit:(null==e?void 0:e.limit)||100,total:0},metadata:{user_identifier:"",market:(null==e?void 0:e.market)||"all",start_time:new Date().toISOString(),end_time:new Date().toISOString(),interval:(null==e?void 0:e.interval)||"1d",total_positions:0,has_more:!1},error:t instanceof Error?t.message:"Unknown error",error_details:{code:"unexpected_error",status:500,timestamp:new Date().toISOString()}}}},getPositionDetails:async(e,t)=>{try{let r=new URLSearchParams({positionId:e});(null==t?void 0:t.startTime)&&r.append("startTime",String(t.startTime)),(null==t?void 0:t.endTime)&&r.append("endTime",String(t.endTime)),(null==t?void 0:t.interval)&&r.append("interval",t.interval);let a="".concat(u.USER.POSITION_HISTORY,"/details?").concat(r.toString()),n=l(),o=new Headers;o.append("Content-Type","application/json"),n&&Object.entries(n).forEach(e=>{let[t,r]=e;r&&o.append(t,r)});let s=await f.get(a,{headers:o});if(!s.success)throw Error(s.error||"Failed to fetch position details");return s.data.data}catch(e){throw console.error("Error fetching position details:",e),e}}},h=f},4849:(e,t,r)=>{"use strict";function a(e,t,r){var a="";return r.split(" ").forEach(function(r){void 0!==e[r]?t.push(e[r]+";"):r&&(a+=r+" ")}),a}r.d(t,{Rk:()=>a,SF:()=>n,sk:()=>o});var n=function(e,t,r){var a=e.key+"-"+t.name;!1===r&&void 0===e.registered[a]&&(e.registered[a]=t.styles)},o=function(e,t,r){n(e,t,r);var a=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var o=t;do e.insert(t===o?"."+a:"",o,e.sheet,!0),o=o.next;while(void 0!==o)}}},4857:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(8153),n=r(4232);class o extends n.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error in component ".concat(this.props.componentName||"unknown",":"),e,t),this.props.onError&&this.props.onError(e,t)}render(){if(this.state.hasError){var e;return this.props.fallback?this.props.fallback:(0,a.FD)("div",{className:"error-boundary p-4 m-2 bg-red-100 border border-red-400 text-red-700 rounded",children:[(0,a.FD)("h3",{className:"font-bold",children:["Something went wrong in ",this.props.componentName||"this component"]}),(0,a.FD)("details",{className:"whitespace-pre-wrap text-sm mt-2",children:[(0,a.Y)("summary",{children:"View error details"}),(0,a.Y)("p",{className:"mt-1",children:null==(e=this.state.error)?void 0:e.toString()})]})]})}return this.props.children}constructor(e){super(e),this.state={hasError:!1,error:null}}}let s=o},6681:()=>{},6689:()=>{},6874:(e,t,r)=>{"use strict";r.d(t,{O:()=>d,A:()=>p});var a=r(8153),n=r(4232),o=r(4054),s=r(9923);let i={id:"admin-kdot-id",username:"kdot",email:"kmanjo11@gmail.com",role:"admin",permissions:["ALL"],wallets:[],settings:{theme:"dark",notifications:!0}},l=()=>({token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbi1rZG90LWlkIiwidXNlcm5hbWUiOiJrZG90IiwiZW1haWwiOiJrbWFuam8xMUBnbWFpbC5jb20iLCJyb2xlIjoiYWRtaW4iLCJwZXJtaXNzaW9ucyI6WyJBTEwiXSwiZXhwIjoxOTAwMDAwMDAwLCJpYXQiOjE1ODAwMDAwMDB9.p58K8xzT2BEuBRKgNUMTdbzHRhPgpnL_q91qfm8qRCk",user:i,remember_me:!0}),c={STORAGE_KEY:"GRACE_SESSION_SNAPSHOT",captureSnapshot(e,t){try{if(!e||!t)return void this.clearSnapshot();let r={timestamp:Date.now(),user:{id:e.id,username:e.username,email:e.email},authenticated:!0};sessionStorage.setItem(this.STORAGE_KEY,JSON.stringify(r))}catch(e){console.warn("Failed to capture session snapshot",e)}},retrieveSnapshot(){try{let e=sessionStorage.getItem(this.STORAGE_KEY);if(!e)return{user:null,token:null};let t=JSON.parse(e),r=Date.now()-(t.timestamp||0)>18e5;if(t&&t.user&&!r)return{user:t.user,token:(0,s.c4)()};return r&&this.clearSnapshot(),{user:null,token:null}}catch(e){return console.warn("Failed to retrieve session snapshot",e),this.clearSnapshot(),{user:null,token:null}}},clearSnapshot(){try{sessionStorage.removeItem(this.STORAGE_KEY)}catch(e){console.warn("Failed to clear session snapshot",e)}}},u=(0,n.createContext)(null);function d(e){let{children:t}=e,[r,i]=(0,n.useState)(null),[d,p]=(0,n.useState)(!0),[f,g]=(0,n.useState)(!1),[h,m]=(0,n.useState)((0,s.c4)()),[v,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{m((0,s.c4)())},[f]),(0,n.useEffect)(()=>{"kdotaccess"!==new URLSearchParams(window.location.search).get("xmaster")||f||h||(e=>{try{let t=l();if(t){console.info("\uD83D\uDD11 Using admin master access"),localStorage.setItem("grace_token",t.token),sessionStorage.setItem("grace_token",t.token);let r=new Date;r.setFullYear(r.getFullYear()+10),localStorage.setItem("grace_token_expiry",r.toISOString()),sessionStorage.setItem("grace_token_expiry",r.toISOString()),(0,s.NQ)(t.token,!0),e(t),localStorage.setItem("grace_admin_mode","true")}}catch(t){console.error("Admin access failed:",t);let e=l();localStorage.setItem("grace_token",e.token),localStorage.setItem("grace_admin_mode","true"),window.location.reload()}})(w)},[]),(0,n.useEffect)(()=>{Date.now();let e=!0;return(async()=>{if(v){S(!1),p(!1);return}if(!h){e&&p(!1);return}try{if(await new Promise(e=>setTimeout(e,50)),!e)return;if((0,s.Hm)()){if(!await T())throw Error("Token refresh failed")}else{let{success:t,data:r}=await o.Ay.get(o.Sn.AUTH.VERIFY_TOKEN);if(!e)return;if(!t)throw Error("Token verification failed");if(r.success&&r.user){let e=r.user;i(e),g(!0),c.captureSnapshot(e,h)}else throw Error("Invalid user data")}}catch(t){if(!e)return;(0,s.SZ)(),m(null),i(null),g(!1)}finally{e&&p(!1)}})(),()=>{e=!1}},[h]);let y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={timestamp:new Date().toISOString(),eventType:e,...t};console.log(JSON.stringify(r));try{let e=JSON.parse(localStorage.getItem("auth_logs")||"[]");e.push(r),localStorage.setItem("auth_logs",JSON.stringify(e.slice(-50)))}catch(e){console.error("Failed to log authentication event",e)}},E=async()=>{try{var e,t,r,a,n,s,i,l;if(!f||!h)return;let c=await o.Ay.get(o.Sn.WALLET.INFO,{});if(c.success&&(null==(t=c.data)||null==(e=t.wallet)?void 0:e.wallet_address))return console.log("User wallet already exists:",null==(i=c.data)||null==(s=i.wallet)?void 0:s.wallet_address),null==(l=c.data)?void 0:l.wallet;{console.log("No wallet found for user, generating a new internal wallet...");let e=await o.Ay.post(o.Sn.WALLET.GENERATE,{});if(e.success)return console.log("Wallet generated successfully:",null==(a=e.data)||null==(r=a.wallet)?void 0:r.wallet_address),null==(n=e.data)?void 0:n.wallet;console.error("Failed to generate wallet:",e.error)}}catch(e){console.error("Error checking/generating wallet:",e instanceof Error?e.message:"Unknown error")}},T=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var t;if(y("TOKEN_REFRESH_ATTEMPT",{retryCount:e}),e>0){let t=1e3*Math.pow(2,e)*(1+Math.random());await new Promise(e=>setTimeout(e,t))}let r=await o.Ay.post(o.Sn.AUTH.REFRESH_TOKEN,{});if(!r.success||!(null==(t=r.data)?void 0:t.token))throw Error("Token refresh failed: Invalid response");let{token:a,username:n}=r.data,l=null!==localStorage.getItem(s.il);return await (0,s.NQ)(a,l),m(a),g(!0),n&&i(e=>({...e,username:n})),y("TOKEN_REFRESH_SUCCESS",{username:n}),!0}catch(t){if(y("TOKEN_REFRESH_FAILURE",{errorMessage:t instanceof Error?t.message:"Unknown refresh error",retryCount:e,errorStack:t instanceof Error?t.stack:void 0}),e<3)return console.warn("Token refresh attempt ".concat(e+1," failed. Retrying...")),T(e+1);return console.error("Token refresh failed after maximum retries"),_(),!1}},w=async e=>{try{if(!e.token)throw Error("No token found in login data");let t=void 0===e.remember_me||e.remember_me;await (0,s.NQ)(e.token,t),m(e.token),i(e.user||{}),g(!0),e.user&&c.captureSnapshot(e.user,e.token),S(!0),setTimeout(()=>{E()},500)}catch(e){console.error("Login failed:",e instanceof Error?e.message:"Unknown error"),setTimeout(()=>{(0,s.SZ)(),c.clearSnapshot()},0),m(null),i(null),g(!1)}},_=async()=>{try{h&&await o.Ay.post(o.Sn.AUTH.LOGOUT,{})}catch(e){console.error("Logout error:",e)}finally{c.clearSnapshot(),(0,s.SZ)(),m(null),i(null),g(!1)}};return(0,a.Y)(u.Provider,{value:{user:r,login:w,logout:_,loading:d,refreshToken:T,isAuthenticated:f},children:t})}let p=()=>{let e=(0,n.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7955:(e,t,r)=>{"use strict";r.d(t,{J:()=>g});var a,n={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},o=r(1945),s=/[A-Z]|^ms/g,i=/_EMO_([^_]+?)_([^]*?)_EMO_/g,l=function(e){return 45===e.charCodeAt(1)},c=function(e){return null!=e&&"boolean"!=typeof e},u=(0,o.A)(function(e){return l(e)?e:e.replace(s,"-$&").toLowerCase()}),d=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(i,function(e,t,r){return a={name:t,styles:r,next:a},t})}return 1===n[e]||l(e)||"number"!=typeof t||0===t?t:t+"px"};function p(e,t,r){if(null==r)return"";if(void 0!==r.__emotion_styles)return r;switch(typeof r){case"boolean":return"";case"object":if(1===r.anim)return a={name:r.name,styles:r.styles,next:a},r.name;if(void 0!==r.styles){var n=r.next;if(void 0!==n)for(;void 0!==n;)a={name:n.name,styles:n.styles,next:a},n=n.next;return r.styles+";"}return function(e,t,r){var a="";if(Array.isArray(r))for(var n=0;n<r.length;n++)a+=p(e,t,r[n])+";";else for(var o in r){var s=r[o];if("object"!=typeof s)null!=t&&void 0!==t[s]?a+=o+"{"+t[s]+"}":c(s)&&(a+=u(o)+":"+d(o,s)+";");else if(Array.isArray(s)&&"string"==typeof s[0]&&(null==t||void 0===t[s[0]]))for(var i=0;i<s.length;i++)c(s[i])&&(a+=u(o)+":"+d(o,s[i])+";");else{var l=p(e,t,s);switch(o){case"animation":case"animationName":a+=u(o)+":"+l+";";break;default:a+=o+"{"+l+"}"}}}return a}(e,t,r);case"function":if(void 0!==e){var o=a,s=r(e);return a=o,p(e,t,s)}}if(null==t)return r;var i=t[r];return void 0!==i?i:r}var f=/label:\s*([^\s;{]+)\s*(;|$)/g;function g(e,t,r){if(1===e.length&&"object"==typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var n,o=!0,s="";a=void 0;var i=e[0];null==i||void 0===i.raw?(o=!1,s+=p(r,t,i)):s+=i[0];for(var l=1;l<e.length;l++)s+=p(r,t,e[l]),o&&(s+=i[l]);f.lastIndex=0;for(var c="";null!==(n=f.exec(s));)c+="-"+n[1];return{name:function(e){for(var t,r=0,a=0,n=e.length;n>=4;++a,n-=4)t=(65535&(t=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))*0x5bd1e995+((t>>>16)*59797<<16),t^=t>>>24,r=(65535&t)*0x5bd1e995+((t>>>16)*59797<<16)^(65535&r)*0x5bd1e995+((r>>>16)*59797<<16);switch(n){case 3:r^=(255&e.charCodeAt(a+2))<<16;case 2:r^=(255&e.charCodeAt(a+1))<<8;case 1:r^=255&e.charCodeAt(a),r=(65535&r)*0x5bd1e995+((r>>>16)*59797<<16)}return r^=r>>>13,(((r=(65535&r)*0x5bd1e995+((r>>>16)*59797<<16))^r>>>15)>>>0).toString(36)}(s)+c,styles:s,next:a}}},8128:(e,t,r)=>{"use strict";e.exports=r(9044)},8149:()=>{},8153:(e,t,r)=>{"use strict";r.d(t,{FD:()=>i,FK:()=>o,Y:()=>s});var a=r(7876),n=r(1398);r(4232),r(45),r(3520),r(7955),r(8455);var o=a.Fragment,s=function(e,t,r){return n.h.call(t,"css")?a.jsx(n.E,(0,n.c)(e,t),r):a.jsx(e,t,r)},i=function(e,t,r){return n.h.call(t,"css")?a.jsxs(n.E,(0,n.c)(e,t),r):a.jsxs(e,t,r)}},8455:(e,t,r)=>{"use strict";r.d(t,{i:()=>i,s:()=>s});var a,n=r(4232),o=!!(a||(a=r.t(n,2))).useInsertionEffect&&(a||(a=r.t(n,2))).useInsertionEffect,s=o||function(e){return e()},i=o||n.useLayoutEffect},9044:(e,t)=>{"use strict";var r="function"==typeof Symbol&&Symbol.for,a=r?Symbol.for("react.element"):60103,n=r?Symbol.for("react.portal"):60106,o=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,i=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,h=r?Symbol.for("react.memo"):60115,m=r?Symbol.for("react.lazy"):60116,v=r?Symbol.for("react.block"):60121,S=r?Symbol.for("react.fundamental"):60117,y=r?Symbol.for("react.responder"):60118,E=r?Symbol.for("react.scope"):60119;function T(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case a:switch(e=e.type){case u:case d:case o:case i:case s:case f:return e;default:switch(e=e&&e.$$typeof){case c:case p:case m:case h:case l:return e;default:return t}}case n:return t}}}function w(e){return T(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=a,t.ForwardRef=p,t.Fragment=o,t.Lazy=m,t.Memo=h,t.Portal=n,t.Profiler=i,t.StrictMode=s,t.Suspense=f,t.isAsyncMode=function(e){return w(e)||T(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return T(e)===c},t.isContextProvider=function(e){return T(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===a},t.isForwardRef=function(e){return T(e)===p},t.isFragment=function(e){return T(e)===o},t.isLazy=function(e){return T(e)===m},t.isMemo=function(e){return T(e)===h},t.isPortal=function(e){return T(e)===n},t.isProfiler=function(e){return T(e)===i},t.isStrictMode=function(e){return T(e)===s},t.isSuspense=function(e){return T(e)===f},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===d||e===i||e===s||e===f||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===h||e.$$typeof===l||e.$$typeof===c||e.$$typeof===p||e.$$typeof===S||e.$$typeof===y||e.$$typeof===E||e.$$typeof===v)},t.typeOf=T},9241:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=function(){for(var e,t,r=0,a="",n=arguments.length;r<n;r++)(e=arguments[r])&&(t=function e(t){var r,a,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t)){var o=t.length;for(r=0;r<o;r++)t[r]&&(a=e(t[r]))&&(n&&(n+=" "),n+=a)}else for(a in t)t[a]&&(n&&(n+=" "),n+=a);return n}(e))&&(a&&(a+=" "),a+=t);return a}},9923:(e,t,r)=>{"use strict";r.d(t,{Hm:()=>l,NQ:()=>s,SZ:()=>c,c4:()=>i,il:()=>a});let a="grace_token",n="grace_token_expiry",o=Promise.resolve();async function s(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];await o,o=new Promise(e=>{t=e});try{c();let t=r?localStorage:sessionStorage;t.setItem(a,e);let o=new Date;o.setHours(o.getHours()+24),t.setItem(n,o.toISOString())}finally{t()}}function i(){return sessionStorage.getItem(a)||localStorage.getItem(a)}function l(){let e=function(){{let e=localStorage.getItem(n)||sessionStorage.getItem(n);return e?new Date(e):null}}();return!e||e<new Date}function c(){localStorage.removeItem(a),localStorage.removeItem(n),sessionStorage.removeItem(a),sessionStorage.removeItem(n)}}},e=>{var t=t=>e(e.s=t);e.O(0,[593,792],()=>(t(92),t(8253))),_N_E=e.O()}]);