(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{12:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var r=a(7765),o=a(5977),n=a(6395),s=a(1701),i=a(7297),l=a(3846),c=a(6184);class u{static getInstance(){return u.instance||(u.instance=new u),u.instance}async initialize(){try{if(!("serviceWorker"in navigator)||this.isRegistering)return console.log("Service Workers not supported or already registering, using local storage only"),this.startPeriodicBackup(),!1;this.isRegistering=!0;try{return this.serviceWorkerRegistration=await navigator.serviceWorker.register("/serviceWorker.js",{scope:"/"}),console.log("Service Worker registered successfully",this.serviceWorkerRegistration),navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage),this.startPeriodicBackup(),this.isRegistering=!1,!0}catch(e){return console.error("Service Worker registration failed:",e),this.isRegistering=!1,this.startPeriodicBackup(),!1}}catch(e){return console.error("Error initializing backup service:",e),!1}}startPeriodicBackup(){this.backupInterval&&clearInterval(this.backupInterval),this.backupInterval=window.setInterval(()=>{this.backupCurrentState()},this.BACKUP_INTERVAL_MS),console.log("Periodic state backup started"),window.addEventListener("beforeunload",this.backupCurrentState),window.addEventListener("pagehide",this.backupCurrentState),this.backupCurrentState()}stopPeriodicBackup(){this.backupInterval&&(clearInterval(this.backupInterval),this.backupInterval=null,window.removeEventListener("beforeunload",this.backupCurrentState),window.removeEventListener("pagehide",this.backupCurrentState),console.log("Periodic state backup stopped"))}async attemptRecovery(){try{console.log("Attempting state recovery from all sources");let e=c.A.retrieveSnapshot();if(e)return console.log("Recovered state from main persistence manager"),e;try{let e=localStorage.getItem("GRACE_STATE_BACKUP");if(e){let t=JSON.parse(e);if(t&&t.state)return console.log("Recovered state from localStorage backup"),t.state}}catch(e){console.error("Error reading from localStorage backup:",e)}if(navigator.serviceWorker.controller)return new Promise(e=>{let t=a=>{a.data&&"RECOVERY_RESULT"===a.data.type&&(navigator.serviceWorker.removeEventListener("message",t),a.data.state?(console.log("Recovered state from Service Worker"),e(a.data.state)):(console.log("No state found in Service Worker"),e(null)))};navigator.serviceWorker.addEventListener("message",t),navigator.serviceWorker.controller.postMessage({type:"RECOVER_STATE"}),setTimeout(()=>{navigator.serviceWorker.removeEventListener("message",t),console.log("Service Worker recovery timed out"),e(null)},3e3)});return console.log("No state recovered from any source"),null}catch(e){return console.error("Error during state recovery:",e),null}}constructor(){(0,l._)(this,"serviceWorkerRegistration",null),(0,l._)(this,"backupInterval",null),(0,l._)(this,"lastBackupTime",0),(0,l._)(this,"BACKUP_INTERVAL_MS",6e4),(0,l._)(this,"isRegistering",!1),(0,l._)(this,"handleServiceWorkerMessage",e=>{e.data&&"BACKUP_STATE_COMPLETE"===e.data.type&&(e.data.success?console.log("Service Worker backup complete"):console.error("Service Worker backup failed:",e.data.error))}),(0,l._)(this,"backupCurrentState",async()=>{try{let e=Date.now();if(e-this.lastBackupTime<1e4)return;this.lastBackupTime=e;let t=c.A.retrieveSnapshot();if(!t)return void console.log("No state snapshot to backup");navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"BACKUP_STATE",state:t}),console.log("State backup sent to Service Worker"));try{localStorage.setItem("GRACE_STATE_BACKUP",JSON.stringify({timestamp:e,state:t}))}catch(e){console.error("Error backing up to localStorage:",e)}}catch(e){console.error("State backup failed:",e)}})}}(0,l._)(u,"instance",void 0);let d=e=>{let{children:t}=e,{isStateLoading:a,isStateHydrated:i,isStateRecovered:l,isStateSyncing:c,dispatch:d}=(0,s.A)(),{user:p,isAuthenticated:g}=(0,n.A)(),[h,f]=(0,o.useState)(!1),[m,v]=(0,o.useState)(!1),[S,y]=(0,o.useState)(!1),E=(0,o.useRef)(!0),T=(0,o.useRef)(null),_=(0,o.useRef)(!1);(0,o.useEffect)(()=>{if(c){f(!0);let e=setTimeout(()=>f(!1),3e3);return()=>clearTimeout(e)}},[c]),(0,o.useEffect)(()=>{if(g&&p)try{let e=u.getInstance();T.current=e,e.initialize().then(e=>{console.log("State backup service initialized: ".concat(e?"success":"fallback mode"))})}catch(e){console.error("Failed to initialize state backup service:",e)}return()=>{T.current&&T.current.stopPeriodicBackup()}},[g,p]);let w=(0,o.useCallback)(async()=>{if(!i&&!a&&!_.current){_.current=!0,y(!0);try{if(T.current){let e=await T.current.attemptRecovery();e&&(console.log("Successfully recovered state from backup source"),d({type:"HYDRATE_STATE",payload:e}),v(!0),setTimeout(()=>v(!1),3e3))}}catch(e){console.error("Error during state recovery attempt:",e)}finally{y(!1)}}},[d,i,a]);return((0,o.useEffect)(()=>{if(g&&!i&&!a){let e=setTimeout(()=>{w()},1e3);return()=>clearTimeout(e)}},[g,i,a,w]),(0,o.useEffect)(()=>{if(E.current){E.current=!1;return}if(i&&!a){v(!0);let e=setTimeout(()=>v(!1),3e3);return()=>clearTimeout(e)}},[i,a]),a||S)?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-gray-900 p-6 rounded-lg shadow-lg text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-gold mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-gold mb-2",children:S?"Recovering Your Data":"Loading Your Trading State"}),(0,r.jsx)("p",{className:"text-gray-400",children:S?"Attempting to recover your session data...":"Restoring your previous session..."})]})}):l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed bottom-4 right-4 bg-gray-900 text-yellow-500 px-4 py-2 rounded shadow-lg  border border-yellow-600 transition-opacity duration-1000 z-40",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsx)("span",{children:"Session was partially recovered due to data corruption"})]})}),t]}):m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed bottom-4 right-4 bg-gray-900 text-green-400 px-4 py-2 rounded shadow-lg  transition-opacity duration-1000 z-40",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,r.jsx)("span",{children:"Session restored successfully"})]})}),t]}):h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed bottom-4 right-4 bg-gray-800 text-blue-400 px-4 py-2 rounded shadow-lg  transition-opacity duration-300 z-40 border border-blue-600",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,r.jsx)("span",{children:"Syncing state from another tab..."})]})}),t]}):(0,r.jsx)(r.Fragment,{children:t})};function p(e){let{message:t="Loading...",showLogo:a=!0}=e;return(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-black text-white p-4",children:(0,r.jsxs)("div",{className:"text-center",children:[a&&(0,r.jsx)("div",{className:"mb-4 text-red-500 text-xl font-bold",children:"Grace"}),(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("span",{className:"mr-2",children:t}),(0,r.jsx)("div",{className:"animate-pulse",children:"..."})]})]})})}var g=a(4131),h=a(8614);a(3321),a(328),a(7285);let f=["/chat","/wallet","/trading","/social","/settings"],m=["/login","/register","/forgot","/reset"];function v(e){let{children:t,router:a}=e,{user:s,loading:i,isAuthenticated:l}=(0,n.A)(),c=m.includes(a.pathname),[u,d]=(0,o.useState)(!1),g=(0,o.useRef)(!1);return((0,o.useEffect)(()=>{i||(g.current=!0)},[i]),(0,o.useEffect)(()=>{!i&&!u&&g.current&&(l||s||c||(console.log("AuthGuard: Redirecting unauthenticated user to login"),d(!0),a.push("/login").then(()=>d(!1)).catch(e=>{console.error("Navigation error:",e),d(!1)})),l&&s&&c&&(console.log("AuthGuard: Redirecting authenticated user to chat"),d(!0),a.push("/chat").then(()=>d(!1)).catch(e=>{console.error("Navigation error:",e),d(!1)})))},[l,s,i,c,a,u]),i)?(0,r.jsx)(p,{message:"Loading authentication..."}):u?(0,r.jsx)(p,{message:"Navigating..."}):i||s||c?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)(p,{message:"Redirecting to login..."})}function S(e){let{Component:t,pageProps:a,router:o}=e,l=f.includes(o.pathname);return(0,r.jsx)(i.A,{componentName:"Main App",children:(0,r.jsx)(n.O,{children:(0,r.jsx)(s.m,{children:(0,r.jsx)(d,{children:(0,r.jsxs)(v,{router:o,children:[l?(0,r.jsx)(h.default,{children:(0,r.jsx)(t,{...a})}):(0,r.jsx)(t,{...a}),(0,r.jsx)(g.N9,{position:"bottom-right",theme:"dark"})]})})})})})}},328:()=>{},351:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useIntersection",{enumerable:!0,get:function(){return l}});let r=a(5977),o=a(4202),n="function"==typeof IntersectionObserver,s=new Map,i=[];function l(e){let{rootRef:t,rootMargin:a,disabled:l}=e,c=l||!n,[u,d]=(0,r.useState)(!1),p=(0,r.useRef)(null),g=(0,r.useCallback)(e=>{p.current=e},[]);return(0,r.useEffect)(()=>{if(n){if(c||u)return;let e=p.current;if(e&&e.tagName)return function(e,t,a){let{id:r,observer:o,elements:n}=function(e){let t,a={root:e.root||null,margin:e.rootMargin||""},r=i.find(e=>e.root===a.root&&e.margin===a.margin);if(r&&(t=s.get(r)))return t;let o=new Map;return t={id:a,observer:new IntersectionObserver(e=>{e.forEach(e=>{let t=o.get(e.target),a=e.isIntersecting||e.intersectionRatio>0;t&&a&&t(a)})},e),elements:o},i.push(a),s.set(a,t),t}(a);return n.set(e,t),o.observe(e),function(){if(n.delete(e),o.unobserve(e),0===n.size){o.disconnect(),s.delete(r);let e=i.findIndex(e=>e.root===r.root&&e.margin===r.margin);e>-1&&i.splice(e,1)}}}(e,e=>e&&d(e),{root:null==t?void 0:t.current,rootMargin:a})}else if(!u){let e=(0,o.requestIdleCallback)(()=>d(!0));return()=>(0,o.cancelIdleCallback)(e)}},[c,a,t,u,p.current]),[g,u,(0,r.useCallback)(()=>{d(!1)},[])]}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1619:(e,t,a)=>{e.exports=a(965)},1701:(e,t,a)=>{"use strict";a.d(t,{A:()=>d,m:()=>u});var r=a(7765),o=a(5977),n=a(6184),s=a(6395);let i={timestamp:Date.now(),userSession:{},authSession:{},chatContext:{currentConversationId:void 0,draftMessage:"",lastMessageTimestamp:0},chatState:{activeSessions:[],sessions:{},draftMessages:{}},pageState:{},widgetStates:{},isHydrated:!1,isLoading:!1,lastSaved:0,tradingState:{},walletState:{},socialState:{},uiState:{darkMode:!0,sidebarOpen:!0},xfeed:{followedAccounts:[],lastUpdated:void 0}};function l(e,t){switch(t.type){case"SET_TRADING_STATE":return{...e,tradingState:{...e.tradingState,...t.payload}};case"SET_WALLET_STATE":return{...e,walletState:{...e.walletState,...t.payload}};case"SET_CHAT_STATE":return{...e,chatState:{...e.chatState,...t.payload}};case"SET_SOCIAL_STATE":return{...e,socialState:{...e.socialState,...t.payload}};case"SET_UI_STATE":return{...e,uiState:{...e.uiState,...t.payload}};case"SET_PAGE_STATE":return{...e,pageState:{...e.pageState,...t.payload}};case"SET_WIDGET_STATES":return{...e,widgetStates:{...e.widgetStates,...t.payload}};case"SET_CHAT_CONTEXT":return{...e,chatContext:{...e.chatContext,...t.payload}};case"SET_USER_SESSION":return{...e,userSession:{...e.userSession,...t.payload}};case"UPDATE_AUTH":let{user:a,token:r}=t.payload;return{...e,userSession:{...e.userSession,token:r||"",username:(null==a?void 0:a.username)||""},authSession:{...e.authSession,token:r||"",expiresAt:r?Math.floor(Date.now()/1e3)+86400:void 0}};case"UPDATE_XFEED":return{...e,xfeed:{...e.xfeed,...t.payload,lastUpdated:Date.now()}};case"HYDRATE_STATE":case"HYDRATE":return{...t.payload};case"RESET_STATE":case"RESET":return i;default:return e}}let c=(0,o.createContext)(void 0);function u(e){let{children:t}=e,[a,u]=(0,o.useReducer)(l,i),[d,p]=(0,o.useState)(!0),[g,h]=(0,o.useState)(!1),[f,m]=(0,o.useState)(!1),[v,S]=(0,o.useState)(!1),y=(0,o.useRef)(!1),{user:E,isAuthenticated:T}=(0,s.A)();(0,o.useEffect)(()=>{u({type:"UPDATE_AUTH",payload:{user:T?E:null,token:T?localStorage.getItem("authToken"):null}})},[E,T]);let _=(0,o.useCallback)(async e=>{try{var t,a,r,o,s,i,l,c,d,g,f,m,v,S,y,E,T,_,w,b;p(!0);let k=n.A.retrieveSnapshot();if(!k){console.log("No stored state found"),h(!0);return}console.log("Hydrating state from storage:",k);let A={timestamp:k.timestamp||Date.now(),isHydrated:!0,lastSaved:0,userSession:{token:(null==(t=k.userSession)?void 0:t.token)||"",username:(null==(a=k.userSession)?void 0:a.username)||""},chatContext:{currentConversationId:null==(r=k.chatContext)?void 0:r.currentConversationId,draftMessage:(null==(o=k.chatContext)?void 0:o.draftMessage)||"",lastMessageTimestamp:(null==(s=k.chatContext)?void 0:s.lastMessageTimestamp)||0},pageState:{lastVisitedPath:(null==(i=k.pageState)?void 0:i.lastVisitedPath)||"/",scrollPositions:(null==(l=k.pageState)?void 0:l.scrollPositions)||{}},widgetStates:{tradingPositions:(null==(c=k.widgetStates)?void 0:c.tradingPositions)||[],walletBalance:(null==(d=k.widgetStates)?void 0:d.walletBalance)||0},chatState:{activeSessions:(null==(g=k.chatState)?void 0:g.activeSessions)||[],currentSessionId:null==(f=k.chatState)?void 0:f.currentSessionId,sessions:(null==(m=k.chatState)?void 0:m.sessions)||{},draftMessages:(null==(v=k.chatState)?void 0:v.draftMessages)||{}},tradingState:k.tradingState?{selectedToken:k.tradingState.selectedToken,watchlist:k.tradingState.watchlist||[],tradeHistory:k.tradingState.tradeHistory||[],tradeForm:k.tradingState.tradeForm,resolution:k.tradingState.resolution,search:k.tradingState.search,positions:k.tradingState.positions||[]}:{},walletState:k.walletState?{connectedWallets:k.walletState.connectedWallets||[],transactions:k.walletState.transactions||[]}:{},socialState:k.socialState?{posts:k.socialState.posts||[],following:k.socialState.following||[],notifications:k.socialState.notifications||[]}:{},uiState:{darkMode:null==(w=null==(S=k.uiState)?void 0:S.darkMode)||w,sidebarOpen:null==(b=null==(y=k.uiState)?void 0:y.sidebarOpen)||b,activeTabs:(null==(E=k.uiState)?void 0:E.activeTabs)||{}},xfeed:{followedAccounts:[],lastUpdated:void 0}};u({type:"HYDRATE_STATE",payload:A}),e&&(null==(T=A.pageState)?void 0:T.lastVisitedPath)&&(e(A.pageState.lastVisitedPath),A.pageState.scrollPositions&&setTimeout(()=>{var e,t;let a=null==(t=A.pageState)||null==(e=t.scrollPositions)?void 0:e[A.pageState.lastVisitedPath||""];"number"==typeof a&&window.scrollTo(0,a)},100));let I=localStorage.getItem("activeSessionId");!I||(null==(_=A.chatContext)?void 0:_.currentConversationId)||u({type:"SET_CHAT_CONTEXT",payload:{...A.chatContext,currentConversationId:I}}),h(!0)}catch(e){console.error("Error hydrating state:",e),h(!0)}finally{p(!1)}},[]);(0,o.useEffect)(()=>{u({type:"SET_UI_STATE",payload:{isLoading:!0}});let e=setTimeout(()=>{_(),u({type:"SET_UI_STATE",payload:{isLoading:!1}})},300);return()=>clearTimeout(e)},[_]),(0,o.useEffect)(()=>{let e=e=>{if("GRACE_DYNAMIC_SNAPSHOT"===e.key&&!y.current){console.log("State changed in another tab, synchronizing...");try{y.current=!0;let t=e.newValue?JSON.parse(e.newValue):null;t&&"object"==typeof t&&t.timestamp&&(S(!0),(!a.timestamp||t.timestamp>a.timestamp)&&(u({type:"HYDRATE_STATE",payload:t}),console.log("State synchronized from another tab"))),setTimeout(()=>S(!1),1e3)}catch(e){console.error("Error synchronizing state from another tab:",e)}finally{setTimeout(()=>{y.current=!1},100)}}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[a.timestamp]);let w=(0,o.useRef)(null),b=(0,o.useRef)(0);return(0,o.useEffect)(()=>{var e;return(Object.keys(a.tradingState||{}).length>0||Object.keys(a.walletState||{}).length>0||Object.keys(a.chatContext||{}).length>0||Object.keys((null==(e=a.chatState)?void 0:e.sessions)||{}).length>0)&&(null!==w.current&&clearTimeout(w.current),w.current=window.setTimeout(()=>{if(!y.current){let t=Date.now();if(t-b.current>2e3){var e;b.current=t;let r={...a,timestamp:t};(null==(e=a.chatContext)?void 0:e.currentConversationId)&&console.log("Saving state with active conversation: ".concat(a.chatContext.currentConversationId));try{(async()=>{try{var e;await n.A.captureSnapshot(r),console.log("State saved to localStorage",new Date().toISOString()),(null==(e=a.chatContext)?void 0:e.currentConversationId)&&localStorage.setItem("activeSessionId",a.chatContext.currentConversationId)}catch(e){console.error("Error saving state to localStorage:",e)}})()}catch(e){console.error("Error in state persistence flow:",e)}}}w.current=null},300)),()=>{null!==w.current&&clearTimeout(w.current)}},[a]),(0,r.jsx)(c.Provider,{value:{state:a,dispatch:u,isStateLoading:d,isStateHydrated:g,isStateRecovered:f,isStateSyncing:v,hydrateFromStorage:_},children:t})}function d(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAppState must be used within an AppStateProvider");return e}},1742:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>f,FH:()=>g,S1:()=>h,Sn:()=>u});var r=a(3846),o=a(9742);o.env.NEXT_PUBLIC_API_URL;let n="grace_auth_token",s=()=>localStorage.getItem(n),i=e=>{localStorage.setItem(n,e)},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s();return t?{...e,headers:{...e.headers,Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}:e};class c extends Error{constructor(e,t,a){super(e),(0,r._)(this,"statusCode",void 0),(0,r._)(this,"data",void 0),this.name="ApiError",this.statusCode=t,this.data=a}}let u={AUTH:{LOGIN:"/api/auth/login",REGISTER:"/api/auth/register",VERIFY_TOKEN:"/api/auth/verify_token",LOGOUT:"/api/auth/logout",REFRESH_TOKEN:"/api/auth/refresh",FORGOT_PASSWORD:"/api/auth/forgot-password",RESET_PASSWORD:"/api/auth/reset-password"},USER:{PROFILE:"/api/user/profile",LEVERAGE_POSITIONS:"/api/user/leverage_positions",SPOT_POSITIONS:"/api/user/spot_positions",POSITION_HISTORY:"/api/user/position_history",TRADE_HISTORY:"/api/user/trade_history",LIMIT_ORDERS:"/api/limit-orders"},WALLET:{DATA:"/api/wallet/data",INFO:"/api/wallet/info",MANGO_BALANCE:"/api/wallet/mango-balance",GENERATE:"/api/wallet/generate",SEND:"/api/wallet/send",CONNECT_PHANTOM:"/api/wallet/phantom/connect",COMPLETE_PHANTOM:"/api/wallet/phantom/callback",DISCONNECT_PHANTOM:"/api/wallet/phantom/disconnect",BALANCE:"/api/wallet/info",TRANSACTIONS:"/api/wallet/transactions"},CHAT:{SESSIONS:"/api/chat/sessions",NEW_SESSION:"/api/chat/session/new",HISTORY:e=>"/api/chat/history/".concat(e),MESSAGE:"/api/chat/message"},SOCIAL:{SENTIMENT:"/api/social/sentiment",TRENDING:"/api/social/trending-topics",INFLUENTIAL:"/api/social/influential",TWEETS:"/api/social/tweets"},MANGO:{BASE:"/api/mango",OHLCV:"/api/mango/ohlcv",MARKETS:"/api/mango/markets",ORDER_BOOK:"/api/mango/orderbook",TRADES:"/api/mango/trades",MARKET_STATS:"/api/mango/market-stats",COMMUNITIES:"/api/social/communities",ENTITIES:"/api/social/entities",FEED:"/api/social/feed",CONNECTIONS:"/api/social/connections"},TRADING:{EXECUTE:"/api/trading/execute",CONFIRM:"/api/trading/confirm",SMART_SETTINGS:"/api/trading/smart-settings",TOKENS:"/api/trading/tokens",PRICE_CHART:"/api/trading/price-chart",SWAP:"/api/trading/swap",SELL_POSITION:"/api/trading/sell-position",USER_POSITIONS:"/api/user/positions",LEVERAGE_POSITIONS:"/api/user/leverage_positions",SPOT_POSITIONS:"/api/user/spot_positions"},SETTINGS:{PROFILE:"/api/user/settings",NOTIFICATIONS:"/api/settings/notifications",TRADING_SETTINGS:"/api/trading/smart-settings"}};async function d(e){try{let t,a=e.clone();try{(t=await e.json())&&t.token&&i(t.token)}catch(r){let t=await e.text();return{success:!1,error:t||"Invalid response format",statusCode:e.status,rawResponse:a}}if(!e.ok)return 401===e.status&&(localStorage.removeItem(n),window.location.href="/login"),{success:!1,error:(null==t?void 0:t.message)||(null==t?void 0:t.error)||"HTTP error ".concat(e.status),statusCode:e.status,data:t,rawResponse:a};return{success:!0,data:function(e){if(e&&"object"==typeof e&&"token"in e){i(e.token);let{token:t,...a}=e;return a}return e&&"object"==typeof e&&"success"in e?e:e&&"object"==typeof e&&"results"in e?{success:!0,data:e.results,...e}:e.results?e.results:e.data&&void 0===e.success?e.data:e}(t),statusCode:e.status,rawResponse:a}}catch(t){return console.error("Error processing response:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error processing response",rawResponse:e.clone()}}}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=o.env.NEXT_PUBLIC_API_URL||"",r=e.startsWith("http")?e:"".concat(a).concat(e),n=l({...t,credentials:"include",headers:{...t.headers,"Content-Type":"application/json"}}),s=await fetch(r,n);return await d(s)}catch(e){if(e instanceof c)throw e;throw new c(e instanceof Error?e.message:"Network error",0)}}let g={async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(e,{...t,method:"GET"})},async post(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p(e,{...a,method:"POST",body:JSON.stringify(t)})},async put(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p(e,{...a,method:"PUT",body:JSON.stringify(t)})},async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(e,{...t,method:"DELETE"})}},h={async executeTrade(e){try{return(await g.post("/api/trading/execute",{...e,amount:e.amount.toString()})).data}catch(e){var t,a;throw console.error("Trade execution failed:",e),Error((null==(a=e.response)||null==(t=a.data)?void 0:t.error)||"Trade execution failed")}},async confirmTrade(e){try{return(await g.post("/api/trading/confirm",{confirmation_id:e})).data}catch(e){var t,a;throw console.error("Trade confirmation failed:",e),Error((null==(a=e.response)||null==(t=a.data)?void 0:t.error)||"Trade confirmation failed")}},async closePosition(e){try{return(await g.post("/api/trading/sell-position",e)).data}catch(e){var t,a;throw console.error("Position closing failed:",e),Error((null==(a=e.response)||null==(t=a.data)?void 0:t.error)||"Failed to close position")}},async sellToken(e){try{return(await g.post("/api/trading/sell-token",{...e,amount:e.amount.toString()})).data}catch(e){var t,a;throw console.error("Token selling failed:",e),Error((null==(a=e.response)||null==(t=a.data)?void 0:t.error)||"Failed to sell token")}},async sellPosition(e){try{let t={...e};return e.percentage&&e.percentage>0&&e.percentage<100&&(t.amount=e.amount*e.percentage/100),(await g.post(u.TRADING.SELL_POSITION,t)).data}catch(e){var t,a;throw console.error("Failed to close position:",e),Error((null==(a=e.response)||null==(t=a.data)?void 0:t.error)||"Failed to close position")}},async getUserLeveragePositions(){try{let e=await g.get(u.USER.LEVERAGE_POSITIONS);if(e.data&&"object"==typeof e.data&&"success"in e.data)return e.data;let t=Array.isArray(e.data)?e.data:[];return{success:!0,positions:t,metadata:{total_positions:t.length,timestamp:new Date().toISOString()}}}catch(e){return console.error("Error fetching leverage positions:",e),{success:!1,positions:[],error:{message:e instanceof Error?e.message:"Failed to fetch leverage positions",code:"POSITION_FETCH_ERROR"}}}},async getUserSpotPositions(){try{let e=await g.get(u.USER.SPOT_POSITIONS);if(e.data&&"object"==typeof e.data&&"success"in e.data)return e.data;let t=Array.isArray(e.data)?e.data:[];return{success:!0,positions:t,metadata:{total_positions:t.length,timestamp:new Date().toISOString()}}}catch(e){return console.error("Error fetching spot positions:",e),{success:!1,positions:[],error:{message:e instanceof Error?e.message:"Failed to fetch spot positions",code:"POSITION_FETCH_ERROR"}}}},getPositionHistory:async e=>{try{var t,a,r,o,n,i,l,d,p;let g=new URLSearchParams;(null==e?void 0:e.market)&&g.append("market",e.market),(null==e?void 0:e.startTime)&&g.append("start_time",String(e.startTime)),(null==e?void 0:e.endTime)&&g.append("end_time",String(e.endTime)),(null==e?void 0:e.interval)&&g.append("interval",e.interval),(null==e?void 0:e.includePnl)!==void 0&&g.append("include_pnl",String(e.includePnl)),(null==e?void 0:e.includeLivePnl)&&g.append("include_live_pnl","true"),(null==e?void 0:e.cursor)&&g.append("cursor",e.cursor),(null==e?void 0:e.limit)&&g.append("limit",String(e.limit));let h=await fetch("".concat(u.USER.POSITION_HISTORY,"?").concat(g.toString()),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s())}}),f=await h.json();if(!h.ok){let e=(null==f?void 0:f.error)||{};throw new c(e.message||"HTTP error! status: ".concat(h.status),h.status,{code:e.code||"api_error",status:e.status||h.status,timestamp:e.timestamp||new Date().toISOString(),...e.details&&{details:e.details}})}return{success:f.success,position_history:f.position_history||[],pnl_over_time:f.pnl_over_time||[],pagination:f.pagination||{has_more:(null==(t=f.metadata)?void 0:t.has_more)||!1,next_cursor:null==(a=f.metadata)?void 0:a.cursor,limit:(null==e?void 0:e.limit)||100,total:(null==(r=f.metadata)?void 0:r.total)||0},metadata:{user_identifier:(null==(o=f.metadata)?void 0:o.user_identifier)||"",market:(null==e?void 0:e.market)||"all",start_time:(null==(n=f.metadata)?void 0:n.start_time)||new Date().toISOString(),end_time:(null==(i=f.metadata)?void 0:i.end_time)||new Date().toISOString(),interval:(null==e?void 0:e.interval)||"1d",total_positions:(null==(l=f.metadata)?void 0:l.total)||0,has_more:(null==(d=f.metadata)?void 0:d.has_more)||!1,cursor:null==(p=f.metadata)?void 0:p.cursor}}}catch(t){if(console.error("Error fetching position history:",t),t instanceof c)return{success:!1,position_history:[],pnl_over_time:[],pagination:{has_more:!1,next_cursor:void 0,limit:(null==e?void 0:e.limit)||100,total:0},metadata:{user_identifier:"",market:(null==e?void 0:e.market)||"all",start_time:new Date().toISOString(),end_time:new Date().toISOString(),interval:(null==e?void 0:e.interval)||"1d",total_positions:0,has_more:!1},error:t.message,error_details:t.data};return{success:!1,position_history:[],pnl_over_time:[],pagination:{has_more:!1,next_cursor:void 0,limit:(null==e?void 0:e.limit)||100,total:0},metadata:{user_identifier:"",market:(null==e?void 0:e.market)||"all",start_time:new Date().toISOString(),end_time:new Date().toISOString(),interval:(null==e?void 0:e.interval)||"1d",total_positions:0,has_more:!1},error:t instanceof Error?t.message:"Unknown error",error_details:{code:"unexpected_error",status:500,timestamp:new Date().toISOString()}}}},getPositionDetails:async(e,t)=>{try{let a=new URLSearchParams({positionId:e});(null==t?void 0:t.startTime)&&a.append("startTime",String(t.startTime)),(null==t?void 0:t.endTime)&&a.append("endTime",String(t.endTime)),(null==t?void 0:t.interval)&&a.append("interval",t.interval);let r="".concat(u.USER.POSITION_HISTORY,"/details?").concat(a.toString()),o=l(),n=new Headers;n.append("Content-Type","application/json"),o&&Object.entries(o).forEach(e=>{let[t,a]=e;a&&n.append(t,a)});let s=await g.get(r,{headers:n});if(!s.success)throw Error(s.error||"Failed to fetch position details");return s.data.data}catch(e){throw console.error("Error fetching position details:",e),e}}},f=g},2252:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{default:function(){return _},useLinkStatus:function(){return T}});let r=a(8781),o=a(7765),n=r._(a(5977)),s=a(1898),i=a(3680),l=a(2937),c=a(6447),u=a(1392),d=a(2721),p=a(351),g=a(2420),h=a(6165),f=a(3018);a(7124);let m=new Set;function v(e,t,a,r){if((0,i.isLocalURL)(t)){if(!r.bypassPrefetchedCheck){let o=t+"%"+a+"%"+(void 0!==r.locale?r.locale:"locale"in e?e.locale:void 0);if(m.has(o))return;m.add(o)}e.prefetch(t,a,r).catch(e=>{})}}function S(e){return"string"==typeof e?e:(0,l.formatUrl)(e)}let y=n.default.forwardRef(function(e,t){let a,r,{href:l,as:m,children:y,prefetch:E=null,passHref:T,replace:_,shallow:w,scroll:b,locale:k,onClick:A,onNavigate:I,onMouseEnter:x,onTouchStart:O,legacyBehavior:C=!1,...N}=e;a=y,C&&("string"==typeof a||"number"==typeof a)&&(a=(0,o.jsx)("a",{children:a}));let R=n.default.useContext(d.RouterContext),L=!1!==E,{href:P,as:j}=n.default.useMemo(()=>{if(!R){let e=S(l);return{href:e,as:m?S(m):e}}let[e,t]=(0,s.resolveHref)(R,l,!0);return{href:e,as:m?(0,s.resolveHref)(R,m):t||e}},[R,l,m]),M=n.default.useRef(P),D=n.default.useRef(j);C&&(r=n.default.Children.only(a));let U=C?r&&"object"==typeof r&&r.ref:t,[B,G,W]=(0,p.useIntersection)({rootMargin:"200px"}),H=n.default.useCallback(e=>{(D.current!==j||M.current!==P)&&(W(),D.current=j,M.current=P),B(e)},[j,P,W,B]),F=(0,f.useMergedRef)(H,U);n.default.useEffect(()=>{R&&G&&L&&v(R,P,j,{locale:k})},[j,P,G,k,L,null==R?void 0:R.locale,R]);let Y={ref:F,onClick(e){C||"function"!=typeof A||A(e),C&&r.props&&"function"==typeof r.props.onClick&&r.props.onClick(e),R&&(e.defaultPrevented||function(e,t,a,r,o,n,s,l,c){let{nodeName:u}=e.currentTarget;if(!("A"===u.toUpperCase()&&function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)||e.currentTarget.hasAttribute("download"))){if(!(0,i.isLocalURL)(a)){o&&(e.preventDefault(),location.replace(a));return}e.preventDefault(),(()=>{if(c){let e=!1;if(c({preventDefault:()=>{e=!0}}),e)return}let e=null==s||s;"beforePopState"in t?t[o?"replace":"push"](a,r,{shallow:n,locale:l,scroll:e}):t[o?"replace":"push"](r||a,{scroll:e})})()}}(e,R,P,j,_,w,b,k,I))},onMouseEnter(e){C||"function"!=typeof x||x(e),C&&r.props&&"function"==typeof r.props.onMouseEnter&&r.props.onMouseEnter(e),R&&v(R,P,j,{locale:k,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(e){C||"function"!=typeof O||O(e),C&&r.props&&"function"==typeof r.props.onTouchStart&&r.props.onTouchStart(e),R&&v(R,P,j,{locale:k,priority:!0,bypassPrefetchedCheck:!0})}};if((0,c.isAbsoluteUrl)(j))Y.href=j;else if(!C||T||"a"===r.type&&!("href"in r.props)){let e=void 0!==k?k:null==R?void 0:R.locale;Y.href=(null==R?void 0:R.isLocaleDomain)&&(0,g.getDomainLocale)(j,e,null==R?void 0:R.locales,null==R?void 0:R.domainLocales)||(0,h.addBasePath)((0,u.addLocale)(j,e,null==R?void 0:R.defaultLocale))}return C?n.default.cloneElement(r,Y):(0,o.jsx)("a",{...N,...Y,children:a})}),E=(0,n.createContext)({pending:!1}),T=()=>(0,n.useContext)(E),_=y;("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2420:(e,t,a)=>{"use strict";function r(e,t,a,r){return!1}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getDomainLocale",{enumerable:!0,get:function(){return r}}),a(4826),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3018:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return o}});let r=a(5977);function o(e,t){let a=(0,r.useRef)(null),o=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let e=a.current;e&&(a.current=null,e());let t=o.current;t&&(o.current=null,t())}else e&&(a.current=n(e,r)),t&&(o.current=n(t,r))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let a=e(t);return"function"==typeof a?a:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3321:()=>{},3710:(e,t,a)=>{e.exports=a(2252)},3846:(e,t,a)=>{"use strict";function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{_:()=>r})},4131:(e,t,a)=>{"use strict";a.d(t,{N9:()=>N,oR:()=>w});var r=a(5977);let o=function(){for(var e,t,a=0,r="",o=arguments.length;a<o;a++)(e=arguments[a])&&(t=function e(t){var a,r,o="";if("string"==typeof t||"number"==typeof t)o+=t;else if("object"==typeof t)if(Array.isArray(t)){var n=t.length;for(a=0;a<n;a++)t[a]&&(r=e(t[a]))&&(o&&(o+=" "),o+=r)}else for(r in t)t[r]&&(o&&(o+=" "),o+=r);return o}(e))&&(r&&(r+=" "),r+=t);return r},n=e=>"number"==typeof e&&!isNaN(e),s=e=>"string"==typeof e||"function"==typeof e?e:null,i=e=>(0,r.isValidElement)(e)||"string"==typeof e||"function"==typeof e||n(e);function l(e){let{enter:t,exit:a,appendPosition:o=!1,collapse:n=!0,collapseDuration:s=300}=e;return function(e){let{children:i,position:l,preventExitTransition:c,done:u,nodeRef:d,isIn:p,playToast:g}=e,h=o?`${t}--${l}`:t,f=o?`${a}--${l}`:a,m=(0,r.useRef)(0);return(0,r.useLayoutEffect)(()=>{let e=d.current,t=h.split(" "),a=r=>{r.target===d.current&&(g(),e.removeEventListener("animationend",a),e.removeEventListener("animationcancel",a),0===m.current&&"animationcancel"!==r.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",a),e.addEventListener("animationcancel",a)},[]),(0,r.useEffect)(()=>{let e=d.current,t=()=>{e.removeEventListener("animationend",t),n?function(e,t,a){void 0===a&&(a=300);let{scrollHeight:r,style:o}=e;requestAnimationFrame(()=>{o.minHeight="initial",o.height=r+"px",o.transition=`all ${a}ms`,requestAnimationFrame(()=>{o.height="0",o.padding="0",o.margin="0",setTimeout(t,a)})})}(e,u,s):u()};p||(c?t():(m.current=1,e.className+=` ${f}`,e.addEventListener("animationend",t)))},[p]),r.createElement(r.Fragment,null,i)}}function c(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}let u=new Map,d=[],p=new Set,g=e=>p.forEach(t=>t(e));function h(e,t){var a;if(t)return!(null==(a=u.get(t))||!a.isToastActive(e));let r=!1;return u.forEach(t=>{t.isToastActive(e)&&(r=!0)}),r}function f(e,t){i(e)&&(u.size>0||d.push({content:e,options:t}),u.forEach(a=>{a.buildToast(e,t)}))}function m(e,t){u.forEach(a=>{null!=t&&null!=t&&t.containerId?(null==t?void 0:t.containerId)===a.id&&a.toggle(e,null==t?void 0:t.id):a.toggle(e,null==t?void 0:t.id)})}function v(e){let{delay:t,isRunning:a,closeToast:n,type:s="default",hide:i,className:l,style:c,controlledProgress:u,progress:d,rtl:p,isIn:g,theme:h}=e,f=i||u&&0===d,m={...c,animationDuration:`${t}ms`,animationPlayState:a?"running":"paused"};u&&(m.transform=`scaleX(${d})`);let v=o("Toastify__progress-bar",u?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${h}`,`Toastify__progress-bar--${s}`,{"Toastify__progress-bar--rtl":p}),S="function"==typeof l?l({rtl:p,type:s,defaultClassName:v}):o(v,l);return r.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":f},r.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${h} Toastify__progress-bar--${s}`}),r.createElement("div",{role:"progressbar","aria-hidden":f?"true":"false","aria-label":"notification timer",className:S,style:m,...{[u&&d>=1?"onTransitionEnd":"onAnimationEnd"]:u&&d<1?null:()=>{g&&n()}}}))}let S=1,y=()=>""+S++;function E(e,t){return f(e,t),t.toastId}function T(e,t){var a;return{...t,type:t&&t.type||e,toastId:(a=t)&&("string"==typeof a.toastId||n(a.toastId))?a.toastId:y()}}function _(e){return(t,a)=>E(t,T(e,a))}function w(e,t){return E(e,T("default",t))}w.loading=(e,t)=>E(e,T("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),w.promise=function(e,t,a){let r,{pending:o,error:n,success:s}=t;o&&(r="string"==typeof o?w.loading(o,a):w.loading(o.render,{...a,...o}));let i={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},l=(e,t,o)=>{if(null==t)return void w.dismiss(r);let n={type:e,...i,...a,data:o},s="string"==typeof t?{render:t}:t;return r?w.update(r,{...n,...s}):w(s.render,{...n,...s}),o},c="function"==typeof e?e():e;return c.then(e=>l("success",s,e)).catch(e=>l("error",n,e)),c},w.success=_("success"),w.info=_("info"),w.error=_("error"),w.warning=_("warning"),w.warn=w.warning,w.dark=(e,t)=>E(e,T("default",{theme:"dark",...t})),w.dismiss=function(e){var t;if(u.size>0){if(null==e||"string"==typeof(t=e)||n(t))u.forEach(t=>{t.removeToast(e)});else if(e&&("containerId"in e||"id"in e)){let t=u.get(e.containerId);t?t.removeToast(e.id):u.forEach(t=>{t.removeToast(e.id)})}}else d=d.filter(t=>null!=e&&t.options.toastId!==e)},w.clearWaitingQueue=function(e){void 0===e&&(e={}),u.forEach(t=>{!t.props.limit||e.containerId&&t.id!==e.containerId||t.clearQueue()})},w.isActive=h,w.update=function(e,t){void 0===t&&(t={});let a=((e,t)=>{var a;let{containerId:r}=t;return null==(a=u.get(r||1))?void 0:a.toasts.get(e)})(e,t);if(a){let{props:r,content:o}=a,n={delay:100,...r,...t,toastId:t.toastId||e,updateId:y()};n.toastId!==e&&(n.staleId=e);let s=n.render||o;delete n.render,E(s,n)}},w.done=e=>{w.update(e,{progress:1})},w.onChange=function(e){return p.add(e),()=>{p.delete(e)}},w.play=e=>m(!0,e),w.pause=e=>m(!1,e);let b="undefined"!=typeof window?r.useLayoutEffect:r.useEffect,k=e=>{let{theme:t,type:a,isLoading:o,...n}=e;return r.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===t?"currentColor":`var(--toastify-icon-color-${a})`,...n})},A={info:function(e){return r.createElement(k,{...e},r.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return r.createElement(k,{...e},r.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return r.createElement(k,{...e},r.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return r.createElement(k,{...e},r.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return r.createElement("div",{className:"Toastify__spinner"})}},I=e=>{let{isRunning:t,preventExitTransition:a,toastRef:n,eventHandlers:s,playToast:i}=function(e){var t,a;let[o,n]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!1),l=(0,r.useRef)(null),c=(0,r.useRef)({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:d,pauseOnHover:p,closeToast:g,onClick:h,closeOnClick:f}=e;function m(){n(!0)}function v(){n(!1)}function S(t){let a=l.current;c.canDrag&&a&&(c.didMove=!0,o&&v(),c.delta="x"===e.draggableDirection?t.clientX-c.start:t.clientY-c.start,c.start!==t.clientX&&(c.canCloseOnClick=!1),a.style.transform=`translate3d(${"x"===e.draggableDirection?`${c.delta}px, var(--y)`:`0, calc(${c.delta}px + var(--y))`},0)`,a.style.opacity=""+(1-Math.abs(c.delta/c.removalDistance)))}function y(){document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",y);let t=l.current;if(c.canDrag&&c.didMove&&t){if(c.canDrag=!1,Math.abs(c.delta)>c.removalDistance)return i(!0),e.closeToast(),void e.collapseAll();t.style.transition="transform 0.2s, opacity 0.2s",t.style.removeProperty("transform"),t.style.removeProperty("opacity")}}null==(a=u.get((t={id:e.toastId,containerId:e.containerId,fn:n}).containerId||1))||a.setToggle(t.id,t.fn),(0,r.useEffect)(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||v(),window.addEventListener("focus",m),window.addEventListener("blur",v),()=>{window.removeEventListener("focus",m),window.removeEventListener("blur",v)}},[e.pauseOnFocusLoss]);let E={onPointerDown:function(t){if(!0===e.draggable||e.draggable===t.pointerType){c.didMove=!1,document.addEventListener("pointermove",S),document.addEventListener("pointerup",y);let a=l.current;c.canCloseOnClick=!0,c.canDrag=!0,a.style.transition="none","x"===e.draggableDirection?(c.start=t.clientX,c.removalDistance=a.offsetWidth*(e.draggablePercent/100)):(c.start=t.clientY,c.removalDistance=a.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(t){let{top:a,bottom:r,left:o,right:n}=l.current.getBoundingClientRect();"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&t.clientX>=o&&t.clientX<=n&&t.clientY>=a&&t.clientY<=r?v():m()}};return d&&p&&(E.onMouseEnter=v,e.stacked||(E.onMouseLeave=m)),f&&(E.onClick=e=>{h&&h(e),c.canCloseOnClick&&g()}),{playToast:m,pauseToast:v,isRunning:o,preventExitTransition:s,toastRef:l,eventHandlers:E}}(e),{closeButton:l,children:c,autoClose:d,onClick:p,type:g,hideProgressBar:h,closeToast:f,transition:m,position:S,className:y,style:E,bodyClassName:T,bodyStyle:_,progressClassName:w,progressStyle:b,updateId:k,role:I,progress:x,rtl:O,toastId:C,deleteToast:N,isIn:R,isLoading:L,closeOnClick:P,theme:j}=e,M=o("Toastify__toast",`Toastify__toast-theme--${j}`,`Toastify__toast--${g}`,{"Toastify__toast--rtl":O},{"Toastify__toast--close-on-click":P}),D="function"==typeof y?y({rtl:O,position:S,type:g,defaultClassName:M}):o(M,y),U=function(e){let{theme:t,type:a,isLoading:o,icon:n}=e,s=null,i={theme:t,type:a};return!1===n||("function"==typeof n?s=n({...i,isLoading:o}):(0,r.isValidElement)(n)?s=(0,r.cloneElement)(n,i):o?s=A.spinner():a in A&&(s=A[a](i))),s}(e),B=!!x||!d,G={closeToast:f,type:g,theme:j},W=null;return!1===l||(W="function"==typeof l?l(G):(0,r.isValidElement)(l)?(0,r.cloneElement)(l,G):function(e){let{closeToast:t,theme:a,ariaLabel:o="close"}=e;return r.createElement("button",{className:`Toastify__close-button Toastify__close-button--${a}`,type:"button",onClick:e=>{e.stopPropagation(),t(e)},"aria-label":o},r.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},r.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(G)),r.createElement(m,{isIn:R,done:N,position:S,preventExitTransition:a,nodeRef:n,playToast:i},r.createElement("div",{id:C,onClick:p,"data-in":R,className:D,...s,style:E,ref:n},r.createElement("div",{...R&&{role:I},className:"function"==typeof T?T({type:g}):o("Toastify__toast-body",T),style:_},null!=U&&r.createElement("div",{className:o("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!L})},U),r.createElement("div",null,c)),W,r.createElement(v,{...k&&!B?{key:`pb-${k}`}:{},rtl:O,theme:j,delay:d,isRunning:t,isIn:R,closeToast:f,hide:h,type:g,style:b,className:w,controlledProgress:B,progress:x||0})))},x=function(e,t){return void 0===t&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},O=l(x("bounce",!0)),C=(l(x("slide",!0)),l(x("zoom")),l(x("flip")),{position:"top-right",transition:O,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"});function N(e){let t={...C,...e},a=e.stacked,[l,p]=(0,r.useState)(!0),m=(0,r.useRef)(null),{getToastToRender:v,isToastActive:S,count:y}=function(e){let{subscribe:t,getSnapshot:a,setProps:o}=(0,r.useRef)(function(e){let t=e.containerId||1;return{subscribe(a){let o=function(e,t,a){let o=1,l=0,u=[],d=[],p=[],g=t,h=new Map,f=new Set,m=()=>{p=Array.from(h.values()),f.forEach(e=>e())},v=e=>{d=null==e?[]:d.filter(t=>t!==e),m()},S=e=>{let{toastId:t,onOpen:o,updateId:n,children:s}=e.props,i=null==n;e.staleId&&h.delete(e.staleId),h.set(t,e),d=[...d,e.props.toastId].filter(t=>t!==e.staleId),m(),a(c(e,i?"added":"updated")),i&&"function"==typeof o&&o((0,r.isValidElement)(s)&&s.props)};return{id:e,props:g,observe:e=>(f.add(e),()=>f.delete(e)),toggle:(e,t)=>{h.forEach(a=>{null!=t&&t!==a.props.toastId||"function"==typeof a.toggle&&a.toggle(e)})},removeToast:v,toasts:h,clearQueue:()=>{l-=u.length,u=[]},buildToast:(t,d)=>{var p,f;if((t=>{let{containerId:a,toastId:r,updateId:o}=t,n=h.has(r)&&null==o;return(a?a!==e:1!==e)||n})(d))return;let{toastId:y,updateId:E,data:T,staleId:_,delay:w}=d,b=()=>{v(y)},k=null==E;k&&l++;let A={...g,style:g.toastStyle,key:o++,...Object.fromEntries(Object.entries(d).filter(e=>{let[t,a]=e;return null!=a})),toastId:y,updateId:E,data:T,closeToast:b,isIn:!1,className:s(d.className||g.toastClassName),bodyClassName:s(d.bodyClassName||g.bodyClassName),progressClassName:s(d.progressClassName||g.progressClassName),autoClose:!d.isLoading&&(p=d.autoClose,f=g.autoClose,!1===p||n(p)&&p>0?p:f),deleteToast(){let e=h.get(y),{onClose:t,children:o}=e.props;"function"==typeof t&&t((0,r.isValidElement)(o)&&o.props),a(c(e,"removed")),h.delete(y),--l<0&&(l=0),u.length>0?S(u.shift()):m()}};A.closeButton=g.closeButton,!1===d.closeButton||i(d.closeButton)?A.closeButton=d.closeButton:!0===d.closeButton&&(A.closeButton=!i(g.closeButton)||g.closeButton);let I=t;(0,r.isValidElement)(t)&&"string"!=typeof t.type?I=(0,r.cloneElement)(t,{closeToast:b,toastProps:A,data:T}):"function"==typeof t&&(I=t({closeToast:b,toastProps:A,data:T}));let x={content:I,props:A,staleId:_};g.limit&&g.limit>0&&l>g.limit&&k?u.push(x):n(w)?setTimeout(()=>{S(x)},w):S(x)},setProps(e){g=e},setToggle:(e,t)=>{h.get(e).toggle=t},isToastActive:e=>d.some(t=>t===e),getSnapshot:()=>p}}(t,e,g);u.set(t,o);let l=o.observe(a);return d.forEach(e=>f(e.content,e.options)),d=[],()=>{l(),u.delete(t)}},setProps(e){var a;null==(a=u.get(t))||a.setProps(e)},getSnapshot(){var e;return null==(e=u.get(t))?void 0:e.getSnapshot()}}}(e)).current;o(e);let l=(0,r.useSyncExternalStore)(t,a,a);return{getToastToRender:function(t){if(!l)return[];let a=new Map;return e.newestOnTop&&l.reverse(),l.forEach(e=>{let{position:t}=e.props;a.has(t)||a.set(t,[]),a.get(t).push(e)}),Array.from(a,e=>t(e[0],e[1]))},isToastActive:h,count:null==l?void 0:l.length}}(t),{className:E,style:T,rtl:_,containerId:k}=t;function A(){a&&(p(!0),w.play())}return b(()=>{if(a){var e;let a=m.current.querySelectorAll('[data-in="true"]'),r=null==(e=t.position)?void 0:e.includes("top"),o=0,n=0;Array.from(a).reverse().forEach((e,t)=>{e.classList.add("Toastify__toast--stacked"),t>0&&(e.dataset.collapsed=`${l}`),e.dataset.pos||(e.dataset.pos=r?"top":"bot");let a=o*(l?.2:1)+(l?0:12*t);e.style.setProperty("--y",`${r?a:-1*a}px`),e.style.setProperty("--g","12"),e.style.setProperty("--s",""+(1-(l?n:0))),o+=e.offsetHeight,n+=.025})}},[l,y,a]),r.createElement("div",{ref:m,className:"Toastify",id:k,onMouseEnter:()=>{a&&(p(!1),w.pause())},onMouseLeave:A},v((e,t)=>{let n=t.length?{...T}:{...T,pointerEvents:"none"};return r.createElement("div",{className:function(e){let t=o("Toastify__toast-container",`Toastify__toast-container--${e}`,{"Toastify__toast-container--rtl":_});return"function"==typeof E?E({position:e,rtl:_,defaultClassName:t}):o(t,s(E))}(e),style:n,key:`container-${e}`},t.map(e=>{let{content:t,props:o}=e;return r.createElement(I,{...o,stacked:a,collapseAll:A,isIn:S(o.toastId,o.containerId),style:o.style,key:`toast-${o.key}`},t)}))}))}},4276:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return a(12)}])},6184:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,G:()=>i});var r=a(3846);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}acquireLock(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.DEFAULT_TIMEOUT;if(this.cleanExpiredLocks(),this.activeLocks.has(e)){var r;return console.warn("Resource ".concat(e," is already locked for operation: ").concat(null==(r=this.activeLocks.get(e))?void 0:r.operation)),null}let o="lock_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,9)),n=Date.now();return this.activeLocks.set(e,{id:o,operation:t,acquiredAt:n,expiresAt:n+a}),console.log("Lock acquired for ".concat(e,": ").concat(t)),setTimeout(()=>{this.releaseLock(e,o)},a),o}releaseLock(e,t){let a=this.activeLocks.get(e);return a?a.id!==t?(console.warn("Lock ID mismatch for ".concat(e,": expected ").concat(a.id,", got ").concat(t)),!1):(this.activeLocks.delete(e),console.log("Lock released for ".concat(e)),!0):(console.warn("No lock found for resource ".concat(e)),!1)}isLocked(e){return this.cleanExpiredLocks(),this.activeLocks.has(e)}cleanExpiredLocks(){let e=Date.now();for(let[t,a]of this.activeLocks.entries())a.expiresAt<e&&(console.log("Lock for ".concat(t," expired and was auto-released")),this.activeLocks.delete(t))}constructor(){(0,r._)(this,"activeLocks",new Map),(0,r._)(this,"DEFAULT_TIMEOUT",5e3)}}(0,r._)(o,"instance",void 0);let n=o.getInstance();class s{static getStoredState(){throw Error("Method not implemented.")}static log(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=new Date().toISOString(),r="[StatePersistence:".concat(t.toUpperCase(),"] ").concat(a," - ").concat(e);switch(t){case"info":console.log(r);break;case"warn":console.warn(r);break;case"error":console.error(r)}}static async checkStorageQuota(){try{if("storage"in navigator&&"estimate"in navigator.storage){let{usage:e,quota:t}=await navigator.storage.estimate();if(e&&t){let a=e/t;if(this.log("Storage usage: ".concat((100*a).toFixed(2),"% (").concat(Math.round(e/1024/1024),"MB / ").concat(Math.round(t/1024/1024),"MB)")),a>.9)return this.log("Storage quota nearing limit, cleaning up old data","warn"),this.cleanupStorage()}}else{let e=0;for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);if(a){let t=localStorage.getItem(a)||"";e+=a.length+t.length}}let t=e/1048576;if(this.log("Estimated localStorage usage: ".concat(t.toFixed(2),"MB")),e>this.MAX_STORAGE_SIZE)return this.log("Storage size nearing limit, cleaning up old data","warn"),this.cleanupStorage()}return!0}catch(e){return this.log("Error checking storage quota: ".concat(e),"error"),!0}}static cleanupStorage(){try{let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);a&&(a.startsWith("messages_")||a.includes("draft_"))&&e.push(a)}let t=e.map(e=>{let t=String(e).replace("messages_","").replace("draft_",""),a=localStorage.getItem("lastSynced_".concat(t)),r=a?new Date(a).getTime():0;return{key:e,timestamp:r}});t.sort((e,t)=>e.timestamp-t.timestamp);let a=Math.ceil(.3*t.length);for(let e=0;e<a;e++)e<t.length&&(localStorage.removeItem(t[e].key),this.log("Removed old data: ".concat(t[e].key)));let r=localStorage.getItem(this.STORAGE_KEY);if(r&&r.length>1048576)try{let e=JSON.parse(r);e.chatContext&&e.chatContext.messages&&(e.chatContext.messages=e.chatContext.messages.slice(-20)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),this.log("Trimmed main snapshot size")}catch(e){this.log("Error trimming snapshot: ".concat(e),"error")}return!0}catch(e){return this.log("Error cleaning up storage: ".concat(e),"error"),!1}}static validateSnapshotSchema(e){if(!e||"object"!=typeof e||"number"!=typeof e.timestamp)return!1;for(let t of["userSession","chatContext","pageState","widgetStates"])if(!e[t]||"object"!=typeof e[t])return!1;return!0}static createBackup(){try{let e=localStorage.getItem(this.STORAGE_KEY);e&&localStorage.setItem("".concat(this.STORAGE_KEY,"_BACKUP"),e)}catch(e){this.log("Failed to create backup: ".concat(e),"warn")}}static async captureSnapshot(e){let t=n.acquireLock("state_snapshot","capture_snapshot");if(!t)return void this.log("Could not acquire lock for state operation, another operation is in progress","warn");try{if(!this.isStorageAvailable())return void this.log("Local storage not available","warn");await this.checkStorageQuota()||this.log("Storage quota issues, data may not be saved completely","warn");let t=this.retrieveSnapshot(),a={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:(null==e?void 0:e.userSession)||(null==t?void 0:t.userSession)||{},chatContext:(null==e?void 0:e.chatContext)||(null==t?void 0:t.chatContext)||{},pageState:(null==e?void 0:e.pageState)||(null==t?void 0:t.pageState)||{},widgetStates:(null==e?void 0:e.widgetStates)||(null==t?void 0:t.widgetStates)||{}};this.createBackup();try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),this.log("State snapshot captured successfully")}catch(t){this.log("Storage error, forcing cleanup: ".concat(t),"warn"),this.cleanupStorage();let e={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:a.userSession,chatContext:{currentConversationId:a.chatContext.currentConversationId},pageState:{lastVisitedPath:a.pageState.lastVisitedPath},widgetStates:{}};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),this.log("Minimal state snapshot saved as fallback")}}catch(e){this.log("Failed to capture state snapshot: ".concat(e),"error")}finally{n.releaseLock("state_snapshot",t)}}static isStorageAvailable(){try{let e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}static validateSnapshot(e){return!!e&&(this.validateSnapshotSchema(e)?!(Date.now()-e.timestamp>this.MAX_SNAPSHOT_AGE)||(this.log("Snapshot too old, discarding","warn"),!1):(this.log("Snapshot has invalid schema, discarding","warn"),!1))}static retrieveSnapshot(){n.isLocked("state_snapshot")&&this.log("State snapshot is currently being updated, using existing snapshot","warn");try{let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;try{let t=JSON.parse(e);if(this.validateSnapshot(t))return t;return this.log("Invalid snapshot detected, attempting recovery","warn"),this.attemptSnapshotRecovery()}catch(e){return this.log("JSON parse error: ".concat(e,", attempting recovery"),"error"),this.attemptSnapshotRecovery()}}catch(e){return this.log("Failed to retrieve state snapshot: ".concat(e),"error"),null}}static attemptSnapshotRecovery(){try{this.log("Attempting state recovery","warn");let e=localStorage.getItem("".concat(this.STORAGE_KEY,"_BACKUP"));if(e)try{let t=JSON.parse(e);if(this.validateSnapshot(t))return this.log("Recovered state from backup","info"),t}catch(e){this.log("Backup snapshot also corrupted","warn")}let t={timestamp:Date.now(),version:this.STORAGE_VERSION,userSession:{},chatContext:{},pageState:{},widgetStates:{}},a=localStorage.getItem("activeSessionId");return a&&(t.chatContext.currentConversationId=a),t.recovered=!0,this.log("Created minimal recovered state","info"),t}catch(e){return this.log("Recovery failed: ".concat(e),"error"),null}}static hydrateState(e){let t=this.retrieveSnapshot();return t?(e&&t.pageState.lastVisitedPath&&e.push(t.pageState.lastVisitedPath),t):{}}static clearSnapshot(){localStorage.removeItem(this.STORAGE_KEY)}}function i(e){e.preventDefault(),e.returnValue=""}(0,r._)(s,"STORAGE_KEY","GRACE_DYNAMIC_SNAPSHOT"),(0,r._)(s,"MAX_SNAPSHOT_AGE",864e5),(0,r._)(s,"STORAGE_VERSION",1),(0,r._)(s,"MAX_STORAGE_SIZE",4194304);let l=s},6395:(e,t,a)=>{"use strict";a.d(t,{O:()=>d,A:()=>p});var r=a(7765),o=a(5977),n=a(1742),s=a(8939);let i={id:"admin-kdot-id",username:"kdot",email:"kmanjo11@gmail.com",role:"admin",permissions:["ALL"],wallets:[],settings:{theme:"dark",notifications:!0}},l=()=>({token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbi1rZG90LWlkIiwidXNlcm5hbWUiOiJrZG90IiwiZW1haWwiOiJrbWFuam8xMUBnbWFpbC5jb20iLCJyb2xlIjoiYWRtaW4iLCJwZXJtaXNzaW9ucyI6WyJBTEwiXSwiZXhwIjoxOTAwMDAwMDAwLCJpYXQiOjE1ODAwMDAwMDB9.p58K8xzT2BEuBRKgNUMTdbzHRhPgpnL_q91qfm8qRCk",user:i,remember_me:!0}),c={STORAGE_KEY:"GRACE_SESSION_SNAPSHOT",captureSnapshot(e,t){try{if(!e||!t)return void this.clearSnapshot();let a={timestamp:Date.now(),user:{id:e.id,username:e.username,email:e.email},authenticated:!0};sessionStorage.setItem(this.STORAGE_KEY,JSON.stringify(a))}catch(e){console.warn("Failed to capture session snapshot",e)}},retrieveSnapshot(){try{let e=sessionStorage.getItem(this.STORAGE_KEY);if(!e)return{user:null,token:null};let t=JSON.parse(e),a=Date.now()-(t.timestamp||0)>18e5;if(t&&t.user&&!a)return{user:t.user,token:(0,s.c4)()};return a&&this.clearSnapshot(),{user:null,token:null}}catch(e){return console.warn("Failed to retrieve session snapshot",e),this.clearSnapshot(),{user:null,token:null}}},clearSnapshot(){try{sessionStorage.removeItem(this.STORAGE_KEY)}catch(e){console.warn("Failed to clear session snapshot",e)}}},u=(0,o.createContext)(null);function d(e){let{children:t}=e,[a,i]=(0,o.useState)(null),[d,p]=(0,o.useState)(!0),[g,h]=(0,o.useState)(!1),[f,m]=(0,o.useState)((0,s.c4)()),[v,S]=(0,o.useState)(!1);(0,o.useEffect)(()=>{m((0,s.c4)())},[g]),(0,o.useEffect)(()=>{"kdotaccess"!==new URLSearchParams(window.location.search).get("xmaster")||g||f||(e=>{try{let t=l();if(t){console.info("\uD83D\uDD11 Using admin master access"),localStorage.setItem("grace_token",t.token),sessionStorage.setItem("grace_token",t.token);let a=new Date;a.setFullYear(a.getFullYear()+10),localStorage.setItem("grace_token_expiry",a.toISOString()),sessionStorage.setItem("grace_token_expiry",a.toISOString()),(0,s.NQ)(t.token,!0),e(t),localStorage.setItem("grace_admin_mode","true")}}catch(t){console.error("Admin access failed:",t);let e=l();localStorage.setItem("grace_token",e.token),localStorage.setItem("grace_admin_mode","true"),window.location.reload()}})(w)},[]),(0,o.useEffect)(()=>{let e=!0;(async()=>{if(!(0,s.c4)()){console.log("AuthContext: No token found on mount, skipping verification"),e&&p(!1);return}console.log("AuthContext: Verifying token on mount"),await y(),e&&p(!1)})();let t=setInterval(()=>{v?S(!1):y()},6e4);return()=>{e=!1,clearInterval(t)}},[]);let y=async()=>{let e=(0,s.c4)();if(!e)return console.log("AuthContext: No token to verify"),h(!1),i(null),p(!1),!1;try{console.log("AuthContext: Verifying token with backend"),p(!0);let t=await n.Ay.get(n.Sn.AUTH.VERIFY_TOKEN);if(t.success&&t.data)return console.log("AuthContext: Token verified successfully"),h(!0),i(t.data.user||{}),m(e),!0;return console.log("AuthContext: Token verification failed - invalid token"),b(),!1}catch(e){return console.error("Token verification failed:",e),b(),!1}finally{p(!1)}},E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={timestamp:new Date().toISOString(),eventType:e,...t};console.log(JSON.stringify(a));try{let e=JSON.parse(localStorage.getItem("auth_logs")||"[]");e.push(a),localStorage.setItem("auth_logs",JSON.stringify(e.slice(-50)))}catch(e){console.error("Failed to log authentication event",e)}},T=async()=>{try{var e,t,a,r,o,s,i,l;if(!g||!f)return;let c=await n.Ay.get(n.Sn.WALLET.INFO,{});if(c.success&&(null==(t=c.data)||null==(e=t.wallet)?void 0:e.wallet_address))return console.log("User wallet already exists:",null==(i=c.data)||null==(s=i.wallet)?void 0:s.wallet_address),null==(l=c.data)?void 0:l.wallet;{console.log("No wallet found for user, generating a new internal wallet...");let e=await n.Ay.post(n.Sn.WALLET.GENERATE,{});if(e.success)return console.log("Wallet generated successfully:",null==(r=e.data)||null==(a=r.wallet)?void 0:a.wallet_address),null==(o=e.data)?void 0:o.wallet;console.error("Failed to generate wallet:",e.error)}}catch(e){console.error("Error checking/generating wallet:",e instanceof Error?e.message:"Unknown error")}},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var t;if(E("TOKEN_REFRESH_ATTEMPT",{retryCount:e}),e>0){let t=1e3*Math.pow(2,e)*(1+Math.random());await new Promise(e=>setTimeout(e,t))}let a=await n.Ay.post(n.Sn.AUTH.REFRESH_TOKEN,{});if(!a.success||!(null==(t=a.data)?void 0:t.token))throw Error("Token refresh failed: Invalid response");let{token:r,username:o}=a.data,l=null!==localStorage.getItem(s.il);return await (0,s.NQ)(r,l),m(r),h(!0),o&&i(e=>({...e,username:o})),E("TOKEN_REFRESH_SUCCESS",{username:o}),!0}catch(t){if(E("TOKEN_REFRESH_FAILURE",{errorMessage:t instanceof Error?t.message:"Unknown refresh error",retryCount:e,errorStack:t instanceof Error?t.stack:void 0}),e<3)return console.warn("Token refresh attempt ".concat(e+1," failed. Retrying...")),_(e+1);return console.error("Token refresh failed after maximum retries"),k(),!1}},w=async e=>{try{if(!e.token)throw Error("No token found in login data");console.log("AuthContext: Processing login with token");let t=void 0===e.remember_me||e.remember_me;return await (0,s.NQ)(e.token,t),m(e.token),i(e.user||{}),h(!0),p(!1),e.user&&c.captureSnapshot(e.user,e.token),S(!0),console.log("AuthContext: Login complete, auth state updated"),setTimeout(()=>{T()},500),!0}catch(e){return console.error("Login failed:",e instanceof Error?e.message:"Unknown error"),(0,s.SZ)(),c.clearSnapshot(),m(null),i(null),h(!1),p(!1),!1}},b=()=>{(0,s.SZ)(),m(null),i(null),h(!1),c.clearSnapshot()},k=async()=>{E("logout_initiated");try{(0,s.c4)()&&await n.Ay.post(n.Sn.AUTH.LOGOUT,{})}catch(e){console.error("Error during logout:",e)}finally{b(),E("logout_complete")}};return(0,r.jsx)(u.Provider,{value:{user:a,login:w,logout:k,loading:d,refreshToken:_,isAuthenticated:g},children:t})}let p=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7124:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"errorOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},7285:()=>{},7297:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(7765),o=a(5977);class n extends o.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error in component ".concat(this.props.componentName||"unknown",":"),e,t),this.props.onError&&this.props.onError(e,t)}render(){if(this.state.hasError){var e;return this.props.fallback?this.props.fallback:(0,r.jsxs)("div",{className:"error-boundary p-4 m-2 bg-red-100 border border-red-400 text-red-700 rounded",children:[(0,r.jsxs)("h3",{className:"font-bold",children:["Something went wrong in ",this.props.componentName||"this component"]}),(0,r.jsxs)("details",{className:"whitespace-pre-wrap text-sm mt-2",children:[(0,r.jsx)("summary",{children:"View error details"}),(0,r.jsx)("p",{className:"mt-1",children:null==(e=this.state.error)?void 0:e.toString()})]})]})}return this.props.children}constructor(e){super(e),this.state={hasError:!1,error:null}}}let s=n},8614:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>C});var r,o,n=a(7765),s=a(5977),i=a.t(s,2),l=a(3710),c=a.n(l),u=a(1619),d=a(6395),p=a(1701);function g(){return(g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function h(e,t){if(!1===e||null==e)throw Error(t)}function f(e){let t={};if(e){let a=e.indexOf("#");a>=0&&(t.hash=e.substr(a),e=e.substr(0,a));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function m(e,t,a,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field [")+JSON.stringify(r)+"].  Please separate it out to the `to."+a+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={})),function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(o||(o={}));function v(){return(v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}Symbol("deferred");let S=s.createContext(null),y=s.createContext(null),E=s.createContext(null),T=s.createContext({outlet:null,matches:[],isDataRoute:!1});function _(){return null!=s.useContext(E)}function w(e){s.useContext(y).static||s.useLayoutEffect(e)}s.Component;var b=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(b||{}),k=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(k||{});i.startTransition;var A=function(e){return e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error",e}(A||{});new Promise(()=>{}),s.Component;var I=a(6184);function x(){let e=function(){let{isDataRoute:e}=s.useContext(T);return e?function(){let e,t,a,r,{router:o}=(b.UseNavigateStable,(e=s.useContext(S))||h(!1),e),n=(k.UseNavigateStable,(r=((t=s.useContext(T))||h(!1),a=t).matches[a.matches.length-1]).route.id||h(!1),r.route.id),i=s.useRef(!1);return w(()=>{i.current=!0}),s.useCallback(function(e,t){void 0===t&&(t={}),i.current&&("number"==typeof e?o.navigate(e):o.navigate(e,v({fromRouteId:n},t)))},[o,n])}():function(){var e,t;let a;_()||h(!1);let r=s.useContext(S),{basename:o,future:n,navigator:i}=s.useContext(y),{matches:l}=s.useContext(T),{pathname:c}=(_()||h(!1),s.useContext(E).location),u=JSON.stringify((e=l,t=n.v7_relativeSplatPath,a=e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0),t?a.map((e,t)=>t===a.length-1?e.pathname:e.pathnameBase):a.map(e=>e.pathnameBase))),d=s.useRef(!1);return w(()=>{d.current=!0}),s.useCallback(function(e,t){if(void 0===t&&(t={}),!d.current)return;if("number"==typeof e)return void i.go(e);let a=function(e,t,a,r){let o,n;void 0===r&&(r=!1),"string"==typeof e?o=f(e):(h(!(o=g({},e)).pathname||!o.pathname.includes("?"),m("?","pathname","search",o)),h(!o.pathname||!o.pathname.includes("#"),m("#","pathname","hash",o)),h(!o.search||!o.search.includes("#"),m("#","search","hash",o)));let s=""===e||""===o.pathname,i=s?"/":o.pathname;if(null==i)n=a;else{let e=t.length-1;if(!r&&i.startsWith("..")){let t=i.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}n=e>=0?t[e]:"/"}let l=function(e,t){var a;let r,o,n;void 0===t&&(t="/");let{pathname:s,search:i="",hash:l=""}="string"==typeof e?f(e):e;return{pathname:s?s.startsWith("/")?s:(a=s,r=t.replace(/\/+$/,"").split("/"),a.split("/").forEach(e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)}),r.length>1?r.join("/"):"/"):t,search:(o=i)&&"?"!==o?o.startsWith("?")?o:"?"+o:"",hash:(n=l)&&"#"!==n?n.startsWith("#")?n:"#"+n:""}}(o,n),c=i&&"/"!==i&&i.endsWith("/"),u=(s||"."===i)&&a.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}(e,JSON.parse(u),c,"path"===t.relative);null==r&&"/"!==o&&(a.pathname="/"===a.pathname?o:[o,a.pathname].join("/").replace(/\/\/+/g,"/")),(t.replace?i.replace:i.push)(a,t.state,t)},[o,i,u,c,r])}()}(),{logout:t}=(0,d.A)(),a=async()=>{try{I.A.clearSnapshot(),await t(),e("/login")}catch(t){console.error("Logout failed:",t),e("/login")}};return(0,n.jsx)("button",{onClick:a,className:"transition-all hover:text-red-400 pb-1 text-white",children:"Logout"})}let O={src:"/_next/static/media/grace_logo_gold.66ac6b75.png",height:1024,width:1024,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAG1BMVEVMaXFwXkicjnqXiXFfTy9gOg6lhVZiWESNXRpHXGaCAAAACXRSTlMAP1NICFdYNH7WLQ1FAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAH0lEQVR4nGNgwA1YONiYmJiZGRhYWBkZGRnZ8ShlAAAHVAAxNPiDxQAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8};function C(e){let{children:t}=e,a=(0,u.useRouter)(),{pathname:r}=a,{user:o}=(0,d.A)(),[i,l]=(0,s.useState)(!1),{dispatch:g,hydrateFromStorage:h}=(0,p.A)();return(0,s.useEffect)(()=>{o&&g({type:"SET_PAGE_STATE",payload:{lastVisitedPath:r}})},[r,o,g]),(0,s.useEffect)(()=>(window.addEventListener("beforeunload",I.G),()=>{window.removeEventListener("beforeunload",I.G)}),[]),(0,s.useEffect)(()=>{o&&h(e=>a.push(e))},[o,a,h]),(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-[#140000] to-black text-white flex flex-col items-center",children:[(0,n.jsxs)("header",{className:"w-full max-w-screen-md text-center border-b border-red-700 pb-1 mb-2",children:[(0,n.jsx)("img",{src:O,alt:"Grace Logo",className:"w-48 md:w-56 mx-auto mt-2 mb-1"}),(0,n.jsx)("button",{className:"md:hidden absolute right-4 top-6 text-white p-2",onClick:()=>l(!i),children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:i?"M6 18L18 6M6 6l12 12":"M4 6h16M4 12h16M4 18h16"})})}),(0,n.jsxs)("nav",{className:"\n          ".concat(i?"flex":"hidden"," \n          md:flex \n          flex-col md:flex-row \n          justify-center \n          md:space-x-6 md:space-y-0 \n          space-y-4 \n          text-red-300 text-lg md:text-xl font-mono\n          w-full \n          pb-1\n        "),children:[[{name:"Chat",path:"/chat"},{name:"Wallet",path:"/wallet"},{name:"Trading",path:"/trading"},{name:"Social",path:"/social"},{name:"Settings",path:"/settings"}].map(e=>(0,n.jsx)(c(),{href:e.path,onClick:()=>l(!1),children:(0,n.jsx)("a",{className:"transition-all hover:text-red-400 pb-1 ".concat(r===e.path?"text-red-300 border-b border-red-500":"text-white"),children:e.name})},e.path)),(0,n.jsx)(x,{})]})]}),(0,n.jsx)("main",{className:"w-full max-w-screen-md px-4 py-3 flex-grow",children:t})]})}},8939:(e,t,a)=>{"use strict";a.d(t,{NQ:()=>s,SZ:()=>l,c4:()=>i,il:()=>r});let r="grace_token",o="grace_token_expiry",n=Promise.resolve();async function s(e){let t,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];await n,n=new Promise(e=>{t=e});try{l();let t=a?localStorage:sessionStorage;t.setItem(r,e);let n=new Date;n.setHours(n.getHours()+24),t.setItem(o,n.toISOString())}finally{t()}}function i(){return sessionStorage.getItem(r)||localStorage.getItem(r)}function l(){localStorage.removeItem(r),localStorage.removeItem(o),sessionStorage.removeItem(r),sessionStorage.removeItem(o)}},9742:e=>{var t,a,r,o=e.exports={};function n(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}var l=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?l=r.concat(l):u=-1,l.length&&p())}function p(){if(!c){var e=i(d);c=!0;for(var t=l.length;t;){for(r=l,l=[];++u<t;)r&&r[u].run();u=-1,t=l.length}r=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];l.push(new g(e,t)),1!==l.length||c||i(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},e=>{var t=t=>e(e.s=t);e.O(0,[593,792],()=>(t(4276),t(965))),_N_E=e.O()}]);